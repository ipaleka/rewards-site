{% extends "base_generic.html" %}
{% load partials %}
{% load static %}

{% partialdef allocations_table_partial %}
<div class="space-y-4 p-4 rounded-lg bg-base-200 mt-4">

  <div class="overflow-x-auto">
    <table class="table w-full">
      <thead>
        <tr><th>Address</th><th>Amount</th></tr>
      </thead>
      <tbody>
        {% for address, amount in allocations %}
        <tr><td>{{ address }}</td><td>{{ amount|floatformat:"g" }}</td></tr>
        {% empty %}
        <tr>
          <td colspan="2" class="py-4 text-center text-success">
            âœ… All allocations processed!
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  {% if use_admin_account %}
  <form method="post"
        hx-post="{% url 'add_allocations' %}"
        hx-vals='{"blocking": "true"}'
        hx-trigger="click"
        hx-swap="none">
    {% csrf_token %}
    <button id="add-allocations-admin"
            type="submit"
            class="btn btn-primary btn-sm mt-4"
            hx-disable>
      Add allocations (admin mode)
    </button>
  </form>
  {% else %}
  <button id="add-allocations-button" type="button" class="btn btn-primary btn-sm mt-4">
    Add allocations
  </button>
  {% endif %}
</div>
{% endpartialdef %}

{% block head_title %}
  Add allocations
{% endblock head_title %}

{% block content %}

<div class="container mx-auto px-4 py-8">

  <h1 class="text-3xl font-bold mb-6">Add allocations (superuser only)</h1>

  {% if allocations %}
  <div id="add-allocations-container">
      {% csrf_token %}
      {% partial allocations_table_partial %}
  </div>
  {% else %}
    <p>No allocations found.</p>
  {% endif %}

  <p class="mt-4 text-sm text-base-content/70">
    This page allows a superuser to add new allocations to the smart contract if automatic allocation didn't occur.
  </p>
</div>
{% endblock content %}
