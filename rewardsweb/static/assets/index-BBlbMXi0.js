import{r as Yd,g as Fl,B as se,a as Z,p as Gt}from"../js/bundle.js";import{r as Hs,f as zt,g as yr,c as Zd,a as ra,p as Jd,b as Ds,d as Xt}from"./format-DCjLs-R4.js";var St=Yd();const Ll=Fl(St);var pn={},gn={},pi={},Ka;function Xd(){if(Ka)return pi;Ka=1,Object.defineProperty(pi,"__esModule",{value:!0}),pi.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return pi.delay=t,pi}var Ir={},yn={},_r={},Ha;function Qd(){return Ha||(Ha=1,Object.defineProperty(_r,"__esModule",{value:!0}),_r.ONE_THOUSAND=_r.ONE_HUNDRED=void 0,_r.ONE_HUNDRED=100,_r.ONE_THOUSAND=1e3),_r}var wn={},Wa;function ep(){return Wa||(Wa=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365})(wn)),wn}var Ga;function Ml(){return Ga||(Ga=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Hs;e.__exportStar(Qd(),t),e.__exportStar(ep(),t)})(yn)),yn}var Ya;function tp(){if(Ya)return Ir;Ya=1,Object.defineProperty(Ir,"__esModule",{value:!0}),Ir.fromMiliseconds=Ir.toMiliseconds=void 0;const t=Ml();function e(i){return i*t.ONE_THOUSAND}Ir.toMiliseconds=e;function r(i){return Math.floor(i/t.ONE_THOUSAND)}return Ir.fromMiliseconds=r,Ir}var Za;function rp(){return Za||(Za=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Hs;e.__exportStar(Xd(),t),e.__exportStar(tp(),t)})(gn)),gn}var Hr={},Ja;function ip(){if(Ja)return Hr;Ja=1,Object.defineProperty(Hr,"__esModule",{value:!0}),Hr.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const i=this.get(r);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const s=Date.now()-i.started;this.timestamps.set(r,{started:i.started,elapsed:s})}get(r){const i=this.timestamps.get(r);if(typeof i>"u")throw new Error(`No timestamp found for label: ${r}`);return i}elapsed(r){const i=this.get(r);return i.elapsed||Date.now()-i.started}}return Hr.Watch=t,Hr.default=t,Hr}var bn={},gi={},Xa;function sp(){if(Xa)return gi;Xa=1,Object.defineProperty(gi,"__esModule",{value:!0}),gi.IWatch=void 0;class t{}return gi.IWatch=t,gi}var Qa;function np(){return Qa||(Qa=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),Hs.__exportStar(sp(),t)})(bn)),bn}var ec;function op(){return ec||(ec=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Hs;e.__exportStar(rp(),t),e.__exportStar(ip(),t),e.__exportStar(np(),t),e.__exportStar(Ml(),t)})(pn)),pn}var V=op();class Mr{}let ap=class extends Mr{constructor(e){super()}};const tc=V.FIVE_SECONDS,qr={pulse:"heartbeat_pulse"};let cp=class ql extends ap{constructor(e){super(e),this.events=new St.EventEmitter,this.interval=tc,this.interval=(e==null?void 0:e.interval)||tc}static async init(e){const r=new ql(e);return await r.init(),r}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),V.toMiliseconds(this.interval))}pulse(){this.events.emit(qr.pulse)}};const up=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,lp=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,hp=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function fp(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){dp(t);return}return e}function dp(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function rs(t,e={}){if(typeof t!="string")return t;if(t[0]==='"'&&t[t.length-1]==='"'&&t.indexOf("\\")===-1)return t.slice(1,-1);const r=t.trim();if(r.length<=9)switch(r.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!hp.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(up.test(t)||lp.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,fp)}return JSON.parse(t)}catch(i){if(e.strict)throw i;return t}}function pp(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function De(t,...e){try{return pp(t(...e))}catch(r){return Promise.reject(r)}}function gp(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function yp(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function bs(t){if(gp(t))return String(t);if(yp(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return bs(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const po="base64:";function wp(t){return typeof t=="string"?t:po+vp(t)}function bp(t){return typeof t!="string"||!t.startsWith(po)?t:mp(t.slice(po.length))}function mp(t){return globalThis.Buffer?se.from(t,"base64"):Uint8Array.from(globalThis.atob(t),e=>e.codePointAt(0))}function vp(t){return globalThis.Buffer?se.from(t).toString("base64"):globalThis.btoa(String.fromCodePoint(...t))}function He(t){var e;return t&&((e=t.split("?")[0])==null?void 0:e.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""))||""}function Ep(...t){return He(t.join(":"))}function is(t){return t=He(t),t?t+":":""}function xp(t,e){if(e===void 0)return!0;let r=0,i=t.indexOf(":");for(;i>-1;)r++,i=t.indexOf(":",i+1);return r<=e}function Ip(t,e){return e?t.startsWith(e)&&t[t.length-1]!=="$":t[t.length-1]!=="$"}const _p="memory",Sp=()=>{const t=new Map;return{name:_p,getInstance:()=>t,hasItem(e){return t.has(e)},getItem(e){return t.get(e)??null},getItemRaw(e){return t.get(e)??null},setItem(e,r){t.set(e,r)},setItemRaw(e,r){t.set(e,r)},removeItem(e){t.delete(e)},getKeys(){return[...t.keys()]},clear(){t.clear()},dispose(){t.clear()}}};function Dp(t={}){const e={mounts:{"":t.driver||Sp()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=u=>{for(const l of e.mountpoints)if(u.startsWith(l))return{base:l,relativeKey:u.slice(l.length),driver:e.mounts[l]};return{base:"",relativeKey:u,driver:e.mounts[""]}},i=(u,l)=>e.mountpoints.filter(h=>h.startsWith(u)||l&&u.startsWith(h)).map(h=>({relativeBase:u.length>h.length?u.slice(h.length):void 0,mountpoint:h,driver:e.mounts[h]})),s=(u,l)=>{if(e.watching){l=He(l);for(const h of e.watchListeners)h(u,l)}},n=async()=>{if(!e.watching){e.watching=!0;for(const u in e.mounts)e.unwatch[u]=await rc(e.mounts[u],s,u)}},o=async()=>{if(e.watching){for(const u in e.unwatch)await e.unwatch[u]();e.unwatch={},e.watching=!1}},a=(u,l,h)=>{const f=new Map,g=d=>{let p=f.get(d.base);return p||(p={driver:d.driver,base:d.base,items:[]},f.set(d.base,p)),p};for(const d of u){const p=typeof d=="string",b=He(p?d:d.key),v=p?void 0:d.value,_=p||!d.options?l:{...l,...d.options},m=r(b);g(m).items.push({key:b,value:v,relativeKey:m.relativeKey,options:_})}return Promise.all([...f.values()].map(d=>h(d))).then(d=>d.flat())},c={hasItem(u,l={}){u=He(u);const{relativeKey:h,driver:f}=r(u);return De(f.hasItem,h,l)},getItem(u,l={}){u=He(u);const{relativeKey:h,driver:f}=r(u);return De(f.getItem,h,l).then(g=>rs(g))},getItems(u,l={}){return a(u,l,h=>h.driver.getItems?De(h.driver.getItems,h.items.map(f=>({key:f.relativeKey,options:f.options})),l).then(f=>f.map(g=>({key:Ep(h.base,g.key),value:rs(g.value)}))):Promise.all(h.items.map(f=>De(h.driver.getItem,f.relativeKey,f.options).then(g=>({key:f.key,value:rs(g)})))))},getItemRaw(u,l={}){u=He(u);const{relativeKey:h,driver:f}=r(u);return f.getItemRaw?De(f.getItemRaw,h,l):De(f.getItem,h,l).then(g=>bp(g))},async setItem(u,l,h={}){if(l===void 0)return c.removeItem(u);u=He(u);const{relativeKey:f,driver:g}=r(u);g.setItem&&(await De(g.setItem,f,bs(l),h),g.watch||s("update",u))},async setItems(u,l){await a(u,l,async h=>{if(h.driver.setItems)return De(h.driver.setItems,h.items.map(f=>({key:f.relativeKey,value:bs(f.value),options:f.options})),l);h.driver.setItem&&await Promise.all(h.items.map(f=>De(h.driver.setItem,f.relativeKey,bs(f.value),f.options)))})},async setItemRaw(u,l,h={}){if(l===void 0)return c.removeItem(u,h);u=He(u);const{relativeKey:f,driver:g}=r(u);if(g.setItemRaw)await De(g.setItemRaw,f,l,h);else if(g.setItem)await De(g.setItem,f,wp(l),h);else return;g.watch||s("update",u)},async removeItem(u,l={}){typeof l=="boolean"&&(l={removeMeta:l}),u=He(u);const{relativeKey:h,driver:f}=r(u);f.removeItem&&(await De(f.removeItem,h,l),(l.removeMeta||l.removeMata)&&await De(f.removeItem,h+"$",l),f.watch||s("remove",u))},async getMeta(u,l={}){typeof l=="boolean"&&(l={nativeOnly:l}),u=He(u);const{relativeKey:h,driver:f}=r(u),g=Object.create(null);if(f.getMeta&&Object.assign(g,await De(f.getMeta,h,l)),!l.nativeOnly){const d=await De(f.getItem,h+"$",l).then(p=>rs(p));d&&typeof d=="object"&&(typeof d.atime=="string"&&(d.atime=new Date(d.atime)),typeof d.mtime=="string"&&(d.mtime=new Date(d.mtime)),Object.assign(g,d))}return g},setMeta(u,l,h={}){return this.setItem(u+"$",l,h)},removeMeta(u,l={}){return this.removeItem(u+"$",l)},async getKeys(u,l={}){var b;u=is(u);const h=i(u,!0);let f=[];const g=[];let d=!0;for(const v of h){(b=v.driver.flags)!=null&&b.maxDepth||(d=!1);const _=await De(v.driver.getKeys,v.relativeBase,l);for(const m of _){const x=v.mountpoint+He(m);f.some(D=>x.startsWith(D))||g.push(x)}f=[v.mountpoint,...f.filter(m=>!m.startsWith(v.mountpoint))]}const p=l.maxDepth!==void 0&&!d;return g.filter(v=>(!p||xp(v,l.maxDepth))&&Ip(v,u))},async clear(u,l={}){u=is(u),await Promise.all(i(u,!1).map(async h=>{if(h.driver.clear)return De(h.driver.clear,h.relativeBase,l);if(h.driver.removeItem){const f=await h.driver.getKeys(h.relativeBase||"",l);return Promise.all(f.map(g=>h.driver.removeItem(g,l)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(u=>ic(u)))},async watch(u){return await n(),e.watchListeners.push(u),async()=>{e.watchListeners=e.watchListeners.filter(l=>l!==u),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(u,l){if(u=is(u),u&&e.mounts[u])throw new Error(`already mounted at ${u}`);return u&&(e.mountpoints.push(u),e.mountpoints.sort((h,f)=>f.length-h.length)),e.mounts[u]=l,e.watching&&Promise.resolve(rc(l,s,u)).then(h=>{e.unwatch[u]=h}).catch(console.error),c},async unmount(u,l=!0){var h,f;u=is(u),!(!u||!e.mounts[u])&&(e.watching&&u in e.unwatch&&((f=(h=e.unwatch)[u])==null||f.call(h),delete e.unwatch[u]),l&&await ic(e.mounts[u]),e.mountpoints=e.mountpoints.filter(g=>g!==u),delete e.mounts[u])},getMount(u=""){u=He(u)+":";const l=r(u);return{driver:l.driver,base:l.base}},getMounts(u="",l={}){return u=He(u),i(u,l.parents).map(f=>({driver:f.driver,base:f.mountpoint}))},keys:(u,l={})=>c.getKeys(u,l),get:(u,l={})=>c.getItem(u,l),set:(u,l,h={})=>c.setItem(u,l,h),has:(u,l={})=>c.hasItem(u,l),del:(u,l={})=>c.removeItem(u,l),remove:(u,l={})=>c.removeItem(u,l)};return c}function rc(t,e,r){return t.watch?t.watch((i,s)=>e(i,r+s)):()=>{}}async function ic(t){typeof t.dispose=="function"&&await De(t.dispose)}function jr(t){return new Promise((e,r)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>r(t.error)})}function jl(t,e){let r;const i=()=>{if(r)return r;const s=indexedDB.open(t);return s.onupgradeneeded=()=>s.result.createObjectStore(e),r=jr(s),r.then(n=>{n.onclose=()=>r=void 0},()=>{}),r};return(s,n)=>i().then(o=>n(o.transaction(e,s).objectStore(e)))}let mn;function Vi(){return mn||(mn=jl("keyval-store","keyval")),mn}function sc(t,e=Vi()){return e("readonly",r=>jr(r.get(t)))}function Ap(t,e,r=Vi()){return r("readwrite",i=>(i.put(e,t),jr(i.transaction)))}function $p(t,e=Vi()){return e("readwrite",r=>(r.delete(t),jr(r.transaction)))}function Op(t=Vi()){return t("readwrite",e=>(e.clear(),jr(e.transaction)))}function Bp(t,e){return t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},jr(t.transaction)}function Tp(t=Vi()){return t("readonly",e=>{if(e.getAllKeys)return jr(e.getAllKeys());const r=[];return Bp(e,i=>r.push(i.key)).then(()=>r)})}const Pp=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),Np=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=t.replace(e,'$1"$2n"$3');return JSON.parse(r,(i,s)=>typeof s=="string"&&s.match(/^\d+n$/)?BigInt(s.substring(0,s.length-1)):s)};function zl(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return Np(t)}catch{return t}}function Vl(t){return typeof t=="string"?t:Pp(t)||""}const Cp="idb-keyval";var Up=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",r=s=>e+s;let i;return t.dbName&&t.storeName&&(i=jl(t.dbName,t.storeName)),{name:Cp,options:t,async hasItem(s){return!(typeof await sc(r(s),i)>"u")},async getItem(s){return await sc(r(s),i)??null},setItem(s,n){return Ap(r(s),n,i)},removeItem(s){return $p(r(s),i)},getKeys(){return Tp(i)},clear(){return Op(i)}}};const Rp="WALLET_CONNECT_V2_INDEXED_DB",kp="keyvaluestorage";let Fp=class{constructor(){this.indexedDb=Dp({driver:Up({dbName:Rp,storeName:kp})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const r=await this.indexedDb.getItem(e);if(r!==null)return r}async setItem(e,r){await this.indexedDb.setItem(e,Vl(r))}async removeItem(e){await this.indexedDb.removeItem(e)}};var vn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Z<"u"?Z:typeof self<"u"?self:{},ms={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,i){this[r]=String(i)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(i){r[i]=void 0,delete r[i]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof vn<"u"&&vn.localStorage?ms.exports=vn.localStorage:typeof window<"u"&&window.localStorage?ms.exports=window.localStorage:ms.exports=new e})();function Lp(t){var e;return[t[0],zl((e=t[1])!=null?e:"")]}let Mp=class{constructor(){this.localStorage=ms.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(Lp)}async getItem(e){const r=this.localStorage.getItem(e);if(r!==null)return zl(r)}async setItem(e,r){this.localStorage.setItem(e,Vl(r))}async removeItem(e){this.localStorage.removeItem(e)}};const qp="wc_storage_version",nc=1,jp=async(t,e,r)=>{const i=qp,s=await e.getItem(i);if(s&&s>=nc){r(e);return}const n=await t.getKeys();if(!n.length){r(e);return}const o=[];for(;n.length;){const a=n.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const u=await t.getItem(a);await e.setItem(a,u),o.push(a)}}await e.setItem(i,nc),r(e),zp(t,o)},zp=async(t,e)=>{e.length&&e.forEach(async r=>{await t.removeItem(r)})};let Vp=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const e=new Mp;this.storage=e;try{const r=new Fp;jp(e,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,r){return await this.initialize(),this.storage.setItem(e,r)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),e())},20)})}};var yi={exports:{}},En,oc;function Kp(){if(oc)return En;oc=1;function t(r){try{return JSON.stringify(r)}catch{return'"[Circular]"'}}En=e;function e(r,i,s){var n=s&&s.stringify||t,o=1;if(typeof r=="object"&&r!==null){var a=i.length+o;if(a===1)return r;var c=new Array(a);c[0]=n(r);for(var u=1;u<a;u++)c[u]=n(i[u]);return c.join(" ")}if(typeof r!="string")return r;var l=i.length;if(l===0)return r;for(var h="",f=1-o,g=-1,d=r&&r.length||0,p=0;p<d;){if(r.charCodeAt(p)===37&&p+1<d){switch(g=g>-1?g:0,r.charCodeAt(p+1)){case 100:case 102:if(f>=l||i[f]==null)break;g<p&&(h+=r.slice(g,p)),h+=Number(i[f]),g=p+2,p++;break;case 105:if(f>=l||i[f]==null)break;g<p&&(h+=r.slice(g,p)),h+=Math.floor(Number(i[f])),g=p+2,p++;break;case 79:case 111:case 106:if(f>=l||i[f]===void 0)break;g<p&&(h+=r.slice(g,p));var b=typeof i[f];if(b==="string"){h+="'"+i[f]+"'",g=p+2,p++;break}if(b==="function"){h+=i[f].name||"<anonymous>",g=p+2,p++;break}h+=n(i[f]),g=p+2,p++;break;case 115:if(f>=l)break;g<p&&(h+=r.slice(g,p)),h+=String(i[f]),g=p+2,p++;break;case 37:g<p&&(h+=r.slice(g,p)),h+="%",g=p+2,p++,f--;break}++f}++p}return g===-1?r:(g<d&&(h+=r.slice(g)),h)}return En}var ac;function Hp(){if(ac)return yi.exports;ac=1;const t=Kp();yi.exports=l;const e=B().console||{},r={mapHttpRequest:N,mapHttpResponse:N,wrapRequestSerializer:R,wrapResponseSerializer:R,wrapErrorSerializer:R,req:N,res:N,err:D,errWithCause:D};function i(y,w){return y==="silent"?1/0:w.levels.values[y]}const s=Symbol("pino.logFuncs"),n=Symbol("pino.hierarchy"),o={error:"log",fatal:"error",warn:"error",info:"log",debug:"log",trace:"log"};function a(y,w){const E={logger:w,parent:y[n]};w[n]=E}function c(y,w,E){const S={};w.forEach(I=>{S[I]=E[I]?E[I]:e[I]||e[o[I]||"log"]||T}),y[s]=S}function u(y,w){return Array.isArray(y)?y.filter(function(S){return S!=="!stdSerializers.err"}):y===!0?Object.keys(w):!1}function l(y){y=y||{},y.browser=y.browser||{};const w=y.browser.transmit;if(w&&typeof w.send!="function")throw Error("pino: transmit option must have a send function");const E=y.browser.write||e;y.browser.write&&(y.browser.asObject=!0);const S=y.serializers||{},I=u(y.browser.serialize,S);let $=y.browser.serialize;Array.isArray(y.browser.serialize)&&y.browser.serialize.indexOf("!stdSerializers.err")>-1&&($=!1);const C=Object.keys(y.customLevels||{}),U=["error","fatal","warn","info","debug","trace"].concat(C);typeof E=="function"&&U.forEach(function(Y){E[Y]=E}),(y.enabled===!1||y.browser.disabled)&&(y.level="silent");const j=y.level||"info",k=Object.create(E);k.log||(k.log=T),c(k,U,E),a({},k),Object.defineProperty(k,"levelVal",{get:H}),Object.defineProperty(k,"level",{get:G,set:J});const M={transmit:w,serialize:I,asObject:y.browser.asObject,asObjectBindingsOnly:y.browser.asObjectBindingsOnly,formatters:y.browser.formatters,levels:U,timestamp:O(y),messageKey:y.messageKey||"msg",onChild:y.onChild||T};k.levels=h(y),k.level=j,k.isLevelEnabled=function(Y){return this.levels.values[Y]?this.levels.values[Y]>=this.levels.values[this.level]:!1},k.setMaxListeners=k.getMaxListeners=k.emit=k.addListener=k.on=k.prependListener=k.once=k.prependOnceListener=k.removeListener=k.removeAllListeners=k.listeners=k.listenerCount=k.eventNames=k.write=k.flush=T,k.serializers=S,k._serialize=I,k._stdErrSerialize=$,k.child=function(...Y){return W.call(this,M,...Y)},w&&(k._logEvent=x());function H(){return i(this.level,this)}function G(){return this._level}function J(Y){if(Y!=="silent"&&!this.levels.values[Y])throw Error("unknown level "+Y);this._level=Y,d(this,M,k,"error"),d(this,M,k,"fatal"),d(this,M,k,"warn"),d(this,M,k,"info"),d(this,M,k,"debug"),d(this,M,k,"trace"),C.forEach(te=>{d(this,M,k,te)})}function W(Y,te,le){if(!te)throw new Error("missing bindings for child Pino");le=le||{},I&&te.serializers&&(le.serializers=te.serializers);const pe=le.serializers;if(I&&pe){var we=Object.assign({},S,pe),at=y.browser.serialize===!0?Object.keys(we):I;delete te.serializers,_([te],at,we,this._stdErrSerialize)}function wt(Kr){this._childLevel=(Kr._childLevel|0)+1,this.bindings=te,we&&(this.serializers=we,this._serialize=at),w&&(this._logEvent=x([].concat(Kr._logEvent.bindings,te)))}wt.prototype=this;const xr=new wt(this);return a(this,xr),xr.child=function(...Kr){return W.call(this,Y,...Kr)},xr.level=le.level||this.level,Y.onChild(xr),xr}return k}function h(y){const w=y.customLevels||{},E=Object.assign({},l.levels.values,w),S=Object.assign({},l.levels.labels,f(w));return{values:E,labels:S}}function f(y){const w={};return Object.keys(y).forEach(function(E){w[y[E]]=E}),w}l.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},l.stdSerializers=r,l.stdTimeFunctions=Object.assign({},{nullTime:q,epochTime:F,unixTime:P,isoTime:A});function g(y){const w=[];y.bindings&&w.push(y.bindings);let E=y[n];for(;E.parent;)E=E.parent,E.logger.bindings&&w.push(E.logger.bindings);return w.reverse()}function d(y,w,E,S){if(Object.defineProperty(y,S,{value:i(y.level,E)>i(S,E)?T:E[s][S],writable:!0,enumerable:!0,configurable:!0}),y[S]===T){if(!w.transmit)return;const $=w.transmit.level||y.level,C=i($,E);if(i(S,E)<C)return}y[S]=b(y,w,E,S);const I=g(y);I.length!==0&&(y[S]=p(I,y[S]))}function p(y,w){return function(){return w.apply(this,[...y,...arguments])}}function b(y,w,E,S){return(function(I){return function(){const C=w.timestamp(),U=new Array(arguments.length),j=Object.getPrototypeOf&&Object.getPrototypeOf(this)===e?e:this;for(var k=0;k<U.length;k++)U[k]=arguments[k];var M=!1;if(w.serialize&&(_(U,this._serialize,this.serializers,this._stdErrSerialize),M=!0),w.asObject||w.formatters?I.call(j,...v(this,S,U,C,w)):I.apply(j,U),w.transmit){const H=w.transmit.level||y._level,G=i(H,E),J=i(S,E);if(J<G)return;m(this,{ts:C,methodLevel:S,methodValue:J,transmitValue:E.levels.values[w.transmit.level||y._level],send:w.transmit.send,val:i(y._level,E)},U,M)}}})(y[s][S])}function v(y,w,E,S,I){const{level:$,log:C=H=>H}=I.formatters||{},U=E.slice();let j=U[0];const k={};let M=(y._childLevel|0)+1;if(M<1&&(M=1),S&&(k.time=S),$){const H=$(w,y.levels.values[w]);Object.assign(k,H)}else k.level=y.levels.values[w];if(I.asObjectBindingsOnly){if(j!==null&&typeof j=="object")for(;M--&&typeof U[0]=="object";)Object.assign(k,U.shift());return[C(k),...U]}else{if(j!==null&&typeof j=="object"){for(;M--&&typeof U[0]=="object";)Object.assign(k,U.shift());j=U.length?t(U.shift(),U):void 0}else typeof j=="string"&&(j=t(U.shift(),U));return j!==void 0&&(k[I.messageKey]=j),[C(k)]}}function _(y,w,E,S){for(const I in y)if(S&&y[I]instanceof Error)y[I]=l.stdSerializers.err(y[I]);else if(typeof y[I]=="object"&&!Array.isArray(y[I])&&w)for(const $ in y[I])w.indexOf($)>-1&&$ in E&&(y[I][$]=E[$](y[I][$]))}function m(y,w,E,S=!1){const I=w.send,$=w.ts,C=w.methodLevel,U=w.methodValue,j=w.val,k=y._logEvent.bindings;S||_(E,y._serialize||Object.keys(y.serializers),y.serializers,y._stdErrSerialize===void 0?!0:y._stdErrSerialize),y._logEvent.ts=$,y._logEvent.messages=E.filter(function(M){return k.indexOf(M)===-1}),y._logEvent.level.label=C,y._logEvent.level.value=U,I(C,y._logEvent,j),y._logEvent=x(k)}function x(y){return{ts:0,messages:[],bindings:y||[],level:{label:"",value:0}}}function D(y){const w={type:y.constructor.name,msg:y.message,stack:y.stack};for(const E in y)w[E]===void 0&&(w[E]=y[E]);return w}function O(y){return typeof y.timestamp=="function"?y.timestamp:y.timestamp===!1?q:F}function N(){return{}}function R(y){return y}function T(){}function q(){return!1}function F(){return Date.now()}function P(){return Math.round(Date.now()/1e3)}function A(){return new Date(Date.now()).toISOString()}function B(){function y(w){return typeof w<"u"&&w}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return y(self)||y(window)||y(this)||{}}}return yi.exports.default=l,yi.exports.pino=l,yi.exports}var ei=Hp();const Kl=Fl(ei),Wp=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r);function cc(t){return typeof t=="string"?t:Wp(t)||""}const Gp={level:"info"},Ws="custom_context",ia=1e3*1024;var Yp=Object.defineProperty,Zp=(t,e,r)=>e in t?Yp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,dr=(t,e,r)=>Zp(t,typeof e!="symbol"?e+"":e,r);let Jp=class{constructor(e){dr(this,"nodeValue"),dr(this,"sizeInBytes"),dr(this,"next"),this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},uc=class{constructor(e){dr(this,"lengthInNodes"),dr(this,"sizeInBytes"),dr(this,"head"),dr(this,"tail"),dr(this,"maxSizeInBytes"),this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const r=new Jp(e);if(r.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${r.size}`);for(;this.size+r.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=r),this.tail=r):(this.head=r,this.tail=r),this.lengthInNodes++,this.sizeInBytes+=r.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let r=this.head;for(;r!==null;)e.push(r.value),r=r.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const r=e.value;return e=e.next,{done:!1,value:r}}}}};var Xp=Object.defineProperty,Qp=(t,e,r)=>e in t?Xp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ss=(t,e,r)=>Qp(t,typeof e!="symbol"?e+"":e,r);class Hl{constructor(e,r=ia){ss(this,"logs"),ss(this,"level"),ss(this,"levelValue"),ss(this,"MAX_LOG_SIZE_IN_BYTES"),this.level=e??"error",this.levelValue=ei.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=r,this.logs=new uc(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,r){r===ei.levels.values.error?console.error(e):r===ei.levels.values.warn?console.warn(e):r===ei.levels.values.debug?console.debug(e):r===ei.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(cc({timestamp:new Date().toISOString(),log:e}));const r=typeof e=="string"?JSON.parse(e).level:e.level;r>=this.levelValue&&this.forwardToConsole(e,r)}getLogs(){return this.logs}clearLogs(){this.logs=new uc(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const r=this.getLogArray();return r.push(cc({extraMetadata:e})),new Blob(r,{type:"application/json"})}}var eg=Object.defineProperty,tg=(t,e,r)=>e in t?eg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,rg=(t,e,r)=>tg(t,e+"",r);class ig{constructor(e,r=ia){rg(this,"baseChunkLogger"),this.baseChunkLogger=new Hl(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const r=URL.createObjectURL(this.logsToBlob(e)),i=document.createElement("a");i.href=r,i.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)}}var sg=Object.defineProperty,ng=(t,e,r)=>e in t?sg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,og=(t,e,r)=>ng(t,e+"",r);let ag=class{constructor(e,r=ia){og(this,"baseChunkLogger"),this.baseChunkLogger=new Hl(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}};var cg=Object.defineProperty,ug=Object.defineProperties,lg=Object.getOwnPropertyDescriptors,lc=Object.getOwnPropertySymbols,hg=Object.prototype.hasOwnProperty,fg=Object.prototype.propertyIsEnumerable,hc=(t,e,r)=>e in t?cg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,As=(t,e)=>{for(var r in e||(e={}))hg.call(e,r)&&hc(t,r,e[r]);if(lc)for(var r of lc(e))fg.call(e,r)&&hc(t,r,e[r]);return t},$s=(t,e)=>ug(t,lg(e));function dg(t){return $s(As({},t),{level:(t==null?void 0:t.level)||Gp.level})}function pg(t,e,r=Ws){return t[r]=e,t}function et(t,e=Ws){return t[e]||""}function gg(t,e,r=Ws){const i=et(t,r);return i.trim()?`${i}/${e}`:e}function ot(t,e,r=Ws){const i=gg(t,e,r),s=t.child({context:i});return pg(s,i,r)}function yg(t){var e,r;const i=new ig((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:Kl($s(As({},t.opts),{level:"trace",browser:$s(As({},(r=t.opts)==null?void 0:r.browser),{write:s=>i.write(s)})})),chunkLoggerController:i}}function wg(t){var e;const r=new ag((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:Kl($s(As({},t.opts),{level:"trace"}),r),chunkLoggerController:r}}function Wl(t){return typeof t.loggerOverride<"u"&&typeof t.loggerOverride!="string"?{logger:t.loggerOverride,chunkLoggerController:null}:typeof window<"u"?yg(t):wg(t)}var bg=Object.defineProperty,mg=(t,e,r)=>e in t?bg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,fc=(t,e,r)=>mg(t,typeof e!="symbol"?e+"":e,r);let vg=class extends Mr{constructor(e){super(),this.opts=e,fc(this,"protocol","wc"),fc(this,"version",2)}};var Eg=Object.defineProperty,xg=(t,e,r)=>e in t?Eg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ig=(t,e,r)=>xg(t,e+"",r);class _g extends Mr{constructor(e,r){super(),this.core=e,this.logger=r,Ig(this,"records",new Map)}}class Sg{constructor(e,r){this.logger=e,this.core=r}}class Dg extends Mr{constructor(e,r){super(),this.relayer=e,this.logger=r}}let Ag=class extends Mr{constructor(e){super()}},$g=class{constructor(e,r,i,s){this.core=e,this.logger=r,this.name=i}},Og=class extends Mr{constructor(e,r){super(),this.relayer=e,this.logger=r}},Bg=class extends Mr{constructor(e,r){super(),this.core=e,this.logger=r}},Tg=class{constructor(e,r,i){this.core=e,this.logger=r,this.store=i}},Pg=class{constructor(e,r){this.projectId=e,this.logger=r}},Ng=class{constructor(e,r,i){this.core=e,this.logger=r,this.telemetryEnabled=i}};var Cg=Object.defineProperty,Ug=(t,e,r)=>e in t?Cg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,dc=(t,e,r)=>Ug(t,typeof e!="symbol"?e+"":e,r);let Rg=class{constructor(e){this.opts=e,dc(this,"protocol","wc"),dc(this,"version",2)}},kg=class{constructor(e){this.client=e}};const Fg=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),Lg=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=t.replace(e,'$1"$2n"$3');return JSON.parse(r,(i,s)=>typeof s=="string"&&s.match(/^\d+n$/)?BigInt(s.substring(0,s.length-1)):s)};function pc(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return Lg(t)}catch{return t}}function Mg(t){return typeof t=="string"?t:Fg(t)||""}const qg=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),jg=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=t.replace(e,'$1"$2n"$3');return JSON.parse(r,(i,s)=>typeof s=="string"&&s.match(/^\d+n$/)?BigInt(s.substring(0,s.length-1)):s)};function zg(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return jg(t)}catch{return t}}function Vg(t){return typeof t=="string"?t:qg(t)||""}function Kg(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Gl(t,...e){if(!Kg(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function gc(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Hg(t,e){Gl(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const Wr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const xn=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function Wg(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function Yl(t){return typeof t=="string"&&(t=Wg(t)),Gl(t),t}let Gg=class{clone(){return this._cloneInto()}};function Yg(t){const e=i=>t().update(Yl(i)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function Zl(t=32){if(Wr&&typeof Wr.getRandomValues=="function")return Wr.getRandomValues(new Uint8Array(t));if(Wr&&typeof Wr.randomBytes=="function")return Wr.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function Zg(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const s=BigInt(32),n=BigInt(4294967295),o=Number(r>>s&n),a=Number(r&n),c=i?4:0,u=i?0:4;t.setUint32(e+c,o,i),t.setUint32(e+u,a,i)}let Jg=class extends Gg{constructor(e,r,i,s){super(),this.blockLen=e,this.outputLen=r,this.padOffset=i,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=xn(this.buffer)}update(e){gc(this);const{view:r,buffer:i,blockLen:s}=this;e=Yl(e);const n=e.length;for(let o=0;o<n;){const a=Math.min(s-this.pos,n-o);if(a===s){const c=xn(e);for(;s<=n-o;o+=s)this.process(c,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){gc(this),Hg(e,this),this.finished=!0;const{buffer:r,view:i,blockLen:s,isLE:n}=this;let{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(i,0),o=0);for(let h=o;h<s;h++)r[h]=0;Zg(i,s-8,BigInt(this.length*8),n),this.process(i,0);const a=xn(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)a.setUint32(4*h,l[h],n)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:i,length:s,finished:n,destroyed:o,pos:a}=this;return e.length=s,e.pos=a,e.finished=n,e.destroyed=o,s%r&&e.buffer.set(i),e}};const ns=BigInt(2**32-1),go=BigInt(32);function Jl(t,e=!1){return e?{h:Number(t&ns),l:Number(t>>go&ns)}:{h:Number(t>>go&ns)|0,l:Number(t&ns)|0}}function Xg(t,e=!1){let r=new Uint32Array(t.length),i=new Uint32Array(t.length);for(let s=0;s<t.length;s++){const{h:n,l:o}=Jl(t[s],e);[r[s],i[s]]=[n,o]}return[r,i]}const Qg=(t,e)=>BigInt(t>>>0)<<go|BigInt(e>>>0),e0=(t,e,r)=>t>>>r,t0=(t,e,r)=>t<<32-r|e>>>r,r0=(t,e,r)=>t>>>r|e<<32-r,i0=(t,e,r)=>t<<32-r|e>>>r,s0=(t,e,r)=>t<<64-r|e>>>r-32,n0=(t,e,r)=>t>>>r-32|e<<64-r,o0=(t,e)=>e,a0=(t,e)=>t,c0=(t,e,r)=>t<<r|e>>>32-r,u0=(t,e,r)=>e<<r|t>>>32-r,l0=(t,e,r)=>e<<r-32|t>>>64-r,h0=(t,e,r)=>t<<r-32|e>>>64-r;function f0(t,e,r,i){const s=(e>>>0)+(i>>>0);return{h:t+r+(s/2**32|0)|0,l:s|0}}const d0=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),p0=(t,e,r,i)=>e+r+i+(t/2**32|0)|0,g0=(t,e,r,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0),y0=(t,e,r,i,s)=>e+r+i+s+(t/2**32|0)|0,w0=(t,e,r,i,s)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0)+(s>>>0),b0=(t,e,r,i,s,n)=>e+r+i+s+n+(t/2**32|0)|0,X={fromBig:Jl,split:Xg,toBig:Qg,shrSH:e0,shrSL:t0,rotrSH:r0,rotrSL:i0,rotrBH:s0,rotrBL:n0,rotr32H:o0,rotr32L:a0,rotlSH:c0,rotlSL:u0,rotlBH:l0,rotlBL:h0,add:f0,add3L:d0,add3H:p0,add4L:g0,add4H:y0,add5H:b0,add5L:w0},[m0,v0]=X.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),Qt=new Uint32Array(80),er=new Uint32Array(80);let E0=class extends Jg{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:r,Bh:i,Bl:s,Ch:n,Cl:o,Dh:a,Dl:c,Eh:u,El:l,Fh:h,Fl:f,Gh:g,Gl:d,Hh:p,Hl:b}=this;return[e,r,i,s,n,o,a,c,u,l,h,f,g,d,p,b]}set(e,r,i,s,n,o,a,c,u,l,h,f,g,d,p,b){this.Ah=e|0,this.Al=r|0,this.Bh=i|0,this.Bl=s|0,this.Ch=n|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=l|0,this.Fh=h|0,this.Fl=f|0,this.Gh=g|0,this.Gl=d|0,this.Hh=p|0,this.Hl=b|0}process(e,r){for(let m=0;m<16;m++,r+=4)Qt[m]=e.getUint32(r),er[m]=e.getUint32(r+=4);for(let m=16;m<80;m++){const x=Qt[m-15]|0,D=er[m-15]|0,O=X.rotrSH(x,D,1)^X.rotrSH(x,D,8)^X.shrSH(x,D,7),N=X.rotrSL(x,D,1)^X.rotrSL(x,D,8)^X.shrSL(x,D,7),R=Qt[m-2]|0,T=er[m-2]|0,q=X.rotrSH(R,T,19)^X.rotrBH(R,T,61)^X.shrSH(R,T,6),F=X.rotrSL(R,T,19)^X.rotrBL(R,T,61)^X.shrSL(R,T,6),P=X.add4L(N,F,er[m-7],er[m-16]),A=X.add4H(P,O,q,Qt[m-7],Qt[m-16]);Qt[m]=A|0,er[m]=P|0}let{Ah:i,Al:s,Bh:n,Bl:o,Ch:a,Cl:c,Dh:u,Dl:l,Eh:h,El:f,Fh:g,Fl:d,Gh:p,Gl:b,Hh:v,Hl:_}=this;for(let m=0;m<80;m++){const x=X.rotrSH(h,f,14)^X.rotrSH(h,f,18)^X.rotrBH(h,f,41),D=X.rotrSL(h,f,14)^X.rotrSL(h,f,18)^X.rotrBL(h,f,41),O=h&g^~h&p,N=f&d^~f&b,R=X.add5L(_,D,N,v0[m],er[m]),T=X.add5H(R,v,x,O,m0[m],Qt[m]),q=R|0,F=X.rotrSH(i,s,28)^X.rotrBH(i,s,34)^X.rotrBH(i,s,39),P=X.rotrSL(i,s,28)^X.rotrBL(i,s,34)^X.rotrBL(i,s,39),A=i&n^i&a^n&a,B=s&o^s&c^o&c;v=p|0,_=b|0,p=g|0,b=d|0,g=h|0,d=f|0,{h,l:f}=X.add(u|0,l|0,T|0,q|0),u=a|0,l=c|0,a=n|0,c=o|0,n=i|0,o=s|0;const y=X.add3L(q,P,B);i=X.add3H(y,T,F,A),s=y|0}({h:i,l:s}=X.add(this.Ah|0,this.Al|0,i|0,s|0)),{h:n,l:o}=X.add(this.Bh|0,this.Bl|0,n|0,o|0),{h:a,l:c}=X.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l}=X.add(this.Dh|0,this.Dl|0,u|0,l|0),{h,l:f}=X.add(this.Eh|0,this.El|0,h|0,f|0),{h:g,l:d}=X.add(this.Fh|0,this.Fl|0,g|0,d|0),{h:p,l:b}=X.add(this.Gh|0,this.Gl|0,p|0,b|0),{h:v,l:_}=X.add(this.Hh|0,this.Hl|0,v|0,_|0),this.set(i,s,n,o,a,c,u,l,h,f,g,d,p,b,v,_)}roundClean(){Qt.fill(0),er.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const x0=Yg(()=>new E0);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const sa=BigInt(0),Xl=BigInt(1),I0=BigInt(2);function na(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function oa(t){if(!na(t))throw new Error("Uint8Array expected")}function In(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const _0=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function aa(t){oa(t);let e="";for(let r=0;r<t.length;r++)e+=_0[t[r]];return e}function Ql(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?sa:BigInt("0x"+t)}const Ut={_0:48,_9:57,A:65,F:70,a:97,f:102};function yc(t){if(t>=Ut._0&&t<=Ut._9)return t-Ut._0;if(t>=Ut.A&&t<=Ut.F)return t-(Ut.A-10);if(t>=Ut.a&&t<=Ut.f)return t-(Ut.a-10)}function eh(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(r);for(let s=0,n=0;s<r;s++,n+=2){const o=yc(t.charCodeAt(n)),a=yc(t.charCodeAt(n+1));if(o===void 0||a===void 0){const c=t[n]+t[n+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+n)}i[s]=o*16+a}return i}function S0(t){return Ql(aa(t))}function vs(t){return oa(t),Ql(aa(Uint8Array.from(t).reverse()))}function th(t,e){return eh(t.toString(16).padStart(e*2,"0"))}function yo(t,e){return th(t,e).reverse()}function Rt(t,e,r){let i;if(typeof e=="string")try{i=eh(e)}catch(n){throw new Error(t+" must be hex string or Uint8Array, cause: "+n)}else if(na(e))i=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const s=i.length;if(typeof r=="number"&&s!==r)throw new Error(t+" of length "+r+" expected, got "+s);return i}function wc(...t){let e=0;for(let i=0;i<t.length;i++){const s=t[i];oa(s),e+=s.length}const r=new Uint8Array(e);for(let i=0,s=0;i<t.length;i++){const n=t[i];r.set(n,s),s+=n.length}return r}const _n=t=>typeof t=="bigint"&&sa<=t;function D0(t,e,r){return _n(t)&&_n(e)&&_n(r)&&e<=t&&t<r}function wi(t,e,r,i){if(!D0(e,r,i))throw new Error("expected valid "+t+": "+r+" <= n < "+i+", got "+e)}function A0(t){let e;for(e=0;t>sa;t>>=Xl,e+=1);return e}const $0=t=>(I0<<BigInt(t-1))-Xl,O0={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||na(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function ca(t,e,r={}){const i=(s,n,o)=>{const a=O0[n];if(typeof a!="function")throw new Error("invalid validator function");const c=t[s];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(s)+" is invalid. Expected "+n+", got "+c)};for(const[s,n]of Object.entries(e))i(s,n,!1);for(const[s,n]of Object.entries(r))i(s,n,!0);return t}function bc(t){const e=new WeakMap;return(r,...i)=>{const s=e.get(r);if(s!==void 0)return s;const n=t(r,...i);return e.set(r,n),n}}const $e=BigInt(0),ye=BigInt(1),$r=BigInt(2),B0=BigInt(3),wo=BigInt(4),mc=BigInt(5),vc=BigInt(8);function xe(t,e){const r=t%e;return r>=$e?r:e+r}function T0(t,e,r){if(e<$e)throw new Error("invalid exponent, negatives unsupported");if(r<=$e)throw new Error("invalid modulus");if(r===ye)return $e;let i=ye;for(;e>$e;)e&ye&&(i=i*t%r),t=t*t%r,e>>=ye;return i}function Dt(t,e,r){let i=t;for(;e-- >$e;)i*=i,i%=r;return i}function Ec(t,e){if(t===$e)throw new Error("invert: expected non-zero number");if(e<=$e)throw new Error("invert: expected positive modulus, got "+e);let r=xe(t,e),i=e,s=$e,n=ye;for(;r!==$e;){const o=i/r,a=i%r,c=s-n*o;i=r,r=a,s=n,n=c}if(i!==ye)throw new Error("invert: does not exist");return xe(s,e)}function P0(t){const e=(t-ye)/$r;let r,i,s;for(r=t-ye,i=0;r%$r===$e;r/=$r,i++);for(s=$r;s<t&&T0(s,e,t)!==t-ye;s++)if(s>1e3)throw new Error("Cannot find square root: likely non-prime P");if(i===1){const o=(t+ye)/wo;return function(a,c){const u=a.pow(c,o);if(!a.eql(a.sqr(u),c))throw new Error("Cannot find square root");return u}}const n=(r+ye)/$r;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=i,u=o.pow(o.mul(o.ONE,s),r),l=o.pow(a,n),h=o.pow(a,r);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let f=1;for(let d=o.sqr(h);f<c&&!o.eql(d,o.ONE);f++)d=o.sqr(d);const g=o.pow(u,ye<<BigInt(c-f-1));u=o.sqr(g),l=o.mul(l,g),h=o.mul(h,u),c=f}return l}}function N0(t){if(t%wo===B0){const e=(t+ye)/wo;return function(r,i){const s=r.pow(i,e);if(!r.eql(r.sqr(s),i))throw new Error("Cannot find square root");return s}}if(t%vc===mc){const e=(t-mc)/vc;return function(r,i){const s=r.mul(i,$r),n=r.pow(s,e),o=r.mul(i,n),a=r.mul(r.mul(o,$r),n),c=r.mul(o,r.sub(a,r.ONE));if(!r.eql(r.sqr(c),i))throw new Error("Cannot find square root");return c}}return P0(t)}const C0=(t,e)=>(xe(t,e)&ye)===ye,U0=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function R0(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=U0.reduce((i,s)=>(i[s]="function",i),e);return ca(t,r)}function k0(t,e,r){if(r<$e)throw new Error("invalid exponent, negatives unsupported");if(r===$e)return t.ONE;if(r===ye)return e;let i=t.ONE,s=e;for(;r>$e;)r&ye&&(i=t.mul(i,s)),s=t.sqr(s),r>>=ye;return i}function F0(t,e){const r=new Array(e.length),i=e.reduce((n,o,a)=>t.is0(o)?n:(r[a]=n,t.mul(n,o)),t.ONE),s=t.inv(i);return e.reduceRight((n,o,a)=>t.is0(o)?n:(r[a]=t.mul(n,r[a]),t.mul(n,o)),s),r}function rh(t,e){const r=e!==void 0?e:t.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function ih(t,e,r=!1,i={}){if(t<=$e)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:s,nByteLength:n}=rh(t,e);if(n>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:s,BYTES:n,MASK:$0(s),ZERO:$e,ONE:ye,create:c=>xe(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return $e<=c&&c<t},is0:c=>c===$e,isOdd:c=>(c&ye)===ye,neg:c=>xe(-c,t),eql:(c,u)=>c===u,sqr:c=>xe(c*c,t),add:(c,u)=>xe(c+u,t),sub:(c,u)=>xe(c-u,t),mul:(c,u)=>xe(c*u,t),pow:(c,u)=>k0(a,c,u),div:(c,u)=>xe(c*Ec(u,t),t),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>Ec(c,t),sqrt:i.sqrt||(c=>(o||(o=N0(t)),o(a,c))),invertBatch:c=>F0(a,c),cmov:(c,u,l)=>l?u:c,toBytes:c=>r?yo(c,n):th(c,n),fromBytes:c=>{if(c.length!==n)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+c.length);return r?vs(c):S0(c)}});return Object.freeze(a)}const xc=BigInt(0),os=BigInt(1);function Sn(t,e){const r=e.negate();return t?r:e}function sh(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Dn(t,e){sh(t,e);const r=Math.ceil(e/t)+1,i=2**(t-1);return{windows:r,windowSize:i}}function L0(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,i)=>{if(!(r instanceof e))throw new Error("invalid point at index "+i)})}function M0(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,i)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+i)})}const An=new WeakMap,nh=new WeakMap;function $n(t){return nh.get(t)||1}function q0(t,e){return{constTimeNegate:Sn,hasPrecomputes(r){return $n(r)!==1},unsafeLadder(r,i,s=t.ZERO){let n=r;for(;i>xc;)i&os&&(s=s.add(n)),n=n.double(),i>>=os;return s},precomputeWindow(r,i){const{windows:s,windowSize:n}=Dn(i,e),o=[];let a=r,c=a;for(let u=0;u<s;u++){c=a,o.push(c);for(let l=1;l<n;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,i,s){const{windows:n,windowSize:o}=Dn(r,e);let a=t.ZERO,c=t.BASE;const u=BigInt(2**r-1),l=2**r,h=BigInt(r);for(let f=0;f<n;f++){const g=f*o;let d=Number(s&u);s>>=h,d>o&&(d-=l,s+=os);const p=g,b=g+Math.abs(d)-1,v=f%2!==0,_=d<0;d===0?c=c.add(Sn(v,i[p])):a=a.add(Sn(_,i[b]))}return{p:a,f:c}},wNAFUnsafe(r,i,s,n=t.ZERO){const{windows:o,windowSize:a}=Dn(r,e),c=BigInt(2**r-1),u=2**r,l=BigInt(r);for(let h=0;h<o;h++){const f=h*a;if(s===xc)break;let g=Number(s&c);if(s>>=l,g>a&&(g-=u,s+=os),g===0)continue;let d=i[f+Math.abs(g)-1];g<0&&(d=d.negate()),n=n.add(d)}return n},getPrecomputes(r,i,s){let n=An.get(i);return n||(n=this.precomputeWindow(i,r),r!==1&&An.set(i,s(n))),n},wNAFCached(r,i,s){const n=$n(r);return this.wNAF(n,this.getPrecomputes(n,r,s),i)},wNAFCachedUnsafe(r,i,s,n){const o=$n(r);return o===1?this.unsafeLadder(r,i,n):this.wNAFUnsafe(o,this.getPrecomputes(o,r,s),i,n)},setWindowSize(r,i){sh(i,e),nh.set(r,i),An.delete(r)}}}function j0(t,e,r,i){if(L0(r,t),M0(i,e),r.length!==i.length)throw new Error("arrays of points and scalars must have equal length");const s=t.ZERO,n=A0(BigInt(r.length)),o=n>12?n-3:n>4?n-2:n?2:1,a=(1<<o)-1,c=new Array(a+1).fill(s),u=Math.floor((e.BITS-1)/o)*o;let l=s;for(let h=u;h>=0;h-=o){c.fill(s);for(let g=0;g<i.length;g++){const d=i[g],p=Number(d>>BigInt(h)&BigInt(a));c[p]=c[p].add(r[g])}let f=s;for(let g=c.length-1,d=s;g>0;g--)d=d.add(c[g]),f=f.add(d);if(l=l.add(f),h!==0)for(let g=0;g<o;g++)l=l.double()}return l}function z0(t){return R0(t.Fp),ca(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...rh(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const bt=BigInt(0),Ve=BigInt(1),as=BigInt(2),V0=BigInt(8),K0={zip215:!0};function H0(t){const e=z0(t);return ca(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function W0(t){const e=H0(t),{Fp:r,n:i,prehash:s,hash:n,randomBytes:o,nByteLength:a,h:c}=e,u=as<<BigInt(a*8)-Ve,l=r.create,h=ih(e.n,e.nBitLength),f=e.uvRatio||((y,w)=>{try{return{isValid:!0,value:r.sqrt(y*r.inv(w))}}catch{return{isValid:!1,value:bt}}}),g=e.adjustScalarBytes||(y=>y),d=e.domain||((y,w,E)=>{if(In("phflag",E),w.length||E)throw new Error("Contexts/pre-hash are not supported");return y});function p(y,w){wi("coordinate "+y,w,bt,u)}function b(y){if(!(y instanceof m))throw new Error("ExtendedPoint expected")}const v=bc((y,w)=>{const{ex:E,ey:S,ez:I}=y,$=y.is0();w==null&&(w=$?V0:r.inv(I));const C=l(E*w),U=l(S*w),j=l(I*w);if($)return{x:bt,y:Ve};if(j!==Ve)throw new Error("invZ was invalid");return{x:C,y:U}}),_=bc(y=>{const{a:w,d:E}=e;if(y.is0())throw new Error("bad point: ZERO");const{ex:S,ey:I,ez:$,et:C}=y,U=l(S*S),j=l(I*I),k=l($*$),M=l(k*k),H=l(U*w),G=l(k*l(H+j)),J=l(M+l(E*l(U*j)));if(G!==J)throw new Error("bad point: equation left != right (1)");const W=l(S*I),Y=l($*C);if(W!==Y)throw new Error("bad point: equation left != right (2)");return!0});class m{constructor(w,E,S,I){this.ex=w,this.ey=E,this.ez=S,this.et=I,p("x",w),p("y",E),p("z",S),p("t",I),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(w){if(w instanceof m)throw new Error("extended point not allowed");const{x:E,y:S}=w||{};return p("x",E),p("y",S),new m(E,S,Ve,l(E*S))}static normalizeZ(w){const E=r.invertBatch(w.map(S=>S.ez));return w.map((S,I)=>S.toAffine(E[I])).map(m.fromAffine)}static msm(w,E){return j0(m,h,w,E)}_setWindowSize(w){O.setWindowSize(this,w)}assertValidity(){_(this)}equals(w){b(w);const{ex:E,ey:S,ez:I}=this,{ex:$,ey:C,ez:U}=w,j=l(E*U),k=l($*I),M=l(S*U),H=l(C*I);return j===k&&M===H}is0(){return this.equals(m.ZERO)}negate(){return new m(l(-this.ex),this.ey,this.ez,l(-this.et))}double(){const{a:w}=e,{ex:E,ey:S,ez:I}=this,$=l(E*E),C=l(S*S),U=l(as*l(I*I)),j=l(w*$),k=E+S,M=l(l(k*k)-$-C),H=j+C,G=H-U,J=j-C,W=l(M*G),Y=l(H*J),te=l(M*J),le=l(G*H);return new m(W,Y,le,te)}add(w){b(w);const{a:E,d:S}=e,{ex:I,ey:$,ez:C,et:U}=this,{ex:j,ey:k,ez:M,et:H}=w;if(E===BigInt(-1)){const Fa=l(($-I)*(k+j)),La=l(($+I)*(k-j)),dn=l(La-Fa);if(dn===bt)return this.double();const Ma=l(C*as*H),qa=l(U*as*M),ja=qa+Ma,za=La+Fa,Va=qa-Ma,Kd=l(ja*dn),Hd=l(za*Va),Wd=l(ja*Va),Gd=l(dn*za);return new m(Kd,Hd,Gd,Wd)}const G=l(I*j),J=l($*k),W=l(U*S*H),Y=l(C*M),te=l((I+$)*(j+k)-G-J),le=Y-W,pe=Y+W,we=l(J-E*G),at=l(te*le),wt=l(pe*we),xr=l(te*we),Kr=l(le*pe);return new m(at,wt,Kr,xr)}subtract(w){return this.add(w.negate())}wNAF(w){return O.wNAFCached(this,w,m.normalizeZ)}multiply(w){const E=w;wi("scalar",E,Ve,i);const{p:S,f:I}=this.wNAF(E);return m.normalizeZ([S,I])[0]}multiplyUnsafe(w,E=m.ZERO){const S=w;return wi("scalar",S,bt,i),S===bt?D:this.is0()||S===Ve?this:O.wNAFCachedUnsafe(this,S,m.normalizeZ,E)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return O.unsafeLadder(this,i).is0()}toAffine(w){return v(this,w)}clearCofactor(){const{h:w}=e;return w===Ve?this:this.multiplyUnsafe(w)}static fromHex(w,E=!1){const{d:S,a:I}=e,$=r.BYTES;w=Rt("pointHex",w,$),In("zip215",E);const C=w.slice(),U=w[$-1];C[$-1]=U&-129;const j=vs(C),k=E?u:r.ORDER;wi("pointHex.y",j,bt,k);const M=l(j*j),H=l(M-Ve),G=l(S*M-I);let{isValid:J,value:W}=f(H,G);if(!J)throw new Error("Point.fromHex: invalid y coordinate");const Y=(W&Ve)===Ve,te=(U&128)!==0;if(!E&&W===bt&&te)throw new Error("Point.fromHex: x=0 and x_0=1");return te!==Y&&(W=l(-W)),m.fromAffine({x:W,y:j})}static fromPrivateKey(w){return T(w).point}toRawBytes(){const{x:w,y:E}=this.toAffine(),S=yo(E,r.BYTES);return S[S.length-1]|=w&Ve?128:0,S}toHex(){return aa(this.toRawBytes())}}m.BASE=new m(e.Gx,e.Gy,Ve,l(e.Gx*e.Gy)),m.ZERO=new m(bt,Ve,Ve,bt);const{BASE:x,ZERO:D}=m,O=q0(m,a*8);function N(y){return xe(y,i)}function R(y){return N(vs(y))}function T(y){const w=r.BYTES;y=Rt("private key",y,w);const E=Rt("hashed private key",n(y),2*w),S=g(E.slice(0,w)),I=E.slice(w,2*w),$=R(S),C=x.multiply($),U=C.toRawBytes();return{head:S,prefix:I,scalar:$,point:C,pointBytes:U}}function q(y){return T(y).pointBytes}function F(y=new Uint8Array,...w){const E=wc(...w);return R(n(d(E,Rt("context",y),!!s)))}function P(y,w,E={}){y=Rt("message",y),s&&(y=s(y));const{prefix:S,scalar:I,pointBytes:$}=T(w),C=F(E.context,S,y),U=x.multiply(C).toRawBytes(),j=F(E.context,U,$,y),k=N(C+j*I);wi("signature.s",k,bt,i);const M=wc(U,yo(k,r.BYTES));return Rt("result",M,r.BYTES*2)}const A=K0;function B(y,w,E,S=A){const{context:I,zip215:$}=S,C=r.BYTES;y=Rt("signature",y,2*C),w=Rt("message",w),E=Rt("publicKey",E,C),$!==void 0&&In("zip215",$),s&&(w=s(w));const U=vs(y.slice(C,2*C));let j,k,M;try{j=m.fromHex(E,$),k=m.fromHex(y.slice(0,C),$),M=x.multiplyUnsafe(U)}catch{return!1}if(!$&&j.isSmallOrder())return!1;const H=F(I,k.toRawBytes(),j.toRawBytes(),w);return k.add(j.multiplyUnsafe(H)).subtract(M).clearCofactor().equals(m.ZERO)}return x._setWindowSize(8),{CURVE:e,getPublicKey:q,sign:P,verify:B,ExtendedPoint:m,utils:{getExtendedPublicKey:T,randomPrivateKey:()=>o(r.BYTES),precompute(y=8,w=m.BASE){return w._setWindowSize(y),w.multiply(BigInt(3)),w}}}}BigInt(0),BigInt(1);const ua=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Ic=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const G0=BigInt(1),_c=BigInt(2);BigInt(3);const Y0=BigInt(5),Z0=BigInt(8);function J0(t){const e=BigInt(10),r=BigInt(20),i=BigInt(40),s=BigInt(80),n=ua,o=t*t%n*t%n,a=Dt(o,_c,n)*o%n,c=Dt(a,G0,n)*t%n,u=Dt(c,Y0,n)*c%n,l=Dt(u,e,n)*u%n,h=Dt(l,r,n)*l%n,f=Dt(h,i,n)*h%n,g=Dt(f,s,n)*f%n,d=Dt(g,s,n)*f%n,p=Dt(d,e,n)*u%n;return{pow_p_5_8:Dt(p,_c,n)*t%n,b2:o}}function X0(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function Q0(t,e){const r=ua,i=xe(e*e*e,r),s=xe(i*i*e,r),n=J0(t*s).pow_p_5_8;let o=xe(t*i*n,r);const a=xe(e*o*o,r),c=o,u=xe(o*Ic,r),l=a===t,h=a===xe(-t,r),f=a===xe(-t*Ic,r);return l&&(o=c),(h||f)&&(o=u),C0(o,r)&&(o=xe(-o,r)),{isValid:l||h,value:o}}const ey=ih(ua,void 0,!0),ty={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:ey,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:Z0,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:x0,randomBytes:Zl,adjustScalarBytes:X0,uvRatio:Q0},oh=W0(ty),ry="EdDSA",iy="JWT",Os=".",Gs="base64url",ah="utf8",ch="utf8",sy=":",ny="did",oy="key",Sc="base58btc",ay="z",cy="K36",uy=32;function la(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function uh(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?la(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function lh(t,e){e||(e=t.reduce((s,n)=>s+n.length,0));const r=uh(e);let i=0;for(const s of t)r.set(s,i),i+=s.length;return la(r)}function ly(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var s=0;s<t.length;s++){var n=t.charAt(s),o=n.charCodeAt(0);if(r[o]!==255)throw new TypeError(n+" is ambiguous");r[o]=s}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,b=0,v=0,_=d.length;v!==_&&d[v]===0;)v++,p++;for(var m=(_-v)*l+1>>>0,x=new Uint8Array(m);v!==_;){for(var D=d[v],O=0,N=m-1;(D!==0||O<b)&&N!==-1;N--,O++)D+=256*x[N]>>>0,x[N]=D%a>>>0,D=D/a>>>0;if(D!==0)throw new Error("Non-zero carry");b=O,v++}for(var R=m-b;R!==m&&x[R]===0;)R++;for(var T=c.repeat(p);R<m;++R)T+=t.charAt(x[R]);return T}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var p=0;if(d[p]!==" "){for(var b=0,v=0;d[p]===c;)b++,p++;for(var _=(d.length-p)*u+1>>>0,m=new Uint8Array(_);d[p];){var x=r[d.charCodeAt(p)];if(x===255)return;for(var D=0,O=_-1;(x!==0||D<v)&&O!==-1;O--,D++)x+=a*m[O]>>>0,m[O]=x%256>>>0,x=x/256>>>0;if(x!==0)throw new Error("Non-zero carry");v=D,p++}if(d[p]!==" "){for(var N=_-v;N!==_&&m[N]===0;)N++;for(var R=new Uint8Array(b+(_-N)),T=b;N!==_;)R[T++]=m[N++];return R}}}function g(d){var p=f(d);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:g}}var hy=ly,fy=hy;const hh=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},dy=t=>new TextEncoder().encode(t),py=t=>new TextDecoder().decode(t);let gy=class{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},yy=class{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return fh(this,e)}},wy=class{constructor(e){this.decoders=e}or(e){return fh(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const fh=(t,e)=>new wy({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});let by=class{constructor(e,r,i,s){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=s,this.encoder=new gy(e,r,i),this.decoder=new yy(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const Ys=({name:t,prefix:e,encode:r,decode:i})=>new by(t,e,r,i),Ki=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:s}=fy(r,e);return Ys({prefix:t,name:e,encode:i,decode:n=>hh(s(n))})},my=(t,e,r,i)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let n=t.length;for(;t[n-1]==="=";)--n;const o=new Uint8Array(n*r/8|0);let a=0,c=0,u=0;for(let l=0;l<n;++l){const h=s[t[l]];if(h===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},vy=(t,e,r)=>{const i=e[e.length-1]==="=",s=(1<<r)-1;let n="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,n+=e[s&a>>o];if(o&&(n+=e[s&a<<r-o]),i)for(;n.length*r&7;)n+="=";return n},Pe=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>Ys({prefix:e,name:t,encode(s){return vy(s,i,r)},decode(s){return my(s,i,r,t)}}),Ey=Ys({prefix:"\0",name:"identity",encode:t=>py(t),decode:t=>dy(t)});var xy=Object.freeze({__proto__:null,identity:Ey});const Iy=Pe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var _y=Object.freeze({__proto__:null,base2:Iy});const Sy=Pe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Dy=Object.freeze({__proto__:null,base8:Sy});const Ay=Ki({prefix:"9",name:"base10",alphabet:"0123456789"});var $y=Object.freeze({__proto__:null,base10:Ay});const Oy=Pe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),By=Pe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Ty=Object.freeze({__proto__:null,base16:Oy,base16upper:By});const Py=Pe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Ny=Pe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Cy=Pe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Uy=Pe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Ry=Pe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ky=Pe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Fy=Pe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Ly=Pe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),My=Pe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var qy=Object.freeze({__proto__:null,base32:Py,base32upper:Ny,base32pad:Cy,base32padupper:Uy,base32hex:Ry,base32hexupper:ky,base32hexpad:Fy,base32hexpadupper:Ly,base32z:My});const jy=Ki({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),zy=Ki({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Vy=Object.freeze({__proto__:null,base36:jy,base36upper:zy});const Ky=Ki({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Hy=Ki({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Wy=Object.freeze({__proto__:null,base58btc:Ky,base58flickr:Hy});const Gy=Pe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Yy=Pe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Zy=Pe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Jy=Pe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Xy=Object.freeze({__proto__:null,base64:Gy,base64pad:Yy,base64url:Zy,base64urlpad:Jy});const dh=Array.from(""),Qy=dh.reduce((t,e,r)=>(t[r]=e,t),[]),ew=dh.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function tw(t){return t.reduce((e,r)=>(e+=Qy[r],e),"")}function rw(t){const e=[];for(const r of t){const i=ew[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const iw=Ys({prefix:"",name:"base256emoji",encode:tw,decode:rw});var sw=Object.freeze({__proto__:null,base256emoji:iw}),nw=ph,Dc=128,ow=-128,aw=Math.pow(2,31);function ph(t,e,r){e=e||[],r=r||0;for(var i=r;t>=aw;)e[r++]=t&255|Dc,t/=128;for(;t&ow;)e[r++]=t&255|Dc,t>>>=7;return e[r]=t|0,ph.bytes=r-i+1,e}var cw=bo,uw=128,Ac=127;function bo(t,i){var r=0,i=i||0,s=0,n=i,o,a=t.length;do{if(n>=a)throw bo.bytes=0,new RangeError("Could not decode varint");o=t[n++],r+=s<28?(o&Ac)<<s:(o&Ac)*Math.pow(2,s),s+=7}while(o>=uw);return bo.bytes=n-i,r}var lw=Math.pow(2,7),hw=Math.pow(2,14),fw=Math.pow(2,21),dw=Math.pow(2,28),pw=Math.pow(2,35),gw=Math.pow(2,42),yw=Math.pow(2,49),ww=Math.pow(2,56),bw=Math.pow(2,63),mw=function(t){return t<lw?1:t<hw?2:t<fw?3:t<dw?4:t<pw?5:t<gw?6:t<yw?7:t<ww?8:t<bw?9:10},vw={encode:nw,decode:cw,encodingLength:mw},gh=vw;const $c=(t,e,r=0)=>(gh.encode(t,e,r),e),Oc=t=>gh.encodingLength(t),mo=(t,e)=>{const r=e.byteLength,i=Oc(t),s=i+Oc(r),n=new Uint8Array(s+r);return $c(t,n,0),$c(r,n,i),n.set(e,s),new Ew(t,r,e,n)};let Ew=class{constructor(e,r,i,s){this.code=e,this.size=r,this.digest=i,this.bytes=s}};const yh=({name:t,code:e,encode:r})=>new xw(t,e,r);let xw=class{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?mo(this.code,r):r.then(i=>mo(this.code,i))}else throw Error("Unknown type, must be binary type")}};const wh=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Iw=yh({name:"sha2-256",code:18,encode:wh("SHA-256")}),_w=yh({name:"sha2-512",code:19,encode:wh("SHA-512")});var Sw=Object.freeze({__proto__:null,sha256:Iw,sha512:_w});const bh=0,Dw="identity",mh=hh,Aw=t=>mo(bh,mh(t)),$w={code:bh,name:Dw,encode:mh,digest:Aw};var Ow=Object.freeze({__proto__:null,identity:$w});new TextEncoder,new TextDecoder;const Bc={...xy,..._y,...Dy,...$y,...Ty,...qy,...Vy,...Wy,...Xy,...sw};({...Sw,...Ow});function vh(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const Tc=vh("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),On=vh("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=uh(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Eh={utf8:Tc,"utf-8":Tc,hex:Bc.base16,latin1:On,ascii:On,binary:On,...Bc};function Zs(t,e="utf8"){const r=Eh[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function hi(t,e="utf8"){const r=Eh[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?la(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function Pc(t){return zg(Zs(hi(t,Gs),ah))}function Bs(t){return Zs(hi(Vg(t),ah),Gs)}function xh(t){const e=hi(cy,Sc),r=ay+Zs(lh([e,t]),Sc);return[ny,oy,r].join(sy)}function Bw(t){return Zs(t,Gs)}function Tw(t){return hi(t,Gs)}function Pw(t){return hi([Bs(t.header),Bs(t.payload)].join(Os),ch)}function Nw(t){return[Bs(t.header),Bs(t.payload),Bw(t.signature)].join(Os)}function vo(t){const e=t.split(Os),r=Pc(e[0]),i=Pc(e[1]),s=Tw(e[2]),n=hi(e.slice(0,2).join(Os),ch);return{header:r,payload:i,signature:s,data:n}}function Nc(t=Zl(uy)){const e=oh.getPublicKey(t);return{secretKey:lh([t,e]),publicKey:e}}async function Cw(t,e,r,i,s=V.fromMiliseconds(Date.now())){const n={alg:ry,typ:iy},o=xh(i.publicKey),a=s+r,c={iss:o,sub:t,aud:e,iat:s,exp:a},u=Pw({header:n,payload:c}),l=oh.sign(u,i.secretKey.slice(0,32));return Nw({header:n,payload:c,signature:l})}var Cc=function(t,e,r){if(r||arguments.length===2)for(var i=0,s=e.length,n;i<s;i++)(n||!(i in e))&&(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},Uw=(function(){function t(e,r,i){this.name=e,this.version=r,this.os=i,this.type="browser"}return t})(),Rw=(function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=Gt.platform}return t})(),kw=(function(){function t(e,r,i,s){this.name=e,this.version=r,this.os=i,this.bot=s,this.type="bot-device"}return t})(),Fw=(function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t})(),Lw=(function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t})(),Mw=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,qw=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Uc=3,jw=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",Mw]],Rc=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function zw(t){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new Lw:typeof navigator<"u"?Kw(navigator.userAgent):Ww()}function Vw(t){return t!==""&&jw.reduce(function(e,r){var i=r[0],s=r[1];if(e)return e;var n=s.exec(t);return!!n&&[i,n]},!1)}function Kw(t){var e=Vw(t);if(!e)return null;var r=e[0],i=e[1];if(r==="searchbot")return new Fw;var s=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);s?s.length<Uc&&(s=Cc(Cc([],s,!0),Gw(Uc-s.length),!0)):s=[];var n=s.join("."),o=Hw(t),a=qw.exec(t);return a&&a[1]?new kw(r,n,o,a[1]):new Uw(r,n,o)}function Hw(t){for(var e=0,r=Rc.length;e<r;e++){var i=Rc[e],s=i[0],n=i[1],o=n.exec(t);if(o)return s}return null}function Ww(){var t=typeof Gt<"u"&&Gt.version;return t?new Rw(Gt.version.slice(1)):null}function Gw(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var ae={},kc;function Ih(){if(kc)return ae;kc=1,Object.defineProperty(ae,"__esModule",{value:!0}),ae.getLocalStorage=ae.getLocalStorageOrThrow=ae.getCrypto=ae.getCryptoOrThrow=ae.getLocation=ae.getLocationOrThrow=ae.getNavigator=ae.getNavigatorOrThrow=ae.getDocument=ae.getDocumentOrThrow=ae.getFromWindowOrThrow=ae.getFromWindow=void 0;function t(f){let g;return typeof window<"u"&&typeof window[f]<"u"&&(g=window[f]),g}ae.getFromWindow=t;function e(f){const g=t(f);if(!g)throw new Error(`${f} is not defined in Window`);return g}ae.getFromWindowOrThrow=e;function r(){return e("document")}ae.getDocumentOrThrow=r;function i(){return t("document")}ae.getDocument=i;function s(){return e("navigator")}ae.getNavigatorOrThrow=s;function n(){return t("navigator")}ae.getNavigator=n;function o(){return e("location")}ae.getLocationOrThrow=o;function a(){return t("location")}ae.getLocation=a;function c(){return e("crypto")}ae.getCryptoOrThrow=c;function u(){return t("crypto")}ae.getCrypto=u;function l(){return e("localStorage")}ae.getLocalStorageOrThrow=l;function h(){return t("localStorage")}return ae.getLocalStorage=h,ae}var Zt=Ih(),bi={},Fc;function Yw(){if(Fc)return bi;Fc=1,Object.defineProperty(bi,"__esModule",{value:!0}),bi.getWindowMetadata=void 0;const t=Ih();function e(){let r,i;try{r=t.getDocumentOrThrow(),i=t.getLocationOrThrow()}catch{return null}function s(){const g=r.getElementsByTagName("link"),d=[];for(let p=0;p<g.length;p++){const b=g[p],v=b.getAttribute("rel");if(v&&v.toLowerCase().indexOf("icon")>-1){const _=b.getAttribute("href");if(_)if(_.toLowerCase().indexOf("https:")===-1&&_.toLowerCase().indexOf("http:")===-1&&_.indexOf("//")!==0){let m=i.protocol+"//"+i.host;if(_.indexOf("/")===0)m+=_;else{const x=i.pathname.split("/");x.pop();const D=x.join("/");m+=D+"/"+_}d.push(m)}else if(_.indexOf("//")===0){const m=i.protocol+_;d.push(m)}else d.push(_)}}return d}function n(...g){const d=r.getElementsByTagName("meta");for(let p=0;p<d.length;p++){const b=d[p],v=["itemprop","property","name"].map(_=>b.getAttribute(_)).filter(_=>_?g.includes(_):!1);if(v.length&&v){const _=b.getAttribute("content");if(_)return _}}return""}function o(){let g=n("name","og:site_name","og:title","twitter:title");return g||(g=r.title),g}function a(){return n("description","og:description","twitter:description","keywords")}const c=o(),u=a(),l=i.origin,h=s();return{description:u,url:l,icons:h,name:c}}return bi.getWindowMetadata=e,bi}var Zw=Yw();const Jw="0.1.1";function Xw(){return Jw}class fe extends Error{constructor(e,r={}){const i=(()=>{var c;if(r.cause instanceof fe){if(r.cause.details)return r.cause.details;if(r.cause.shortMessage)return r.cause.shortMessage}return r.cause&&"details"in r.cause&&typeof r.cause.details=="string"?r.cause.details:(c=r.cause)!=null&&c.message?r.cause.message:r.details})(),s=r.cause instanceof fe&&r.cause.docsPath||r.docsPath,o=`https://oxlib.sh${s??""}`,a=[e||"An error occurred.",...r.metaMessages?["",...r.metaMessages]:[],...i||s?["",i?`Details: ${i}`:void 0,s?`See: ${o}`:void 0]:[]].filter(c=>typeof c=="string").join(`
`);super(a,r.cause?{cause:r.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:`ox@${Xw()}`}),this.cause=r.cause,this.details=i,this.docs=o,this.docsPath=s,this.shortMessage=e}walk(e){return _h(this,e)}}function _h(t,e){return e!=null&&e(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause?_h(t.cause,e):e?null:t}const Gr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Qw(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function ki(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function kr(t,...e){if(!Qw(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function eb(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");ki(t.outputLen),ki(t.blockLen)}function oi(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Sh(t,e){kr(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function tb(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function ai(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function Bn(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function At(t,e){return t<<32-e|t>>>e}const rb=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function ib(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function sb(t){for(let e=0;e<t.length;e++)t[e]=ib(t[e]);return t}const Lc=rb?t=>t:sb;function nb(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Js(t){return typeof t=="string"&&(t=nb(t)),kr(t),t}function ob(...t){let e=0;for(let i=0;i<t.length;i++){const s=t[i];kr(s),e+=s.length}const r=new Uint8Array(e);for(let i=0,s=0;i<t.length;i++){const n=t[i];r.set(n,s),s+=n.length}return r}class ha{}function Dh(t){const e=i=>t().update(Js(i)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function ab(t=32){if(Gr&&typeof Gr.getRandomValues=="function")return Gr.getRandomValues(new Uint8Array(t));if(Gr&&typeof Gr.randomBytes=="function")return Uint8Array.from(Gr.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}function cb(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const s=BigInt(32),n=BigInt(4294967295),o=Number(r>>s&n),a=Number(r&n),c=i?4:0,u=i?0:4;t.setUint32(e+c,o,i),t.setUint32(e+u,a,i)}function ub(t,e,r){return t&e^~t&r}function lb(t,e,r){return t&e^t&r^e&r}class hb extends ha{constructor(e,r,i,s){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=i,this.isLE=s,this.buffer=new Uint8Array(e),this.view=Bn(this.buffer)}update(e){oi(this),e=Js(e),kr(e);const{view:r,buffer:i,blockLen:s}=this,n=e.length;for(let o=0;o<n;){const a=Math.min(s-this.pos,n-o);if(a===s){const c=Bn(e);for(;s<=n-o;o+=s)this.process(c,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){oi(this),Sh(e,this),this.finished=!0;const{buffer:r,view:i,blockLen:s,isLE:n}=this;let{pos:o}=this;r[o++]=128,ai(this.buffer.subarray(o)),this.padOffset>s-o&&(this.process(i,0),o=0);for(let h=o;h<s;h++)r[h]=0;cb(i,s-8,BigInt(this.length*8),n),this.process(i,0);const a=Bn(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)a.setUint32(4*h,l[h],n)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:i,length:s,finished:n,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=n,e.length=s,e.pos=a,s%r&&e.buffer.set(i),e}clone(){return this._cloneInto()}}const tr=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),cs=BigInt(2**32-1),Mc=BigInt(32);function fb(t,e=!1){return e?{h:Number(t&cs),l:Number(t>>Mc&cs)}:{h:Number(t>>Mc&cs)|0,l:Number(t&cs)|0}}function db(t,e=!1){const r=t.length;let i=new Uint32Array(r),s=new Uint32Array(r);for(let n=0;n<r;n++){const{h:o,l:a}=fb(t[n],e);[i[n],s[n]]=[o,a]}return[i,s]}const pb=(t,e,r)=>t<<r|e>>>32-r,gb=(t,e,r)=>e<<r|t>>>32-r,yb=(t,e,r)=>e<<r-32|t>>>64-r,wb=(t,e,r)=>t<<r-32|e>>>64-r,bb=BigInt(0),mi=BigInt(1),mb=BigInt(2),vb=BigInt(7),Eb=BigInt(256),xb=BigInt(113),Ah=[],$h=[],Oh=[];for(let t=0,e=mi,r=1,i=0;t<24;t++){[r,i]=[i,(2*r+3*i)%5],Ah.push(2*(5*i+r)),$h.push((t+1)*(t+2)/2%64);let s=bb;for(let n=0;n<7;n++)e=(e<<mi^(e>>vb)*xb)%Eb,e&mb&&(s^=mi<<(mi<<BigInt(n))-mi);Oh.push(s)}const Bh=db(Oh,!0),Ib=Bh[0],_b=Bh[1],qc=(t,e,r)=>r>32?yb(t,e,r):pb(t,e,r),jc=(t,e,r)=>r>32?wb(t,e,r):gb(t,e,r);function Sb(t,e=24){const r=new Uint32Array(10);for(let i=24-e;i<24;i++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,u=r[c],l=r[c+1],h=qc(u,l,1)^r[a],f=jc(u,l,1)^r[a+1];for(let g=0;g<50;g+=10)t[o+g]^=h,t[o+g+1]^=f}let s=t[2],n=t[3];for(let o=0;o<24;o++){const a=$h[o],c=qc(s,n,a),u=jc(s,n,a),l=Ah[o];s=t[l],n=t[l+1],t[l]=c,t[l+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=Ib[i],t[1]^=_b[i]}ai(r)}class fa extends ha{constructor(e,r,i,s=!1,n=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=i,this.enableXOF=s,this.rounds=n,ki(i),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=tb(this.state)}clone(){return this._cloneInto()}keccak(){Lc(this.state32),Sb(this.state32,this.rounds),Lc(this.state32),this.posOut=0,this.pos=0}update(e){oi(this),e=Js(e),kr(e);const{blockLen:r,state:i}=this,s=e.length;for(let n=0;n<s;){const o=Math.min(r-this.pos,s-n);for(let a=0;a<o;a++)i[this.pos++]^=e[n++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:i,blockLen:s}=this;e[i]^=r,(r&128)!==0&&i===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){oi(this,!1),kr(e),this.finish();const r=this.state,{blockLen:i}=this;for(let s=0,n=e.length;s<n;){this.posOut>=i&&this.keccak();const o=Math.min(i-this.posOut,n-s);e.set(r.subarray(this.posOut,this.posOut+o),s),this.posOut+=o,s+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return ki(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Sh(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,ai(this.state)}_cloneInto(e){const{blockLen:r,suffix:i,outputLen:s,rounds:n,enableXOF:o}=this;return e||(e=new fa(r,i,s,o,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=i,e.outputLen=s,e.enableXOF=o,e.destroyed=this.destroyed,e}}const Db=(t,e,r)=>Dh(()=>new fa(e,t,r)),Ab=Db(1,136,256/8),$b=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),rr=new Uint32Array(64);class Ob extends hb{constructor(e=32){super(64,e,8,!1),this.A=tr[0]|0,this.B=tr[1]|0,this.C=tr[2]|0,this.D=tr[3]|0,this.E=tr[4]|0,this.F=tr[5]|0,this.G=tr[6]|0,this.H=tr[7]|0}get(){const{A:e,B:r,C:i,D:s,E:n,F:o,G:a,H:c}=this;return[e,r,i,s,n,o,a,c]}set(e,r,i,s,n,o,a,c){this.A=e|0,this.B=r|0,this.C=i|0,this.D=s|0,this.E=n|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let h=0;h<16;h++,r+=4)rr[h]=e.getUint32(r,!1);for(let h=16;h<64;h++){const f=rr[h-15],g=rr[h-2],d=At(f,7)^At(f,18)^f>>>3,p=At(g,17)^At(g,19)^g>>>10;rr[h]=p+rr[h-7]+d+rr[h-16]|0}let{A:i,B:s,C:n,D:o,E:a,F:c,G:u,H:l}=this;for(let h=0;h<64;h++){const f=At(a,6)^At(a,11)^At(a,25),g=l+f+ub(a,c,u)+$b[h]+rr[h]|0,p=(At(i,2)^At(i,13)^At(i,22))+lb(i,s,n)|0;l=u,u=c,c=a,a=o+g|0,o=n,n=s,s=i,i=g+p|0}i=i+this.A|0,s=s+this.B|0,n=n+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(i,s,n,o,a,c,u,l)}roundClean(){ai(rr)}destroy(){this.set(0,0,0,0,0,0,0,0),ai(this.buffer)}}const Bb=Dh(()=>new Ob);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const da=BigInt(0),Eo=BigInt(1);function Hi(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function pa(t){if(!Hi(t))throw new Error("Uint8Array expected")}function Fi(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}function us(t){const e=t.toString(16);return e.length&1?"0"+e:e}function Th(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?da:BigInt("0x"+t)}const Ph=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",Tb=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Li(t){if(pa(t),Ph)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=Tb[t[r]];return e}const kt={_0:48,_9:57,A:65,F:70,a:97,f:102};function zc(t){if(t>=kt._0&&t<=kt._9)return t-kt._0;if(t>=kt.A&&t<=kt.F)return t-(kt.A-10);if(t>=kt.a&&t<=kt.f)return t-(kt.a-10)}function Ts(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(Ph)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(r);for(let s=0,n=0;s<r;s++,n+=2){const o=zc(t.charCodeAt(n)),a=zc(t.charCodeAt(n+1));if(o===void 0||a===void 0){const c=t[n]+t[n+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+n)}i[s]=o*16+a}return i}function Ur(t){return Th(Li(t))}function Nh(t){return pa(t),Th(Li(Uint8Array.from(t).reverse()))}function Wi(t,e){return Ts(t.toString(16).padStart(e*2,"0"))}function Ch(t,e){return Wi(t,e).reverse()}function ft(t,e,r){let i;if(typeof e=="string")try{i=Ts(e)}catch(n){throw new Error(t+" must be hex string or Uint8Array, cause: "+n)}else if(Hi(e))i=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const s=i.length;if(typeof r=="number"&&s!==r)throw new Error(t+" of length "+r+" expected, got "+s);return i}function Ps(...t){let e=0;for(let i=0;i<t.length;i++){const s=t[i];pa(s),e+=s.length}const r=new Uint8Array(e);for(let i=0,s=0;i<t.length;i++){const n=t[i];r.set(n,s),s+=n.length}return r}const Tn=t=>typeof t=="bigint"&&da<=t;function ga(t,e,r){return Tn(t)&&Tn(e)&&Tn(r)&&e<=t&&t<r}function ii(t,e,r,i){if(!ga(e,r,i))throw new Error("expected valid "+t+": "+r+" <= n < "+i+", got "+e)}function Pb(t){let e;for(e=0;t>da;t>>=Eo,e+=1);return e}const Xs=t=>(Eo<<BigInt(t))-Eo,Pn=t=>new Uint8Array(t),Vc=t=>Uint8Array.from(t);function Nb(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let i=Pn(t),s=Pn(t),n=0;const o=()=>{i.fill(1),s.fill(0),n=0},a=(...h)=>r(s,i,...h),c=(h=Pn(0))=>{s=a(Vc([0]),h),i=a(),h.length!==0&&(s=a(Vc([1]),h),i=a())},u=()=>{if(n++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const f=[];for(;h<e;){i=a();const g=i.slice();f.push(g),h+=i.length}return Ps(...f)};return(h,f)=>{o(),c(h);let g;for(;!(g=f(u()));)c();return o(),g}}const Cb={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Hi(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Qs(t,e,r={}){const i=(s,n,o)=>{const a=Cb[n];if(typeof a!="function")throw new Error("invalid validator function");const c=t[s];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(s)+" is invalid. Expected "+n+", got "+c)};for(const[s,n]of Object.entries(e))i(s,n,!1);for(const[s,n]of Object.entries(r))i(s,n,!0);return t}function Kc(t){const e=new WeakMap;return(r,...i)=>{const s=e.get(r);if(s!==void 0)return s;const n=t(r,...i);return e.set(r,n),n}}function Ub(t,e){if(Yc(t)>e)throw new rm({givenSize:Yc(t),maxSize:e})}const Ft={zero:48,nine:57,A:65,F:70,a:97,f:102};function Hc(t){if(t>=Ft.zero&&t<=Ft.nine)return t-Ft.zero;if(t>=Ft.A&&t<=Ft.F)return t-(Ft.A-10);if(t>=Ft.a&&t<=Ft.f)return t-(Ft.a-10)}function Rb(t,e={}){const{dir:r,size:i=32}=e;if(i===0)return t;if(t.length>i)throw new im({size:t.length,targetSize:i,type:"Bytes"});const s=new Uint8Array(i);for(let n=0;n<i;n++){const o=r==="right";s[o?n:i-n-1]=t[o?n:t.length-n-1]}return s}function Uh(t,e){if(br(t)>e)throw new Hb({givenSize:br(t),maxSize:e})}function kb(t,e){if(typeof e=="number"&&e>0&&e>br(t)-1)throw new Fh({offset:e,position:"start",size:br(t)})}function Fb(t,e,r){if(typeof e=="number"&&typeof r=="number"&&br(t)!==r-e)throw new Fh({offset:r,position:"end",size:br(t)})}function Rh(t,e={}){const{dir:r,size:i=32}=e;if(i===0)return t;const s=t.replace("0x","");if(s.length>i*2)throw new Wb({size:Math.ceil(s.length/2),targetSize:i,type:"Hex"});return`0x${s[r==="right"?"padEnd":"padStart"](i*2,"0")}`}const Lb="#__bigint";function ya(t,e,r){return JSON.stringify(t,(i,s)=>typeof s=="bigint"?s.toString()+Lb:s,r)}const Mb=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function qb(t,e={}){const{strict:r=!1}=e;if(!t)throw new Wc(t);if(typeof t!="string")throw new Wc(t);if(r&&!/^0x[0-9a-fA-F]*$/.test(t))throw new Gc(t);if(!t.startsWith("0x"))throw new Gc(t)}function jb(...t){return`0x${t.reduce((e,r)=>e+r.replace("0x",""),"")}`}function wa(t){return t instanceof Uint8Array?Ns(t):Array.isArray(t)?Ns(new Uint8Array(t)):t}function Ns(t,e={}){let r="";for(let s=0;s<t.length;s++)r+=Mb[t[s]];const i=`0x${r}`;return typeof e.size=="number"?(Uh(i,e.size),kh(i,e.size)):i}function Nn(t,e={}){const{signed:r,size:i}=e,s=BigInt(t);let n;i?r?n=(1n<<BigInt(i)*8n-1n)-1n:n=2n**(BigInt(i)*8n)-1n:typeof t=="number"&&(n=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof n=="bigint"&&r?-n-1n:0;if(n&&s>n||s<o){const u=typeof t=="bigint"?"n":"";throw new Kb({max:n?`${n}${u}`:void 0,min:`${o}${u}`,signed:r,size:i,value:`${t}${u}`})}const c=`0x${(r&&s<0?(1n<<BigInt(i*8))+BigInt(s):s).toString(16)}`;return i?zb(c,i):c}function zb(t,e){return Rh(t,{dir:"left",size:e})}function kh(t,e){return Rh(t,{dir:"right",size:e})}function jt(t,e,r,i={}){const{strict:s}=i;kb(t,e);const n=`0x${t.replace("0x","").slice((e??0)*2,(r??t.length)*2)}`;return s&&Fb(n,e,r),n}function br(t){return Math.ceil((t.length-2)/2)}function Vb(t,e={}){const{strict:r=!1}=e;try{return qb(t,{strict:r}),!0}catch{return!1}}class Kb extends fe{constructor({max:e,min:r,signed:i,size:s,value:n}){super(`Number \`${n}\` is not in safe${s?` ${s*8}-bit`:""}${i?" signed":" unsigned"} integer range ${e?`(\`${r}\` to \`${e}\`)`:`(above \`${r}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}}class Wc extends fe{constructor(e){super(`Value \`${typeof e=="object"?ya(e):e}\` of type \`${typeof e}\` is an invalid hex type.`,{metaMessages:['Hex types must be represented as `"0x${string}"`.']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexTypeError"})}}class Gc extends fe{constructor(e){super(`Value \`${e}\` is an invalid hex value.`,{metaMessages:['Hex values must start with `"0x"` and contain only hexadecimal characters (0-9, a-f, A-F).']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexValueError"})}}let Hb=class extends fe{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}};class Fh extends fe{constructor({offset:e,position:r,size:i}){super(`Slice ${r==="start"?"starting":"ending"} at offset \`${e}\` is out-of-bounds (size: \`${i}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SliceOffsetOutOfBoundsError"})}}let Wb=class extends fe{constructor({size:e,targetSize:r,type:i}){super(`${i.charAt(0).toUpperCase()}${i.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}};const Gb=new TextEncoder;function Yb(t){if(!(t instanceof Uint8Array)){if(!t)throw new ls(t);if(typeof t!="object")throw new ls(t);if(!("BYTES_PER_ELEMENT"in t))throw new ls(t);if(t.BYTES_PER_ELEMENT!==1||t.constructor.name!=="Uint8Array")throw new ls(t)}}function Zb(t){return t instanceof Uint8Array?t:typeof t=="string"?Xb(t):Jb(t)}function Jb(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function Xb(t,e={}){const{size:r}=e;let i=t;r&&(Uh(t,r),i=kh(t,r));let s=i.slice(2);s.length%2&&(s=`0${s}`);const n=s.length/2,o=new Uint8Array(n);for(let a=0,c=0;a<n;a++){const u=Hc(s.charCodeAt(c++)),l=Hc(s.charCodeAt(c++));if(u===void 0||l===void 0)throw new fe(`Invalid byte sequence ("${s[c-2]}${s[c-1]}" in "${s}").`);o[a]=u*16+l}return o}function Qb(t,e={}){const{size:r}=e,i=Gb.encode(t);return typeof r=="number"?(Ub(i,r),em(i,r)):i}function em(t,e){return Rb(t,{dir:"right",size:e})}function Yc(t){return t.length}function tm(t){try{return Yb(t),!0}catch{return!1}}class ls extends fe{constructor(e){super(`Value \`${typeof e=="object"?ya(e):e}\` of type \`${typeof e}\` is an invalid Bytes value.`,{metaMessages:["Bytes values must be of type `Bytes`."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.InvalidBytesTypeError"})}}class rm extends fe{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}}class im extends fe{constructor({size:e,targetSize:r,type:i}){super(`${i.charAt(0).toUpperCase()}${i.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}}function Lh(t,e={}){const{as:r=typeof t=="string"?"Hex":"Bytes"}=e,i=Ab(Zb(t));return r==="Bytes"?i:Ns(i)}class sm extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const r=super.get(e);return super.has(e)&&r!==void 0&&(this.delete(e),super.set(e,r)),r}set(e,r){if(super.set(e,r),this.maxSize&&this.size>this.maxSize){const i=this.keys().next().value;i&&this.delete(i)}return this}}const nm={checksum:new sm(8192)},Cn=nm.checksum;function Mh(t,e={}){const{compressed:r}=e,{prefix:i,x:s,y:n}=t;if(r===!1||typeof s=="bigint"&&typeof n=="bigint"){if(i!==4)throw new Zc({prefix:i,cause:new hm});return}if(r===!0||typeof s=="bigint"&&typeof n>"u"){if(i!==3&&i!==2)throw new Zc({prefix:i,cause:new lm});return}throw new um({publicKey:t})}function om(t){const e=(()=>{if(Vb(t))return qh(t);if(tm(t))return am(t);const{prefix:r,x:i,y:s}=t;return typeof i=="bigint"&&typeof s=="bigint"?{prefix:r??4,x:i,y:s}:{prefix:r,x:i}})();return Mh(e),e}function am(t){return qh(Ns(t))}function qh(t){if(t.length!==132&&t.length!==130&&t.length!==68)throw new fm({publicKey:t});if(t.length===130){const i=BigInt(jt(t,0,32)),s=BigInt(jt(t,32,64));return{prefix:4,x:i,y:s}}if(t.length===132){const i=Number(jt(t,0,1)),s=BigInt(jt(t,1,33)),n=BigInt(jt(t,33,65));return{prefix:i,x:s,y:n}}const e=Number(jt(t,0,1)),r=BigInt(jt(t,1,33));return{prefix:e,x:r}}function cm(t,e={}){Mh(t);const{prefix:r,x:i,y:s}=t,{includePrefix:n=!0}=e;return jb(n?Nn(r,{size:1}):"0x",Nn(i,{size:32}),typeof s=="bigint"?Nn(s,{size:32}):"0x")}class um extends fe{constructor({publicKey:e}){super(`Value \`${ya(e)}\` is not a valid public key.`,{metaMessages:["Public key must contain:","- an `x` and `prefix` value (compressed)","- an `x`, `y`, and `prefix` value (uncompressed)"]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidError"})}}class Zc extends fe{constructor({prefix:e,cause:r}){super(`Prefix "${e}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidPrefixError"})}}class lm extends fe{constructor(){super("Prefix must be 2 or 3 for compressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidCompressedPrefixError"})}}class hm extends fe{constructor(){super("Prefix must be 4 for uncompressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidUncompressedPrefixError"})}}let fm=class extends fe{constructor({publicKey:e}){super(`Value \`${e}\` is an invalid public key size.`,{metaMessages:["Expected: 33 bytes (compressed + prefix), 64 bytes (uncompressed) or 65 bytes (uncompressed + prefix).",`Received ${br(wa(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidSerializedSizeError"})}};const dm=/^0x[a-fA-F0-9]{40}$/;function jh(t,e={}){const{strict:r=!0}=e;if(!dm.test(t))throw new Jc({address:t,cause:new ym});if(r){if(t.toLowerCase()===t)return;if(zh(t)!==t)throw new Jc({address:t,cause:new wm})}}function zh(t){if(Cn.has(t))return Cn.get(t);jh(t,{strict:!1});const e=t.substring(2).toLowerCase(),r=Lh(Qb(e),{as:"Bytes"}),i=e.split("");for(let n=0;n<40;n+=2)r[n>>1]>>4>=8&&i[n]&&(i[n]=i[n].toUpperCase()),(r[n>>1]&15)>=8&&i[n+1]&&(i[n+1]=i[n+1].toUpperCase());const s=`0x${i.join("")}`;return Cn.set(t,s),s}function pm(t,e={}){const{checksum:r=!1}=e;return jh(t),r?zh(t):t}function gm(t,e={}){const r=Lh(`0x${cm(t).slice(4)}`).substring(26);return pm(`0x${r}`,e)}class Jc extends fe{constructor({address:e,cause:r}){super(`Address "${e}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class ym extends fe{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class wm extends fe{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}class Vh extends ha{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,eb(e);const i=Js(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,n=new Uint8Array(s);n.set(i.length>s?e.create().update(i).digest():i);for(let o=0;o<n.length;o++)n[o]^=54;this.iHash.update(n),this.oHash=e.create();for(let o=0;o<n.length;o++)n[o]^=106;this.oHash.update(n),ai(n)}update(e){return oi(this),this.iHash.update(e),this}digestInto(e){oi(this),kr(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:i,finished:s,destroyed:n,blockLen:o,outputLen:a}=this;return e=e,e.finished=s,e.destroyed=n,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=i._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Kh=(t,e,r)=>new Vh(t,e).update(r).digest();Kh.create=(t,e)=>new Vh(t,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Je=BigInt(0),qe=BigInt(1),Br=BigInt(2),bm=BigInt(3),Hh=BigInt(4),Wh=BigInt(5),Gh=BigInt(8);function Ge(t,e){const r=t%e;return r>=Je?r:e+r}function ct(t,e,r){let i=t;for(;e-- >Je;)i*=i,i%=r;return i}function xo(t,e){if(t===Je)throw new Error("invert: expected non-zero number");if(e<=Je)throw new Error("invert: expected positive modulus, got "+e);let r=Ge(t,e),i=e,s=Je,n=qe;for(;r!==Je;){const a=i/r,c=i%r,u=s-n*a;i=r,r=c,s=n,n=u}if(i!==qe)throw new Error("invert: does not exist");return Ge(s,e)}function Yh(t,e){const r=(t.ORDER+qe)/Hh,i=t.pow(e,r);if(!t.eql(t.sqr(i),e))throw new Error("Cannot find square root");return i}function mm(t,e){const r=(t.ORDER-Wh)/Gh,i=t.mul(e,Br),s=t.pow(i,r),n=t.mul(e,s),o=t.mul(t.mul(n,Br),s),a=t.mul(n,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),e))throw new Error("Cannot find square root");return a}function vm(t){if(t<BigInt(3))throw new Error("sqrt is not defined for small field");let e=t-qe,r=0;for(;e%Br===Je;)e/=Br,r++;let i=Br;const s=ba(t);for(;Xc(s,i)===1;)if(i++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return Yh;let n=s.pow(i,e);const o=(e+qe)/Br;return function(c,u){if(c.is0(u))return u;if(Xc(c,u)!==1)throw new Error("Cannot find square root");let l=r,h=c.mul(c.ONE,n),f=c.pow(u,e),g=c.pow(u,o);for(;!c.eql(f,c.ONE);){if(c.is0(f))return c.ZERO;let d=1,p=c.sqr(f);for(;!c.eql(p,c.ONE);)if(d++,p=c.sqr(p),d===l)throw new Error("Cannot find square root");const b=qe<<BigInt(l-d-1),v=c.pow(h,b);l=d,h=c.sqr(v),f=c.mul(f,h),g=c.mul(g,v)}return g}}function Em(t){return t%Hh===bm?Yh:t%Gh===Wh?mm:vm(t)}const xm=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Im(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=xm.reduce((i,s)=>(i[s]="function",i),e);return Qs(t,r)}function _m(t,e,r){if(r<Je)throw new Error("invalid exponent, negatives unsupported");if(r===Je)return t.ONE;if(r===qe)return e;let i=t.ONE,s=e;for(;r>Je;)r&qe&&(i=t.mul(i,s)),s=t.sqr(s),r>>=qe;return i}function Zh(t,e,r=!1){const i=new Array(e.length).fill(r?t.ZERO:void 0),s=e.reduce((o,a,c)=>t.is0(a)?o:(i[c]=o,t.mul(o,a)),t.ONE),n=t.inv(s);return e.reduceRight((o,a,c)=>t.is0(a)?o:(i[c]=t.mul(o,i[c]),t.mul(o,a)),n),i}function Xc(t,e){const r=(t.ORDER-qe)/Br,i=t.pow(e,r),s=t.eql(i,t.ONE),n=t.eql(i,t.ZERO),o=t.eql(i,t.neg(t.ONE));if(!s&&!n&&!o)throw new Error("invalid Legendre symbol result");return s?1:n?0:-1}function Jh(t,e){e!==void 0&&ki(e);const r=e!==void 0?e:t.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function ba(t,e,r=!1,i={}){if(t<=Je)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:s,nByteLength:n}=Jh(t,e);if(n>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:s,BYTES:n,MASK:Xs(s),ZERO:Je,ONE:qe,create:c=>Ge(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Je<=c&&c<t},is0:c=>c===Je,isOdd:c=>(c&qe)===qe,neg:c=>Ge(-c,t),eql:(c,u)=>c===u,sqr:c=>Ge(c*c,t),add:(c,u)=>Ge(c+u,t),sub:(c,u)=>Ge(c-u,t),mul:(c,u)=>Ge(c*u,t),pow:(c,u)=>_m(a,c,u),div:(c,u)=>Ge(c*xo(u,t),t),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>xo(c,t),sqrt:i.sqrt||(c=>(o||(o=Em(t)),o(a,c))),toBytes:c=>r?Ch(c,n):Wi(c,n),fromBytes:c=>{if(c.length!==n)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+c.length);return r?Nh(c):Ur(c)},invertBatch:c=>Zh(a,c),cmov:(c,u,l)=>l?u:c});return Object.freeze(a)}function Xh(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function Qh(t){const e=Xh(t);return e+Math.ceil(e/2)}function Sm(t,e,r=!1){const i=t.length,s=Xh(e),n=Qh(e);if(i<16||i<n||i>1024)throw new Error("expected "+n+"-1024 bytes of input, got "+i);const o=r?Nh(t):Ur(t),a=Ge(o,e-qe)+qe;return r?Ch(a,s):Wi(a,s)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Qc=BigInt(0),Io=BigInt(1);function Un(t,e){const r=e.negate();return t?r:e}function ef(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Rn(t,e){ef(t,e);const r=Math.ceil(e/t)+1,i=2**(t-1),s=2**t,n=Xs(t),o=BigInt(t);return{windows:r,windowSize:i,mask:n,maxNumber:s,shiftBy:o}}function eu(t,e,r){const{windowSize:i,mask:s,maxNumber:n,shiftBy:o}=r;let a=Number(t&s),c=t>>o;a>i&&(a-=n,c+=Io);const u=e*i,l=u+Math.abs(a)-1,h=a===0,f=a<0,g=e%2!==0;return{nextN:c,offset:l,isZero:h,isNeg:f,isNegF:g,offsetF:u}}function Dm(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,i)=>{if(!(r instanceof e))throw new Error("invalid point at index "+i)})}function Am(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,i)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+i)})}const kn=new WeakMap,tf=new WeakMap;function Fn(t){return tf.get(t)||1}function $m(t,e){return{constTimeNegate:Un,hasPrecomputes(r){return Fn(r)!==1},unsafeLadder(r,i,s=t.ZERO){let n=r;for(;i>Qc;)i&Io&&(s=s.add(n)),n=n.double(),i>>=Io;return s},precomputeWindow(r,i){const{windows:s,windowSize:n}=Rn(i,e),o=[];let a=r,c=a;for(let u=0;u<s;u++){c=a,o.push(c);for(let l=1;l<n;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,i,s){let n=t.ZERO,o=t.BASE;const a=Rn(r,e);for(let c=0;c<a.windows;c++){const{nextN:u,offset:l,isZero:h,isNeg:f,isNegF:g,offsetF:d}=eu(s,c,a);s=u,h?o=o.add(Un(g,i[d])):n=n.add(Un(f,i[l]))}return{p:n,f:o}},wNAFUnsafe(r,i,s,n=t.ZERO){const o=Rn(r,e);for(let a=0;a<o.windows&&s!==Qc;a++){const{nextN:c,offset:u,isZero:l,isNeg:h}=eu(s,a,o);if(s=c,!l){const f=i[u];n=n.add(h?f.negate():f)}}return n},getPrecomputes(r,i,s){let n=kn.get(i);return n||(n=this.precomputeWindow(i,r),r!==1&&kn.set(i,s(n))),n},wNAFCached(r,i,s){const n=Fn(r);return this.wNAF(n,this.getPrecomputes(n,r,s),i)},wNAFCachedUnsafe(r,i,s,n){const o=Fn(r);return o===1?this.unsafeLadder(r,i,n):this.wNAFUnsafe(o,this.getPrecomputes(o,r,s),i,n)},setWindowSize(r,i){ef(i,e),tf.set(r,i),kn.delete(r)}}}function Om(t,e,r,i){Dm(r,t),Am(i,e);const s=r.length,n=i.length;if(s!==n)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=Pb(BigInt(s));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const u=Xs(c),l=new Array(Number(u)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let f=o;for(let g=h;g>=0;g-=c){l.fill(o);for(let p=0;p<n;p++){const b=i[p],v=Number(b>>BigInt(g)&u);l[v]=l[v].add(r[p])}let d=o;for(let p=l.length-1,b=o;p>0;p--)b=b.add(l[p]),d=d.add(b);if(f=f.add(d),g!==0)for(let p=0;p<c;p++)f=f.double()}return f}function rf(t){return Im(t.Fp),Qs(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Jh(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function tu(t){t.lowS!==void 0&&Fi("lowS",t.lowS),t.prehash!==void 0&&Fi("prehash",t.prehash)}function Bm(t){const e=rf(t);Qs(e,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});const{endo:r,Fp:i,a:s}=e;if(r){if(!i.eql(s,i.ZERO))throw new Error("invalid endo: CURVE.a must be 0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...e})}class Tm extends Error{constructor(e=""){super(e)}}const Vt={Err:Tm,_tlv:{encode:(t,e)=>{const{Err:r}=Vt;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const i=e.length/2,s=us(i);if(s.length/2&128)throw new r("tlv.encode: long form length too big");const n=i>127?us(s.length/2|128):"";return us(t)+n+s+e},decode(t,e){const{Err:r}=Vt;let i=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[i++]!==t)throw new r("tlv.decode: wrong tlv");const s=e[i++],n=!!(s&128);let o=0;if(!n)o=s;else{const c=s&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const u=e.subarray(i,i+c);if(u.length!==c)throw new r("tlv.decode: length bytes not complete");if(u[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const l of u)o=o<<8|l;if(i+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(i,i+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(i+o)}}},_int:{encode(t){const{Err:e}=Vt;if(t<Ht)throw new e("integer: negative integers are not allowed");let r=us(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=Vt;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Ur(t)}},toSig(t){const{Err:e,_int:r,_tlv:i}=Vt,s=ft("signature",t),{v:n,l:o}=i.decode(48,s);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=i.decode(2,n),{v:u,l}=i.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(u)}},hexFromSig(t){const{_tlv:e,_int:r}=Vt,i=e.encode(2,r.encode(t.r)),s=e.encode(2,r.encode(t.s)),n=i+s;return e.encode(48,n)}};function Ln(t,e){return Li(Wi(t,e))}const Ht=BigInt(0),Ae=BigInt(1);BigInt(2);const Mn=BigInt(3),Pm=BigInt(4);function Nm(t){const e=Bm(t),{Fp:r}=e,i=ba(e.n,e.nBitLength),s=e.toBytes||((m,x,D)=>{const O=x.toAffine();return Ps(Uint8Array.from([4]),r.toBytes(O.x),r.toBytes(O.y))}),n=e.fromBytes||(m=>{const x=m.subarray(1),D=r.fromBytes(x.subarray(0,r.BYTES)),O=r.fromBytes(x.subarray(r.BYTES,2*r.BYTES));return{x:D,y:O}});function o(m){const{a:x,b:D}=e,O=r.sqr(m),N=r.mul(O,m);return r.add(r.add(N,r.mul(m,x)),D)}function a(m,x){const D=r.sqr(x),O=o(m);return r.eql(D,O)}if(!a(e.Gx,e.Gy))throw new Error("bad curve params: generator point");const c=r.mul(r.pow(e.a,Mn),Pm),u=r.mul(r.sqr(e.b),BigInt(27));if(r.is0(r.add(c,u)))throw new Error("bad curve params: a or b");function l(m){return ga(m,Ae,e.n)}function h(m){const{allowedPrivateKeyLengths:x,nByteLength:D,wrapPrivateKey:O,n:N}=e;if(x&&typeof m!="bigint"){if(Hi(m)&&(m=Li(m)),typeof m!="string"||!x.includes(m.length))throw new Error("invalid private key");m=m.padStart(D*2,"0")}let R;try{R=typeof m=="bigint"?m:Ur(ft("private key",m,D))}catch{throw new Error("invalid private key, expected hex or "+D+" bytes, got "+typeof m)}return O&&(R=Ge(R,N)),ii("private key",R,Ae,N),R}function f(m){if(!(m instanceof p))throw new Error("ProjectivePoint expected")}const g=Kc((m,x)=>{const{px:D,py:O,pz:N}=m;if(r.eql(N,r.ONE))return{x:D,y:O};const R=m.is0();x==null&&(x=R?r.ONE:r.inv(N));const T=r.mul(D,x),q=r.mul(O,x),F=r.mul(N,x);if(R)return{x:r.ZERO,y:r.ZERO};if(!r.eql(F,r.ONE))throw new Error("invZ was invalid");return{x:T,y:q}}),d=Kc(m=>{if(m.is0()){if(e.allowInfinityPoint&&!r.is0(m.py))return;throw new Error("bad point: ZERO")}const{x,y:D}=m.toAffine();if(!r.isValid(x)||!r.isValid(D))throw new Error("bad point: x or y not FE");if(!a(x,D))throw new Error("bad point: equation left != right");if(!m.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class p{constructor(x,D,O){if(x==null||!r.isValid(x))throw new Error("x required");if(D==null||!r.isValid(D)||r.is0(D))throw new Error("y required");if(O==null||!r.isValid(O))throw new Error("z required");this.px=x,this.py=D,this.pz=O,Object.freeze(this)}static fromAffine(x){const{x:D,y:O}=x||{};if(!x||!r.isValid(D)||!r.isValid(O))throw new Error("invalid affine point");if(x instanceof p)throw new Error("projective point not allowed");const N=R=>r.eql(R,r.ZERO);return N(D)&&N(O)?p.ZERO:new p(D,O,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(x){const D=Zh(r,x.map(O=>O.pz));return x.map((O,N)=>O.toAffine(D[N])).map(p.fromAffine)}static fromHex(x){const D=p.fromAffine(n(ft("pointHex",x)));return D.assertValidity(),D}static fromPrivateKey(x){return p.BASE.multiply(h(x))}static msm(x,D){return Om(p,i,x,D)}_setWindowSize(x){_.setWindowSize(this,x)}assertValidity(){d(this)}hasEvenY(){const{y:x}=this.toAffine();if(r.isOdd)return!r.isOdd(x);throw new Error("Field doesn't support isOdd")}equals(x){f(x);const{px:D,py:O,pz:N}=this,{px:R,py:T,pz:q}=x,F=r.eql(r.mul(D,q),r.mul(R,N)),P=r.eql(r.mul(O,q),r.mul(T,N));return F&&P}negate(){return new p(this.px,r.neg(this.py),this.pz)}double(){const{a:x,b:D}=e,O=r.mul(D,Mn),{px:N,py:R,pz:T}=this;let q=r.ZERO,F=r.ZERO,P=r.ZERO,A=r.mul(N,N),B=r.mul(R,R),y=r.mul(T,T),w=r.mul(N,R);return w=r.add(w,w),P=r.mul(N,T),P=r.add(P,P),q=r.mul(x,P),F=r.mul(O,y),F=r.add(q,F),q=r.sub(B,F),F=r.add(B,F),F=r.mul(q,F),q=r.mul(w,q),P=r.mul(O,P),y=r.mul(x,y),w=r.sub(A,y),w=r.mul(x,w),w=r.add(w,P),P=r.add(A,A),A=r.add(P,A),A=r.add(A,y),A=r.mul(A,w),F=r.add(F,A),y=r.mul(R,T),y=r.add(y,y),A=r.mul(y,w),q=r.sub(q,A),P=r.mul(y,B),P=r.add(P,P),P=r.add(P,P),new p(q,F,P)}add(x){f(x);const{px:D,py:O,pz:N}=this,{px:R,py:T,pz:q}=x;let F=r.ZERO,P=r.ZERO,A=r.ZERO;const B=e.a,y=r.mul(e.b,Mn);let w=r.mul(D,R),E=r.mul(O,T),S=r.mul(N,q),I=r.add(D,O),$=r.add(R,T);I=r.mul(I,$),$=r.add(w,E),I=r.sub(I,$),$=r.add(D,N);let C=r.add(R,q);return $=r.mul($,C),C=r.add(w,S),$=r.sub($,C),C=r.add(O,N),F=r.add(T,q),C=r.mul(C,F),F=r.add(E,S),C=r.sub(C,F),A=r.mul(B,$),F=r.mul(y,S),A=r.add(F,A),F=r.sub(E,A),A=r.add(E,A),P=r.mul(F,A),E=r.add(w,w),E=r.add(E,w),S=r.mul(B,S),$=r.mul(y,$),E=r.add(E,S),S=r.sub(w,S),S=r.mul(B,S),$=r.add($,S),w=r.mul(E,$),P=r.add(P,w),w=r.mul(C,$),F=r.mul(I,F),F=r.sub(F,w),w=r.mul(I,E),A=r.mul(C,A),A=r.add(A,w),new p(F,P,A)}subtract(x){return this.add(x.negate())}is0(){return this.equals(p.ZERO)}wNAF(x){return _.wNAFCached(this,x,p.normalizeZ)}multiplyUnsafe(x){const{endo:D,n:O}=e;ii("scalar",x,Ht,O);const N=p.ZERO;if(x===Ht)return N;if(this.is0()||x===Ae)return this;if(!D||_.hasPrecomputes(this))return _.wNAFCachedUnsafe(this,x,p.normalizeZ);let{k1neg:R,k1:T,k2neg:q,k2:F}=D.splitScalar(x),P=N,A=N,B=this;for(;T>Ht||F>Ht;)T&Ae&&(P=P.add(B)),F&Ae&&(A=A.add(B)),B=B.double(),T>>=Ae,F>>=Ae;return R&&(P=P.negate()),q&&(A=A.negate()),A=new p(r.mul(A.px,D.beta),A.py,A.pz),P.add(A)}multiply(x){const{endo:D,n:O}=e;ii("scalar",x,Ae,O);let N,R;if(D){const{k1neg:T,k1:q,k2neg:F,k2:P}=D.splitScalar(x);let{p:A,f:B}=this.wNAF(q),{p:y,f:w}=this.wNAF(P);A=_.constTimeNegate(T,A),y=_.constTimeNegate(F,y),y=new p(r.mul(y.px,D.beta),y.py,y.pz),N=A.add(y),R=B.add(w)}else{const{p:T,f:q}=this.wNAF(x);N=T,R=q}return p.normalizeZ([N,R])[0]}multiplyAndAddUnsafe(x,D,O){const N=p.BASE,R=(q,F)=>F===Ht||F===Ae||!q.equals(N)?q.multiplyUnsafe(F):q.multiply(F),T=R(this,D).add(R(x,O));return T.is0()?void 0:T}toAffine(x){return g(this,x)}isTorsionFree(){const{h:x,isTorsionFree:D}=e;if(x===Ae)return!0;if(D)return D(p,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:x,clearCofactor:D}=e;return x===Ae?this:D?D(p,this):this.multiplyUnsafe(e.h)}toRawBytes(x=!0){return Fi("isCompressed",x),this.assertValidity(),s(p,this,x)}toHex(x=!0){return Fi("isCompressed",x),Li(this.toRawBytes(x))}}p.BASE=new p(e.Gx,e.Gy,r.ONE),p.ZERO=new p(r.ZERO,r.ONE,r.ZERO);const{endo:b,nBitLength:v}=e,_=$m(p,b?Math.ceil(v/2):v);return{CURVE:e,ProjectivePoint:p,normPrivateKeyToScalar:h,weierstrassEquation:o,isWithinCurveOrder:l}}function Cm(t){const e=rf(t);return Qs(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function Um(t){const e=Cm(t),{Fp:r,n:i,nByteLength:s,nBitLength:n}=e,o=r.BYTES+1,a=2*r.BYTES+1;function c(y){return Ge(y,i)}function u(y){return xo(y,i)}const{ProjectivePoint:l,normPrivateKeyToScalar:h,weierstrassEquation:f,isWithinCurveOrder:g}=Nm({...e,toBytes(y,w,E){const S=w.toAffine(),I=r.toBytes(S.x),$=Ps;return Fi("isCompressed",E),E?$(Uint8Array.from([w.hasEvenY()?2:3]),I):$(Uint8Array.from([4]),I,r.toBytes(S.y))},fromBytes(y){const w=y.length,E=y[0],S=y.subarray(1);if(w===o&&(E===2||E===3)){const I=Ur(S);if(!ga(I,Ae,r.ORDER))throw new Error("Point is not on curve");const $=f(I);let C;try{C=r.sqrt($)}catch(k){const M=k instanceof Error?": "+k.message:"";throw new Error("Point is not on curve"+M)}const U=(C&Ae)===Ae;return(E&1)===1!==U&&(C=r.neg(C)),{x:I,y:C}}else if(w===a&&E===4){const I=r.fromBytes(S.subarray(0,r.BYTES)),$=r.fromBytes(S.subarray(r.BYTES,2*r.BYTES));return{x:I,y:$}}else{const I=o,$=a;throw new Error("invalid Point, expected length of "+I+", or uncompressed "+$+", got "+w)}}});function d(y){const w=i>>Ae;return y>w}function p(y){return d(y)?c(-y):y}const b=(y,w,E)=>Ur(y.slice(w,E));class v{constructor(w,E,S){ii("r",w,Ae,i),ii("s",E,Ae,i),this.r=w,this.s=E,S!=null&&(this.recovery=S),Object.freeze(this)}static fromCompact(w){const E=s;return w=ft("compactSignature",w,E*2),new v(b(w,0,E),b(w,E,2*E))}static fromDER(w){const{r:E,s:S}=Vt.toSig(ft("DER",w));return new v(E,S)}assertValidity(){}addRecoveryBit(w){return new v(this.r,this.s,w)}recoverPublicKey(w){const{r:E,s:S,recovery:I}=this,$=N(ft("msgHash",w));if(I==null||![0,1,2,3].includes(I))throw new Error("recovery id invalid");const C=I===2||I===3?E+e.n:E;if(C>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const U=(I&1)===0?"02":"03",j=l.fromHex(U+Ln(C,r.BYTES)),k=u(C),M=c(-$*k),H=c(S*k),G=l.BASE.multiplyAndAddUnsafe(j,M,H);if(!G)throw new Error("point at infinify");return G.assertValidity(),G}hasHighS(){return d(this.s)}normalizeS(){return this.hasHighS()?new v(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return Ts(this.toDERHex())}toDERHex(){return Vt.hexFromSig(this)}toCompactRawBytes(){return Ts(this.toCompactHex())}toCompactHex(){const w=s;return Ln(this.r,w)+Ln(this.s,w)}}const _={isValidPrivateKey(y){try{return h(y),!0}catch{return!1}},normPrivateKeyToScalar:h,randomPrivateKey:()=>{const y=Qh(e.n);return Sm(e.randomBytes(y),e.n)},precompute(y=8,w=l.BASE){return w._setWindowSize(y),w.multiply(BigInt(3)),w}};function m(y,w=!0){return l.fromPrivateKey(y).toRawBytes(w)}function x(y){if(typeof y=="bigint")return!1;if(y instanceof l)return!0;const E=ft("key",y).length,S=r.BYTES,I=S+1,$=2*S+1;if(!(e.allowedPrivateKeyLengths||s===I))return E===I||E===$}function D(y,w,E=!0){if(x(y)===!0)throw new Error("first arg must be private key");if(x(w)===!1)throw new Error("second arg must be public key");return l.fromHex(w).multiply(h(y)).toRawBytes(E)}const O=e.bits2int||function(y){if(y.length>8192)throw new Error("input is too large");const w=Ur(y),E=y.length*8-n;return E>0?w>>BigInt(E):w},N=e.bits2int_modN||function(y){return c(O(y))},R=Xs(n);function T(y){return ii("num < 2^"+n,y,Ht,R),Wi(y,s)}function q(y,w,E=F){if(["recovered","canonical"].some(W=>W in E))throw new Error("sign() legacy options not supported");const{hash:S,randomBytes:I}=e;let{lowS:$,prehash:C,extraEntropy:U}=E;$==null&&($=!0),y=ft("msgHash",y),tu(E),C&&(y=ft("prehashed msgHash",S(y)));const j=N(y),k=h(w),M=[T(k),T(j)];if(U!=null&&U!==!1){const W=U===!0?I(r.BYTES):U;M.push(ft("extraEntropy",W))}const H=Ps(...M),G=j;function J(W){const Y=O(W);if(!g(Y))return;const te=u(Y),le=l.BASE.multiply(Y).toAffine(),pe=c(le.x);if(pe===Ht)return;const we=c(te*c(G+pe*k));if(we===Ht)return;let at=(le.x===pe?0:2)|Number(le.y&Ae),wt=we;return $&&d(we)&&(wt=p(we),at^=1),new v(pe,wt,at)}return{seed:H,k2sig:J}}const F={lowS:e.lowS,prehash:!1},P={lowS:e.lowS,prehash:!1};function A(y,w,E=F){const{seed:S,k2sig:I}=q(y,w,E),$=e;return Nb($.hash.outputLen,$.nByteLength,$.hmac)(S,I)}l.BASE._setWindowSize(8);function B(y,w,E,S=P){var at;const I=y;w=ft("msgHash",w),E=ft("publicKey",E);const{lowS:$,prehash:C,format:U}=S;if(tu(S),"strict"in S)throw new Error("options.strict was renamed to lowS");if(U!==void 0&&U!=="compact"&&U!=="der")throw new Error("format must be compact or der");const j=typeof I=="string"||Hi(I),k=!j&&!U&&typeof I=="object"&&I!==null&&typeof I.r=="bigint"&&typeof I.s=="bigint";if(!j&&!k)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let M,H;try{if(k&&(M=new v(I.r,I.s)),j){try{U!=="compact"&&(M=v.fromDER(I))}catch(wt){if(!(wt instanceof Vt.Err))throw wt}!M&&U!=="der"&&(M=v.fromCompact(I))}H=l.fromHex(E)}catch{return!1}if(!M||$&&M.hasHighS())return!1;C&&(w=e.hash(w));const{r:G,s:J}=M,W=N(w),Y=u(J),te=c(W*Y),le=c(G*Y),pe=(at=l.BASE.multiplyAndAddUnsafe(H,te,le))==null?void 0:at.toAffine();return pe?c(pe.x)===G:!1}return{CURVE:e,getPublicKey:m,getSharedSecret:D,sign:A,verify:B,ProjectivePoint:l,Signature:v,utils:_}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Rm(t){return{hash:t,hmac:(e,...r)=>Kh(t,e,ob(...r)),randomBytes:ab}}function km(t,e){const r=i=>Um({...t,...Rm(i)});return{...r(e),create:r}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const sf=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),ru=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Fm=BigInt(0),Lm=BigInt(1),_o=BigInt(2),iu=(t,e)=>(t+e/_o)/e;function Mm(t){const e=sf,r=BigInt(3),i=BigInt(6),s=BigInt(11),n=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),u=t*t*t%e,l=u*u*t%e,h=ct(l,r,e)*l%e,f=ct(h,r,e)*l%e,g=ct(f,_o,e)*u%e,d=ct(g,s,e)*g%e,p=ct(d,n,e)*d%e,b=ct(p,a,e)*p%e,v=ct(b,c,e)*b%e,_=ct(v,a,e)*p%e,m=ct(_,r,e)*l%e,x=ct(m,o,e)*d%e,D=ct(x,i,e)*u%e,O=ct(D,_o,e);if(!So.eql(So.sqr(O),t))throw new Error("Cannot find square root");return O}const So=ba(sf,void 0,void 0,{sqrt:Mm}),qm=km({a:Fm,b:BigInt(7),Fp:So,n:ru,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=ru,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),i=-Lm*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),n=r,o=BigInt("0x100000000000000000000000000000000"),a=iu(n*t,e),c=iu(-i*t,e);let u=Ge(t-a*r-c*s,e),l=Ge(-a*i-c*n,e);const h=u>o,f=l>o;if(h&&(u=e-u),f&&(l=e-l),u>o||l>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:h,k1:u,k2neg:f,k2:l}}}},Bb);function jm(t){if(t.length!==130&&t.length!==132)throw new Vm({signature:t});const e=BigInt(jt(t,0,32)),r=BigInt(jt(t,32,64)),i=(()=>{const s=+`0x${t.slice(130)}`;if(!Number.isNaN(s))try{return zm(s)}catch{throw new Km({value:s})}})();return typeof i>"u"?{r:e,s:r}:{r:e,s:r,yParity:i}}function zm(t){if(t===0||t===27)return 0;if(t===1||t===28)return 1;if(t>=35)return t%2===0?1:0;throw new Hm({value:t})}class Vm extends fe{constructor({signature:e}){super(`Value \`${e}\` is an invalid signature size.`,{metaMessages:["Expected: 64 bytes or 65 bytes.",`Received ${br(wa(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSerializedSizeError"})}}class Km extends fe{constructor({value:e}){super(`Value \`${e}\` is an invalid y-parity value. Y-parity must be 0 or 1.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidYParityError"})}}class Hm extends fe{constructor({value:e}){super(`Value \`${e}\` is an invalid v value. v must be 27, 28 or >=35.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidVError"})}}/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Wm(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function nf(t,e){return Array.isArray(e)?e.length===0?!0:t?e.every(r=>typeof r=="string"):e.every(r=>Number.isSafeInteger(r)):!1}function Cs(t,e){if(typeof e!="string")throw new Error(`${t}: string expected`);return!0}function ma(t){if(!Number.isSafeInteger(t))throw new Error(`invalid integer: ${t}`)}function Do(t){if(!Array.isArray(t))throw new Error("array expected")}function Us(t,e){if(!nf(!0,e))throw new Error(`${t}: array of strings expected`)}function Gm(t,e){if(!nf(!1,e))throw new Error(`${t}: array of numbers expected`)}function Ym(...t){const e=n=>n,r=(n,o)=>a=>n(o(a)),i=t.map(n=>n.encode).reduceRight(r,e),s=t.map(n=>n.decode).reduce(r,e);return{encode:i,decode:s}}function Zm(t){const e=typeof t=="string"?t.split(""):t,r=e.length;Us("alphabet",e);const i=new Map(e.map((s,n)=>[s,n]));return{encode:s=>(Do(s),s.map(n=>{if(!Number.isSafeInteger(n)||n<0||n>=r)throw new Error(`alphabet.encode: digit index outside alphabet "${n}". Allowed: ${t}`);return e[n]})),decode:s=>(Do(s),s.map(n=>{Cs("alphabet.decode",n);const o=i.get(n);if(o===void 0)throw new Error(`Unknown letter: "${n}". Allowed: ${t}`);return o}))}}function Jm(t=""){return Cs("join",t),{encode:e=>(Us("join.decode",e),e.join(t)),decode:e=>(Cs("join.decode",e),e.split(t))}}function Xm(t,e="="){return ma(t),Cs("padding",e),{encode(r){for(Us("padding.encode",r);r.length*t%8;)r.push(e);return r},decode(r){Us("padding.decode",r);let i=r.length;if(i*t%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;i>0&&r[i-1]===e;i--)if((i-1)*t%8===0)throw new Error("padding: invalid, string has too much padding");return r.slice(0,i)}}}const of=(t,e)=>e===0?t:of(e,t%e),Rs=(t,e)=>t+(e-of(t,e)),qn=(()=>{let t=[];for(let e=0;e<40;e++)t.push(2**e);return t})();function su(t,e,r,i){if(Do(t),e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(Rs(e,r)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${r} carryBits=${Rs(e,r)}`);let s=0,n=0;const o=qn[e],a=qn[r]-1,c=[];for(const u of t){if(ma(u),u>=o)throw new Error(`convertRadix2: invalid data word=${u} from=${e}`);if(s=s<<e|u,n+e>32)throw new Error(`convertRadix2: carry overflow pos=${n} from=${e}`);for(n+=e;n>=r;n-=r)c.push((s>>n-r&a)>>>0);const l=qn[n];if(l===void 0)throw new Error("invalid carry");s&=l-1}if(s=s<<r-n&a,!i&&n>=e)throw new Error("Excess padding");if(!i&&s>0)throw new Error(`Non-zero padding: ${s}`);return i&&n>0&&c.push(s>>>0),c}function Qm(t,e=!1){if(ma(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(Rs(8,t)>32||Rs(t,8)>32)throw new Error("radix2: carry overflow");return{encode:r=>{if(!Wm(r))throw new Error("radix2.encode input should be Uint8Array");return su(Array.from(r),8,t,!e)},decode:r=>(Gm("radix2.decode",r),Uint8Array.from(su(r,t,8,e)))}}const e1=Ym(Qm(5),Zm("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),Xm(5),Jm(""));function t1(t){return gm(r1(t))}function r1(t){const{payload:e,signature:r}=t,{r:i,s,yParity:n}=r,a=new qm.Signature(BigInt(i),BigInt(s)).addRecoveryBit(n).recoverPublicKey(wa(e).substring(2));return om(a)}function i1(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let u=0;u<e.length;u++)e[u]=255;for(let u=0;u<t.length;u++){const l=t.charAt(u),h=l.charCodeAt(0);if(e[h]!==255)throw new TypeError(l+" is ambiguous");e[h]=u}const r=t.length,i=t.charAt(0),s=Math.log(r)/Math.log(256),n=Math.log(256)/Math.log(r);function o(u){if(u instanceof Uint8Array||(ArrayBuffer.isView(u)?u=new Uint8Array(u.buffer,u.byteOffset,u.byteLength):Array.isArray(u)&&(u=Uint8Array.from(u))),!(u instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(u.length===0)return"";let l=0,h=0,f=0;const g=u.length;for(;f!==g&&u[f]===0;)f++,l++;const d=(g-f)*n+1>>>0,p=new Uint8Array(d);for(;f!==g;){let _=u[f],m=0;for(let x=d-1;(_!==0||m<h)&&x!==-1;x--,m++)_+=256*p[x]>>>0,p[x]=_%r>>>0,_=_/r>>>0;if(_!==0)throw new Error("Non-zero carry");h=m,f++}let b=d-h;for(;b!==d&&p[b]===0;)b++;let v=i.repeat(l);for(;b<d;++b)v+=t.charAt(p[b]);return v}function a(u){if(typeof u!="string")throw new TypeError("Expected String");if(u.length===0)return new Uint8Array;let l=0,h=0,f=0;for(;u[l]===i;)h++,l++;const g=(u.length-l)*s+1>>>0,d=new Uint8Array(g);for(;l<u.length;){const _=u.charCodeAt(l);if(_>255)return;let m=e[_];if(m===255)return;let x=0;for(let D=g-1;(m!==0||x<f)&&D!==-1;D--,x++)m+=r*d[D]>>>0,d[D]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");f=x,l++}let p=g-f;for(;p!==g&&d[p]===0;)p++;const b=new Uint8Array(h+(g-p));let v=h;for(;p!==g;)b[v++]=d[p++];return b}function c(u){const l=a(u);if(l)return l;throw new Error("Non-base"+r+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var s1="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";const Gi=i1(s1);function n1(t){const e=t.length;let r=0,i=0;for(;i<e;){let s=t.charCodeAt(i++);if((s&4294967168)===0){r++;continue}else if((s&4294965248)===0)r+=2;else{if(s>=55296&&s<=56319&&i<e){const n=t.charCodeAt(i);(n&64512)===56320&&(++i,s=((s&1023)<<10)+(n&1023)+65536)}(s&4294901760)===0?r+=3:r+=4}}return r}function o1(t,e,r){const i=t.length;let s=r,n=0;for(;n<i;){let o=t.charCodeAt(n++);if((o&4294967168)===0){e[s++]=o;continue}else if((o&4294965248)===0)e[s++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&n<i){const a=t.charCodeAt(n);(a&64512)===56320&&(++n,o=((o&1023)<<10)+(a&1023)+65536)}(o&4294901760)===0?(e[s++]=o>>12&15|224,e[s++]=o>>6&63|128):(e[s++]=o>>18&7|240,e[s++]=o>>12&63|128,e[s++]=o>>6&63|128)}e[s++]=o&63|128}}const a1=new TextEncoder,c1=50;function u1(t,e,r){a1.encodeInto(t,e.subarray(r))}function l1(t,e,r){t.length>c1?u1(t,e,r):o1(t,e,r)}const h1=4096;function af(t,e,r){let i=e;const s=i+r,n=[];let o="";for(;i<s;){const a=t[i++];if((a&128)===0)n.push(a);else if((a&224)===192){const c=t[i++]&63;n.push((a&31)<<6|c)}else if((a&240)===224){const c=t[i++]&63,u=t[i++]&63;n.push((a&31)<<12|c<<6|u)}else if((a&248)===240){const c=t[i++]&63,u=t[i++]&63,l=t[i++]&63;let h=(a&7)<<18|c<<12|u<<6|l;h>65535&&(h-=65536,n.push(h>>>10&1023|55296),h=56320|h&1023),n.push(h)}else n.push(a);n.length>=h1&&(o+=String.fromCharCode(...n),n.length=0)}return n.length>0&&(o+=String.fromCharCode(...n)),o}const f1=new TextDecoder,d1=200;function p1(t,e,r){const i=t.subarray(e,e+r);return f1.decode(i)}function g1(t,e,r){return r>d1?p1(t,e,r):af(t,e,r)}class hs{constructor(e,r){this.type=e,this.data=r}}class it extends Error{constructor(e){super(e);const r=Object.create(it.prototype);Object.setPrototypeOf(this,r),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:it.name})}}const vi=4294967295;function y1(t,e,r){const i=r/4294967296,s=r;t.setUint32(e,i),t.setUint32(e+4,s)}function cf(t,e,r){const i=Math.floor(r/4294967296),s=r;t.setUint32(e,i),t.setUint32(e+4,s)}function uf(t,e){const r=t.getInt32(e),i=t.getUint32(e+4);return r*4294967296+i}function w1(t,e){const r=t.getUint32(e),i=t.getUint32(e+4);return r*4294967296+i}const b1=-1,m1=4294967296-1,v1=17179869184-1;function E1({sec:t,nsec:e}){if(t>=0&&e>=0&&t<=v1)if(e===0&&t<=m1){const r=new Uint8Array(4);return new DataView(r.buffer).setUint32(0,t),r}else{const r=t/4294967296,i=t&4294967295,s=new Uint8Array(8),n=new DataView(s.buffer);return n.setUint32(0,e<<2|r&3),n.setUint32(4,i),s}else{const r=new Uint8Array(12),i=new DataView(r.buffer);return i.setUint32(0,e),cf(i,4,t),r}}function x1(t){const e=t.getTime(),r=Math.floor(e/1e3),i=(e-r*1e3)*1e6,s=Math.floor(i/1e9);return{sec:r+s,nsec:i-s*1e9}}function I1(t){if(t instanceof Date){const e=x1(t);return E1(e)}else return null}function _1(t){const e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{const r=e.getUint32(0),i=e.getUint32(4),s=(r&3)*4294967296+i,n=r>>>2;return{sec:s,nsec:n}}case 12:{const r=uf(e,4),i=e.getUint32(0);return{sec:r,nsec:i}}default:throw new it(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${t.length}`)}}function S1(t){const e=_1(t);return new Date(e.sec*1e3+e.nsec/1e6)}const D1={type:b1,encode:I1,decode:S1};class ks{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(D1)}register({type:e,encode:r,decode:i}){if(e>=0)this.encoders[e]=r,this.decoders[e]=i;else{const s=-1-e;this.builtInEncoders[s]=r,this.builtInDecoders[s]=i}}tryToEncode(e,r){for(let i=0;i<this.builtInEncoders.length;i++){const s=this.builtInEncoders[i];if(s!=null){const n=s(e,r);if(n!=null){const o=-1-i;return new hs(o,n)}}}for(let i=0;i<this.encoders.length;i++){const s=this.encoders[i];if(s!=null){const n=s(e,r);if(n!=null){const o=i;return new hs(o,n)}}}return e instanceof hs?e:null}decode(e,r,i){const s=r<0?this.builtInDecoders[-1-r]:this.decoders[r];return s?s(e,r,i):new hs(r,e)}}ks.defaultCodec=new ks;function A1(t){return t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer}function Ao(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):A1(t)?new Uint8Array(t):Uint8Array.from(t)}const $1=100,O1=2048;let B1=class lf{constructor(e){this.entered=!1,this.extensionCodec=(e==null?void 0:e.extensionCodec)??ks.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(e==null?void 0:e.useBigInt64)??!1,this.maxDepth=(e==null?void 0:e.maxDepth)??$1,this.initialBufferSize=(e==null?void 0:e.initialBufferSize)??O1,this.sortKeys=(e==null?void 0:e.sortKeys)??!1,this.forceFloat32=(e==null?void 0:e.forceFloat32)??!1,this.ignoreUndefined=(e==null?void 0:e.ignoreUndefined)??!1,this.forceIntegerToFloat=(e==null?void 0:e.forceIntegerToFloat)??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new lf({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,r){if(r>this.maxDepth)throw new Error(`Too deep objects in depth ${r}`);e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,r)}ensureBufferSizeToWrite(e){const r=this.pos+e;this.view.byteLength<r&&this.resizeBuffer(r*2)}resizeBuffer(e){const r=new ArrayBuffer(e),i=new Uint8Array(r),s=new DataView(r);i.set(this.bytes),this.view=s,this.bytes=i}encodeNil(){this.writeU8(192)}encodeBoolean(e){e===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){const i=n1(e);this.ensureBufferSizeToWrite(5+i),this.writeStringHeader(i),l1(e,this.bytes,this.pos),this.pos+=i}encodeObject(e,r){const i=this.extensionCodec.tryToEncode(e,this.context);if(i!=null)this.encodeExtension(i);else if(Array.isArray(e))this.encodeArray(e,r);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,r);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){const r=e.byteLength;if(r<256)this.writeU8(196),this.writeU8(r);else if(r<65536)this.writeU8(197),this.writeU16(r);else if(r<4294967296)this.writeU8(198),this.writeU32(r);else throw new Error(`Too large binary: ${r}`);const i=Ao(e);this.writeU8a(i)}encodeArray(e,r){const i=e.length;if(i<16)this.writeU8(144+i);else if(i<65536)this.writeU8(220),this.writeU16(i);else if(i<4294967296)this.writeU8(221),this.writeU32(i);else throw new Error(`Too large array: ${i}`);for(const s of e)this.doEncode(s,r+1)}countWithoutUndefined(e,r){let i=0;for(const s of r)e[s]!==void 0&&i++;return i}encodeMap(e,r){const i=Object.keys(e);this.sortKeys&&i.sort();const s=this.ignoreUndefined?this.countWithoutUndefined(e,i):i.length;if(s<16)this.writeU8(128+s);else if(s<65536)this.writeU8(222),this.writeU16(s);else if(s<4294967296)this.writeU8(223),this.writeU32(s);else throw new Error(`Too large map object: ${s}`);for(const n of i){const o=e[n];this.ignoreUndefined&&o===void 0||(this.encodeString(n),this.doEncode(o,r+1))}}encodeExtension(e){if(typeof e.data=="function"){const i=e.data(this.pos+6),s=i.length;if(s>=4294967296)throw new Error(`Too large extension object: ${s}`);this.writeU8(201),this.writeU32(s),this.writeI8(e.type),this.writeU8a(i);return}const r=e.data.length;if(r===1)this.writeU8(212);else if(r===2)this.writeU8(213);else if(r===4)this.writeU8(214);else if(r===8)this.writeU8(215);else if(r===16)this.writeU8(216);else if(r<256)this.writeU8(199),this.writeU8(r);else if(r<65536)this.writeU8(200),this.writeU16(r);else if(r<4294967296)this.writeU8(201),this.writeU32(r);else throw new Error(`Too large extension object: ${r}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){const r=e.length;this.ensureBufferSizeToWrite(r),this.bytes.set(e,this.pos),this.pos+=r}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),y1(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),cf(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}};function T1(t,e){return new B1(e).encodeSharedRef(t)}function jn(t){return`${t<0?"-":""}0x${Math.abs(t).toString(16).padStart(2,"0")}`}const P1=16,N1=16;class C1{constructor(e=P1,r=N1){this.hit=0,this.miss=0,this.maxKeyLength=e,this.maxLengthPerKey=r,this.caches=[];for(let i=0;i<this.maxKeyLength;i++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,r,i){const s=this.caches[i-1];e:for(const n of s){const o=n.bytes;for(let a=0;a<i;a++)if(o[a]!==e[r+a])continue e;return n.str}return null}store(e,r){const i=this.caches[e.length-1],s={bytes:e,str:r};i.length>=this.maxLengthPerKey?i[Math.random()*i.length|0]=s:i.push(s)}decode(e,r,i){const s=this.find(e,r,i);if(s!=null)return this.hit++,s;this.miss++;const n=af(e,r,i),o=Uint8Array.prototype.slice.call(e,r,r+i);return this.store(o,n),n}}const $o="array",Pi="map_key",hf="map_value",U1=t=>{if(typeof t=="string"||typeof t=="number")return t;throw new it("The type of key must be string or number but "+typeof t)};class R1{constructor(){this.stack=[],this.stackHeadPosition=-1}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(e){const r=this.getUninitializedStateFromPool();r.type=$o,r.position=0,r.size=e,r.array=new Array(e)}pushMapState(e){const r=this.getUninitializedStateFromPool();r.type=Pi,r.readCount=0,r.size=e,r.map={}}getUninitializedStateFromPool(){if(this.stackHeadPosition++,this.stackHeadPosition===this.stack.length){const e={type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null};this.stack.push(e)}return this.stack[this.stackHeadPosition]}release(e){if(this.stack[this.stackHeadPosition]!==e)throw new Error("Invalid stack state. Released state is not on top of the stack.");if(e.type===$o){const i=e;i.size=0,i.array=void 0,i.position=0,i.type=void 0}if(e.type===Pi||e.type===hf){const i=e;i.size=0,i.map=void 0,i.readCount=0,i.type=void 0}this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}const Ei=-1,va=new DataView(new ArrayBuffer(0)),k1=new Uint8Array(va.buffer);try{va.getInt8(0)}catch(t){if(!(t instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}const nu=new RangeError("Insufficient data"),F1=new C1;let L1=class ff{constructor(e){this.totalPos=0,this.pos=0,this.view=va,this.bytes=k1,this.headByte=Ei,this.stack=new R1,this.entered=!1,this.extensionCodec=(e==null?void 0:e.extensionCodec)??ks.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(e==null?void 0:e.useBigInt64)??!1,this.rawStrings=(e==null?void 0:e.rawStrings)??!1,this.maxStrLength=(e==null?void 0:e.maxStrLength)??vi,this.maxBinLength=(e==null?void 0:e.maxBinLength)??vi,this.maxArrayLength=(e==null?void 0:e.maxArrayLength)??vi,this.maxMapLength=(e==null?void 0:e.maxMapLength)??vi,this.maxExtLength=(e==null?void 0:e.maxExtLength)??vi,this.keyDecoder=(e==null?void 0:e.keyDecoder)!==void 0?e.keyDecoder:F1,this.mapKeyConverter=(e==null?void 0:e.mapKeyConverter)??U1}clone(){return new ff({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=Ei,this.stack.reset()}setBuffer(e){const r=Ao(e);this.bytes=r,this.view=new DataView(r.buffer,r.byteOffset,r.byteLength),this.pos=0}appendBuffer(e){if(this.headByte===Ei&&!this.hasRemaining(1))this.setBuffer(e);else{const r=this.bytes.subarray(this.pos),i=Ao(e),s=new Uint8Array(r.length+i.length);s.set(r),s.set(i,r.length),this.setBuffer(s)}}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){const{view:r,pos:i}=this;return new RangeError(`Extra ${r.byteLength-i} of ${r.byteLength} byte(s) found at buffer[${e}]`)}decode(e){if(this.entered)return this.clone().decode(e);try{this.entered=!0,this.reinitializeState(),this.setBuffer(e);const r=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return r}finally{this.entered=!1}}*decodeMulti(e){if(this.entered){yield*this.clone().decodeMulti(e);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(e){if(this.entered)return this.clone().decodeAsync(e);try{this.entered=!0;let r=!1,i;for await(const a of e){if(r)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(a);try{i=this.doDecodeSync(),r=!0}catch(c){if(!(c instanceof RangeError))throw c}this.totalPos+=this.pos}if(r){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return i}const{headByte:s,pos:n,totalPos:o}=this;throw new RangeError(`Insufficient data in parsing ${jn(s)} at ${o} (${n} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async*decodeMultiAsync(e,r){if(this.entered){yield*this.clone().decodeMultiAsync(e,r);return}try{this.entered=!0;let i=r,s=-1;for await(const n of e){if(r&&s===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(n),i&&(s=this.readArraySize(),i=!1,this.complete());try{for(;yield this.doDecodeSync(),--s!==0;);}catch(o){if(!(o instanceof RangeError))throw o}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){e:for(;;){const e=this.readHeadByte();let r;if(e>=224)r=e-256;else if(e<192)if(e<128)r=e;else if(e<144){const s=e-128;if(s!==0){this.pushMapState(s),this.complete();continue e}else r={}}else if(e<160){const s=e-144;if(s!==0){this.pushArrayState(s),this.complete();continue e}else r=[]}else{const s=e-160;r=this.decodeString(s,0)}else if(e===192)r=null;else if(e===194)r=!1;else if(e===195)r=!0;else if(e===202)r=this.readF32();else if(e===203)r=this.readF64();else if(e===204)r=this.readU8();else if(e===205)r=this.readU16();else if(e===206)r=this.readU32();else if(e===207)this.useBigInt64?r=this.readU64AsBigInt():r=this.readU64();else if(e===208)r=this.readI8();else if(e===209)r=this.readI16();else if(e===210)r=this.readI32();else if(e===211)this.useBigInt64?r=this.readI64AsBigInt():r=this.readI64();else if(e===217){const s=this.lookU8();r=this.decodeString(s,1)}else if(e===218){const s=this.lookU16();r=this.decodeString(s,2)}else if(e===219){const s=this.lookU32();r=this.decodeString(s,4)}else if(e===220){const s=this.readU16();if(s!==0){this.pushArrayState(s),this.complete();continue e}else r=[]}else if(e===221){const s=this.readU32();if(s!==0){this.pushArrayState(s),this.complete();continue e}else r=[]}else if(e===222){const s=this.readU16();if(s!==0){this.pushMapState(s),this.complete();continue e}else r={}}else if(e===223){const s=this.readU32();if(s!==0){this.pushMapState(s),this.complete();continue e}else r={}}else if(e===196){const s=this.lookU8();r=this.decodeBinary(s,1)}else if(e===197){const s=this.lookU16();r=this.decodeBinary(s,2)}else if(e===198){const s=this.lookU32();r=this.decodeBinary(s,4)}else if(e===212)r=this.decodeExtension(1,0);else if(e===213)r=this.decodeExtension(2,0);else if(e===214)r=this.decodeExtension(4,0);else if(e===215)r=this.decodeExtension(8,0);else if(e===216)r=this.decodeExtension(16,0);else if(e===199){const s=this.lookU8();r=this.decodeExtension(s,1)}else if(e===200){const s=this.lookU16();r=this.decodeExtension(s,2)}else if(e===201){const s=this.lookU32();r=this.decodeExtension(s,4)}else throw new it(`Unrecognized type byte: ${jn(e)}`);this.complete();const i=this.stack;for(;i.length>0;){const s=i.top();if(s.type===$o)if(s.array[s.position]=r,s.position++,s.position===s.size)r=s.array,i.release(s);else continue e;else if(s.type===Pi){if(r==="__proto__")throw new it("The key __proto__ is not allowed");s.key=this.mapKeyConverter(r),s.type=hf;continue e}else if(s.map[s.key]=r,s.readCount++,s.readCount===s.size)r=s.map,i.release(s);else{s.key=null,s.type=Pi;continue e}}return r}}readHeadByte(){return this.headByte===Ei&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=Ei}readArraySize(){const e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new it(`Unrecognized array type byte: ${jn(e)}`)}}}pushMapState(e){if(e>this.maxMapLength)throw new it(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(e)}pushArrayState(e){if(e>this.maxArrayLength)throw new it(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(e)}decodeString(e,r){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(e,r):this.decodeBinary(e,r)}decodeUtf8String(e,r){var n;if(e>this.maxStrLength)throw new it(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+r+e)throw nu;const i=this.pos+r;let s;return this.stateIsMapKey()&&((n=this.keyDecoder)!=null&&n.canBeCached(e))?s=this.keyDecoder.decode(this.bytes,i,e):s=g1(this.bytes,i,e),this.pos+=r+e,s}stateIsMapKey(){return this.stack.length>0?this.stack.top().type===Pi:!1}decodeBinary(e,r){if(e>this.maxBinLength)throw new it(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+r))throw nu;const i=this.pos+r,s=this.bytes.subarray(i,i+e);return this.pos+=r+e,s}decodeExtension(e,r){if(e>this.maxExtLength)throw new it(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);const i=this.view.getInt8(this.pos+r),s=this.decodeBinary(e,r+1);return this.extensionCodec.decode(s,i,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){const e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){const e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){const e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){const e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){const e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){const e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){const e=w1(this.view,this.pos);return this.pos+=8,e}readI64(){const e=uf(this.view,this.pos);return this.pos+=8,e}readU64AsBigInt(){const e=this.view.getBigUint64(this.pos);return this.pos+=8,e}readI64AsBigInt(){const e=this.view.getBigInt64(this.pos);return this.pos+=8,e}readF32(){const e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){const e=this.view.getFloat64(this.pos);return this.pos+=8,e}};function M1(t,e){return new L1(e).decode(t)}function Ea(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function df(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Ea(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Ni(t,e){e||(e=t.reduce((s,n)=>s+n.length,0));const r=df(e);let i=0;for(const s of t)r.set(s,i),i+=s.length;return Ea(r)}function q1(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var s=0;s<t.length;s++){var n=t.charAt(s),o=n.charCodeAt(0);if(r[o]!==255)throw new TypeError(n+" is ambiguous");r[o]=s}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,b=0,v=0,_=d.length;v!==_&&d[v]===0;)v++,p++;for(var m=(_-v)*l+1>>>0,x=new Uint8Array(m);v!==_;){for(var D=d[v],O=0,N=m-1;(D!==0||O<b)&&N!==-1;N--,O++)D+=256*x[N]>>>0,x[N]=D%a>>>0,D=D/a>>>0;if(D!==0)throw new Error("Non-zero carry");b=O,v++}for(var R=m-b;R!==m&&x[R]===0;)R++;for(var T=c.repeat(p);R<m;++R)T+=t.charAt(x[R]);return T}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var p=0;if(d[p]!==" "){for(var b=0,v=0;d[p]===c;)b++,p++;for(var _=(d.length-p)*u+1>>>0,m=new Uint8Array(_);d[p];){var x=r[d.charCodeAt(p)];if(x===255)return;for(var D=0,O=_-1;(x!==0||D<v)&&O!==-1;O--,D++)x+=a*m[O]>>>0,m[O]=x%256>>>0,x=x/256>>>0;if(x!==0)throw new Error("Non-zero carry");v=D,p++}if(d[p]!==" "){for(var N=_-v;N!==_&&m[N]===0;)N++;for(var R=new Uint8Array(b+(_-N)),T=b;N!==_;)R[T++]=m[N++];return R}}}function g(d){var p=f(d);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:g}}var j1=q1,z1=j1;const V1=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},K1=t=>new TextEncoder().encode(t),H1=t=>new TextDecoder().decode(t);class W1{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class G1{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return pf(this,e)}}class Y1{constructor(e){this.decoders=e}or(e){return pf(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const pf=(t,e)=>new Y1({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class Z1{constructor(e,r,i,s){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=s,this.encoder=new W1(e,r,i),this.decoder=new G1(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const en=({name:t,prefix:e,encode:r,decode:i})=>new Z1(t,e,r,i),Yi=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:s}=z1(r,e);return en({prefix:t,name:e,encode:i,decode:n=>V1(s(n))})},J1=(t,e,r,i)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let n=t.length;for(;t[n-1]==="=";)--n;const o=new Uint8Array(n*r/8|0);let a=0,c=0,u=0;for(let l=0;l<n;++l){const h=s[t[l]];if(h===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},X1=(t,e,r)=>{const i=e[e.length-1]==="=",s=(1<<r)-1;let n="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,n+=e[s&a>>o];if(o&&(n+=e[s&a<<r-o]),i)for(;n.length*r&7;)n+="=";return n},Ne=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>en({prefix:e,name:t,encode(s){return X1(s,i,r)},decode(s){return J1(s,i,r,t)}}),Q1=en({prefix:"\0",name:"identity",encode:t=>H1(t),decode:t=>K1(t)}),e2=Object.freeze(Object.defineProperty({__proto__:null,identity:Q1},Symbol.toStringTag,{value:"Module"})),t2=Ne({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),r2=Object.freeze(Object.defineProperty({__proto__:null,base2:t2},Symbol.toStringTag,{value:"Module"})),i2=Ne({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),s2=Object.freeze(Object.defineProperty({__proto__:null,base8:i2},Symbol.toStringTag,{value:"Module"})),n2=Yi({prefix:"9",name:"base10",alphabet:"0123456789"}),o2=Object.freeze(Object.defineProperty({__proto__:null,base10:n2},Symbol.toStringTag,{value:"Module"})),a2=Ne({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),c2=Ne({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),u2=Object.freeze(Object.defineProperty({__proto__:null,base16:a2,base16upper:c2},Symbol.toStringTag,{value:"Module"})),l2=Ne({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),h2=Ne({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),f2=Ne({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),d2=Ne({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),p2=Ne({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),g2=Ne({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),y2=Ne({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),w2=Ne({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),b2=Ne({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),m2=Object.freeze(Object.defineProperty({__proto__:null,base32:l2,base32hex:p2,base32hexpad:y2,base32hexpadupper:w2,base32hexupper:g2,base32pad:f2,base32padupper:d2,base32upper:h2,base32z:b2},Symbol.toStringTag,{value:"Module"})),v2=Yi({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),E2=Yi({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),x2=Object.freeze(Object.defineProperty({__proto__:null,base36:v2,base36upper:E2},Symbol.toStringTag,{value:"Module"})),I2=Yi({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),_2=Yi({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),S2=Object.freeze(Object.defineProperty({__proto__:null,base58btc:I2,base58flickr:_2},Symbol.toStringTag,{value:"Module"})),D2=Ne({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),A2=Ne({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),$2=Ne({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),O2=Ne({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),B2=Object.freeze(Object.defineProperty({__proto__:null,base64:D2,base64pad:A2,base64url:$2,base64urlpad:O2},Symbol.toStringTag,{value:"Module"})),gf=Array.from(""),T2=gf.reduce((t,e,r)=>(t[r]=e,t),[]),P2=gf.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function N2(t){return t.reduce((e,r)=>(e+=T2[r],e),"")}function C2(t){const e=[];for(const r of t){const i=P2[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const U2=en({prefix:"",name:"base256emoji",encode:N2,decode:C2}),R2=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:U2},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const ou={...e2,...r2,...s2,...o2,...u2,...m2,...x2,...S2,...B2,...R2};function yf(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const au=yf("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),zn=yf("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=df(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),wf={utf8:au,"utf-8":au,hex:ou.base16,latin1:zn,ascii:zn,binary:zn,...ou};function gt(t,e="utf8"){const r=wf[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Ea(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function Qe(t,e="utf8"){const r=wf[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}const k2={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};var Vn,cu;function bf(){if(cu)return Vn;cu=1;const t="Input must be an string, Buffer or Uint8Array";function e(o){let a;if(o instanceof Uint8Array)a=o;else if(typeof o=="string")a=new TextEncoder().encode(o);else throw new Error(t);return a}function r(o){return Array.prototype.map.call(o,function(a){return(a<16?"0":"")+a.toString(16)}).join("")}function i(o){return(4294967296+o).toString(16).substring(1)}function s(o,a,c){let u=`
`+o+" = ";for(let l=0;l<a.length;l+=2){if(c===32)u+=i(a[l]).toUpperCase(),u+=" ",u+=i(a[l+1]).toUpperCase();else if(c===64)u+=i(a[l+1]).toUpperCase(),u+=i(a[l]).toUpperCase();else throw new Error("Invalid size "+c);l%6===4?u+=`
`+new Array(o.length+4).join(" "):l<a.length-2&&(u+=" ")}console.log(u)}function n(o,a,c){let u=new Date().getTime();const l=new Uint8Array(a);for(let f=0;f<a;f++)l[f]=f%256;const h=new Date().getTime();console.log("Generated random input in "+(h-u)+"ms"),u=h;for(let f=0;f<c;f++){const g=o(l),d=new Date().getTime(),p=d-u;u=d,console.log("Hashed in "+p+"ms: "+g.substring(0,20)+"..."),console.log(Math.round(a/(1<<20)/(p/1e3)*100)/100+" MB PER SECOND")}}return Vn={normalizeInput:e,toHex:r,debugPrint:s,testSpeed:n},Vn}var Kn,uu;function F2(){if(uu)return Kn;uu=1;const t=bf();function e(v,_,m){const x=v[_]+v[m];let D=v[_+1]+v[m+1];x>=4294967296&&D++,v[_]=x,v[_+1]=D}function r(v,_,m,x){let D=v[_]+m;m<0&&(D+=4294967296);let O=v[_+1]+x;D>=4294967296&&O++,v[_]=D,v[_+1]=O}function i(v,_){return v[_]^v[_+1]<<8^v[_+2]<<16^v[_+3]<<24}function s(v,_,m,x,D,O){const N=u[D],R=u[D+1],T=u[O],q=u[O+1];e(c,v,_),r(c,v,N,R);let F=c[x]^c[v],P=c[x+1]^c[v+1];c[x]=P,c[x+1]=F,e(c,m,x),F=c[_]^c[m],P=c[_+1]^c[m+1],c[_]=F>>>24^P<<8,c[_+1]=P>>>24^F<<8,e(c,v,_),r(c,v,T,q),F=c[x]^c[v],P=c[x+1]^c[v+1],c[x]=F>>>16^P<<16,c[x+1]=P>>>16^F<<16,e(c,m,x),F=c[_]^c[m],P=c[_+1]^c[m+1],c[_]=P>>>31^F<<1,c[_+1]=F>>>31^P<<1}const n=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),o=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3],a=new Uint8Array(o.map(function(v){return v*2})),c=new Uint32Array(32),u=new Uint32Array(32);function l(v,_){let m=0;for(m=0;m<16;m++)c[m]=v.h[m],c[m+16]=n[m];for(c[24]=c[24]^v.t,c[25]=c[25]^v.t/4294967296,_&&(c[28]=~c[28],c[29]=~c[29]),m=0;m<32;m++)u[m]=i(v.b,4*m);for(m=0;m<12;m++)s(0,8,16,24,a[m*16+0],a[m*16+1]),s(2,10,18,26,a[m*16+2],a[m*16+3]),s(4,12,20,28,a[m*16+4],a[m*16+5]),s(6,14,22,30,a[m*16+6],a[m*16+7]),s(0,10,20,30,a[m*16+8],a[m*16+9]),s(2,12,22,24,a[m*16+10],a[m*16+11]),s(4,14,16,26,a[m*16+12],a[m*16+13]),s(6,8,18,28,a[m*16+14],a[m*16+15]);for(m=0;m<16;m++)v.h[m]=v.h[m]^c[m]^c[m+16]}const h=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function f(v,_,m,x){if(v===0||v>64)throw new Error("Illegal output length, expected 0 < length <= 64");if(_&&_.length>64)throw new Error("Illegal key, expected Uint8Array with 0 < length <= 64");if(m&&m.length!==16)throw new Error("Illegal salt, expected Uint8Array with length is 16");if(x&&x.length!==16)throw new Error("Illegal personal, expected Uint8Array with length is 16");const D={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:v};h.fill(0),h[0]=v,_&&(h[1]=_.length),h[2]=1,h[3]=1,m&&h.set(m,32),x&&h.set(x,48);for(let O=0;O<16;O++)D.h[O]=n[O]^i(h,O*4);return _&&(g(D,_),D.c=128),D}function g(v,_){for(let m=0;m<_.length;m++)v.c===128&&(v.t+=v.c,l(v,!1),v.c=0),v.b[v.c++]=_[m]}function d(v){for(v.t+=v.c;v.c<128;)v.b[v.c++]=0;l(v,!0);const _=new Uint8Array(v.outlen);for(let m=0;m<v.outlen;m++)_[m]=v.h[m>>2]>>8*(m&3);return _}function p(v,_,m,x,D){m=m||64,v=t.normalizeInput(v),x&&(x=t.normalizeInput(x)),D&&(D=t.normalizeInput(D));const O=f(m,_,x,D);return g(O,v),d(O)}function b(v,_,m,x,D){const O=p(v,_,m,x,D);return t.toHex(O)}return Kn={blake2b:p,blake2bHex:b,blake2bInit:f,blake2bUpdate:g,blake2bFinal:d},Kn}var Hn,lu;function L2(){if(lu)return Hn;lu=1;const t=bf();function e(d,p){return d[p]^d[p+1]<<8^d[p+2]<<16^d[p+3]<<24}function r(d,p,b,v,_,m){o[d]=o[d]+o[p]+_,o[v]=i(o[v]^o[d],16),o[b]=o[b]+o[v],o[p]=i(o[p]^o[b],12),o[d]=o[d]+o[p]+m,o[v]=i(o[v]^o[d],8),o[b]=o[b]+o[v],o[p]=i(o[p]^o[b],7)}function i(d,p){return d>>>p^d<<32-p}const s=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),n=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),o=new Uint32Array(16),a=new Uint32Array(16);function c(d,p){let b=0;for(b=0;b<8;b++)o[b]=d.h[b],o[b+8]=s[b];for(o[12]^=d.t,o[13]^=d.t/4294967296,p&&(o[14]=~o[14]),b=0;b<16;b++)a[b]=e(d.b,4*b);for(b=0;b<10;b++)r(0,4,8,12,a[n[b*16+0]],a[n[b*16+1]]),r(1,5,9,13,a[n[b*16+2]],a[n[b*16+3]]),r(2,6,10,14,a[n[b*16+4]],a[n[b*16+5]]),r(3,7,11,15,a[n[b*16+6]],a[n[b*16+7]]),r(0,5,10,15,a[n[b*16+8]],a[n[b*16+9]]),r(1,6,11,12,a[n[b*16+10]],a[n[b*16+11]]),r(2,7,8,13,a[n[b*16+12]],a[n[b*16+13]]),r(3,4,9,14,a[n[b*16+14]],a[n[b*16+15]]);for(b=0;b<8;b++)d.h[b]^=o[b]^o[b+8]}function u(d,p){if(!(d>0&&d<=32))throw new Error("Incorrect output length, should be in [1, 32]");const b=p?p.length:0;if(p&&!(b>0&&b<=32))throw new Error("Incorrect key length, should be in [1, 32]");const v={h:new Uint32Array(s),b:new Uint8Array(64),c:0,t:0,outlen:d};return v.h[0]^=16842752^b<<8^d,b>0&&(l(v,p),v.c=64),v}function l(d,p){for(let b=0;b<p.length;b++)d.c===64&&(d.t+=d.c,c(d,!1),d.c=0),d.b[d.c++]=p[b]}function h(d){for(d.t+=d.c;d.c<64;)d.b[d.c++]=0;c(d,!0);const p=new Uint8Array(d.outlen);for(let b=0;b<d.outlen;b++)p[b]=d.h[b>>2]>>8*(b&3)&255;return p}function f(d,p,b){b=b||32,d=t.normalizeInput(d);const v=u(b,p);return l(v,d),h(v)}function g(d,p,b){const v=f(d,p,b);return t.toHex(v)}return Hn={blake2s:f,blake2sHex:g,blake2sInit:u,blake2sUpdate:l,blake2sFinal:h},Hn}var Wn,hu;function M2(){if(hu)return Wn;hu=1;const t=F2(),e=L2();return Wn={blake2b:t.blake2b,blake2bHex:t.blake2bHex,blake2bInit:t.blake2bInit,blake2bUpdate:t.blake2bUpdate,blake2bFinal:t.blake2bFinal,blake2s:e.blake2s,blake2sHex:e.blake2sHex,blake2sInit:e.blake2sInit,blake2sUpdate:e.blake2sUpdate,blake2sFinal:e.blake2sFinal},Wn}var q2=M2(),j2={};const z2=":";function Es(t){const[e,r]=t.split(z2);return{namespace:e,reference:r}}function mf(t,e){return t.includes(":")?[t]:e.chains||[]}var V2=Object.defineProperty,K2=Object.defineProperties,H2=Object.getOwnPropertyDescriptors,fu=Object.getOwnPropertySymbols,W2=Object.prototype.hasOwnProperty,G2=Object.prototype.propertyIsEnumerable,Oo=(t,e,r)=>e in t?V2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,du=(t,e)=>{for(var r in e||(e={}))W2.call(e,r)&&Oo(t,r,e[r]);if(fu)for(var r of fu(e))G2.call(e,r)&&Oo(t,r,e[r]);return t},Y2=(t,e)=>K2(t,H2(e)),pu=(t,e,r)=>Oo(t,typeof e!="symbol"?e+"":e,r);const Z2="ReactNative",nt={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},J2="js";function Fs(){return typeof Gt<"u"&&typeof Gt.versions<"u"&&typeof Gt.versions.node<"u"}function vr(){return!Zt.getDocument()&&!!Zt.getNavigator()&&navigator.product===Z2}function X2(){return vr()&&typeof Z<"u"&&typeof(Z==null?void 0:Z.Platform)<"u"&&(Z==null?void 0:Z.Platform.OS)==="android"}function Q2(){return vr()&&typeof Z<"u"&&typeof(Z==null?void 0:Z.Platform)<"u"&&(Z==null?void 0:Z.Platform.OS)==="ios"}function fi(){return!Fs()&&!!Zt.getNavigator()&&!!Zt.getDocument()}function Zi(){return vr()?nt.reactNative:Fs()?nt.node:fi()?nt.browser:nt.unknown}function gu(){var t;try{return vr()&&typeof Z<"u"&&typeof(Z==null?void 0:Z.Application)<"u"?(t=Z.Application)==null?void 0:t.applicationId:void 0}catch{return}}function ev(t,e){const r=new URLSearchParams(t);return Object.entries(e).sort(([i],[s])=>i.localeCompare(s)).forEach(([i,s])=>{s!=null&&r.set(i,String(s))}),r.toString()}function tv(t){var e,r;const i=vf();try{return t!=null&&t.url&&i.url&&new URL(t.url).host!==new URL(i.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${t.url} differs from the actual page url:${i.url}. This is probably unintended and can lead to issues.`),t.url=i.url),(e=t==null?void 0:t.icons)!=null&&e.length&&t.icons.length>0&&(t.icons=t.icons.filter(s=>s!=="")),Y2(du(du({},i),t),{url:(t==null?void 0:t.url)||i.url,name:(t==null?void 0:t.name)||i.name,description:(t==null?void 0:t.description)||i.description,icons:(r=t==null?void 0:t.icons)!=null&&r.length&&t.icons.length>0?t.icons:i.icons})}catch(s){return console.warn("Error populating app metadata",s),t||i}}function vf(){return Zw.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function rv(){if(Zi()===nt.reactNative&&typeof Z<"u"&&typeof(Z==null?void 0:Z.Platform)<"u"){const{OS:r,Version:i}=Z.Platform;return[r,i].join("-")}const t=zw();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function iv(){var t;const e=Zi();return e===nt.browser?[e,((t=Zt.getLocation())==null?void 0:t.host)||"unknown"].join(":"):e}function Ef(t,e,r){const i=rv(),s=iv();return[[t,e].join("-"),[J2,r].join("-"),i,s].join("/")}function sv({protocol:t,version:e,relayUrl:r,sdkVersion:i,auth:s,projectId:n,useOnCloseEvent:o,bundleId:a,packageName:c}){const u=r.split("?"),l=Ef(t,e,i),h={auth:s,ua:l,projectId:n,useOnCloseEvent:o,packageName:c||void 0,bundleId:a||void 0},f=ev(u[1]||"",h);return u[0]+"?"+f}function Tr(t,e){return t.filter(r=>e.includes(r)).length===t.length}function Bo(t){return Object.fromEntries(t.entries())}function To(t){return new Map(Object.entries(t))}function Ar(t=V.FIVE_MINUTES,e){const r=V.toMiliseconds(t||V.FIVE_MINUTES);let i,s,n,o;return{resolve:a=>{n&&i&&(clearTimeout(n),i(a),o=Promise.resolve(a))},reject:a=>{n&&s&&(clearTimeout(n),s(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);n=setTimeout(()=>{const u=new Error(e);o=Promise.reject(u),c(u)},r),i=a,s=c})}}function Nt(t,e,r){return new Promise(async(i,s)=>{const n=setTimeout(()=>s(new Error(r)),e);try{const o=await t;i(o)}catch(o){s(o)}clearTimeout(n)})}function xf(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function nv(t){return xf("topic",t)}function ov(t){return xf("id",t)}function If(t){const[e,r]=t.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")i.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))i.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return i}function Ee(t,e){return V.fromMiliseconds(Date.now()+V.toMiliseconds(t))}function ur(t){return Date.now()>=V.toMiliseconds(t)}function ne(t,e){return`${t}${e?`:${e}`:""}`}function Rr(t=[],e=[]){return[...new Set([...t,...e])]}async function av({id:t,topic:e,wcDeepLink:r}){var i;try{if(!r)return;const s=typeof r=="string"?JSON.parse(r):r,n=s==null?void 0:s.href;if(typeof n!="string")return;const o=cv(n,t,e),a=Zi();if(a===nt.browser){if(!((i=Zt.getDocument())!=null&&i.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}uv(o)}else a===nt.reactNative&&typeof(Z==null?void 0:Z.Linking)<"u"&&await Z.Linking.openURL(o)}catch(s){console.error(s)}}function cv(t,e,r){const i=`requestId=${e}&sessionTopic=${r}`;t.endsWith("/")&&(t=t.slice(0,-1));let s=`${t}`;if(t.startsWith("https://t.me")){const n=t.includes("?")?"&startapp=":"?startapp=";s=`${s}${n}${dv(i,!0)}`}else s=`${s}/wc?${i}`;return s}function uv(t){let e="_self";fv()?e="_top":(hv()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"),window.open(t,e,"noreferrer noopener")}async function lv(t,e){let r="";try{if(fi()&&(r=localStorage.getItem(e),r))return r;r=await t.getItem(e)}catch(i){console.error(i)}return r}function yu(t,e){if(!t.includes(e))return null;const r=t.split(/([&,?,=])/),i=r.indexOf(e);return r[i+2]}function wu(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function xa(){return typeof Gt<"u"&&j2.IS_VITEST==="true"}function hv(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function fv(){try{return window.self!==window.top}catch{return!1}}function dv(t,e=!1){const r=se.from(t).toString("base64");return e?r.replace(/[=]/g,""):r}function _f(t){return se.from(t,"base64").toString("utf-8")}function pv(t){return new Promise(e=>setTimeout(e,t))}let gv=class{constructor({limit:e}){pu(this,"limit"),pu(this,"set"),this.limit=e,this.set=new Set}add(e){if(!this.set.has(e)){if(this.set.size>=this.limit){const r=this.set.values().next().value;r&&this.set.delete(r)}this.set.add(e)}}has(e){return this.set.has(e)}};const fs=BigInt(2**32-1),bu=BigInt(32);function Sf(t,e=!1){return e?{h:Number(t&fs),l:Number(t>>bu&fs)}:{h:Number(t>>bu&fs)|0,l:Number(t&fs)|0}}function Df(t,e=!1){const r=t.length;let i=new Uint32Array(r),s=new Uint32Array(r);for(let n=0;n<r;n++){const{h:o,l:a}=Sf(t[n],e);[i[n],s[n]]=[o,a]}return[i,s]}const mu=(t,e,r)=>t>>>r,vu=(t,e,r)=>t<<32-r|e>>>r,lr=(t,e,r)=>t>>>r|e<<32-r,hr=(t,e,r)=>t<<32-r|e>>>r,Oi=(t,e,r)=>t<<64-r|e>>>r-32,Bi=(t,e,r)=>t>>>r-32|e<<64-r,yv=(t,e)=>e,wv=(t,e)=>t,bv=(t,e,r)=>t<<r|e>>>32-r,mv=(t,e,r)=>e<<r|t>>>32-r,vv=(t,e,r)=>e<<r-32|t>>>64-r,Ev=(t,e,r)=>t<<r-32|e>>>64-r;function xt(t,e,r,i){const s=(e>>>0)+(i>>>0);return{h:t+r+(s/2**32|0)|0,l:s|0}}const Ia=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),_a=(t,e,r,i)=>e+r+i+(t/2**32|0)|0,xv=(t,e,r,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0),Iv=(t,e,r,i,s)=>e+r+i+s+(t/2**32|0)|0,_v=(t,e,r,i,s)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0)+(s>>>0),Sv=(t,e,r,i,s,n)=>e+r+i+s+n+(t/2**32|0)|0,Yr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function tn(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Jt(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function _t(t,...e){if(!tn(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function rn(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Jt(t.outputLen),Jt(t.blockLen)}function mr(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Sa(t,e){_t(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Mi(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function yt(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function Gn(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function $t(t,e){return t<<32-e|t>>>e}const Af=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function $f(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}const Mt=Af?t=>t:t=>$f(t);function Dv(t){for(let e=0;e<t.length;e++)t[e]=$f(t[e]);return t}const fr=Af?t=>t:Dv,Of=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",Av=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function si(t){if(_t(t),Of)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=Av[t[r]];return e}const Lt={_0:48,_9:57,A:65,F:70,a:97,f:102};function Eu(t){if(t>=Lt._0&&t<=Lt._9)return t-Lt._0;if(t>=Lt.A&&t<=Lt.F)return t-(Lt.A-10);if(t>=Lt.a&&t<=Lt.f)return t-(Lt.a-10)}function Ls(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(Of)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(r);for(let s=0,n=0;s<r;s++,n+=2){const o=Eu(t.charCodeAt(n)),a=Eu(t.charCodeAt(n+1));if(o===void 0||a===void 0){const c=t[n]+t[n+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+n)}i[s]=o*16+a}return i}function Bf(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function It(t){return typeof t=="string"&&(t=Bf(t)),_t(t),t}function pr(...t){let e=0;for(let i=0;i<t.length;i++){const s=t[i];_t(s),e+=s.length}const r=new Uint8Array(e);for(let i=0,s=0;i<t.length;i++){const n=t[i];r.set(n,s),s+=n.length}return r}class sn{}function Ji(t){const e=i=>t().update(It(i)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function $v(t){const e=(i,s)=>t(s).update(It(i)).digest(),r=t({});return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=i=>t(i),e}function zr(t=32){if(Yr&&typeof Yr.getRandomValues=="function")return Yr.getRandomValues(new Uint8Array(t));if(Yr&&typeof Yr.randomBytes=="function")return Uint8Array.from(Yr.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const Ov=BigInt(0),xi=BigInt(1),Bv=BigInt(2),Tv=BigInt(7),Pv=BigInt(256),Nv=BigInt(113),Tf=[],Pf=[],Nf=[];for(let t=0,e=xi,r=1,i=0;t<24;t++){[r,i]=[i,(2*r+3*i)%5],Tf.push(2*(5*i+r)),Pf.push((t+1)*(t+2)/2%64);let s=Ov;for(let n=0;n<7;n++)e=(e<<xi^(e>>Tv)*Nv)%Pv,e&Bv&&(s^=xi<<(xi<<BigInt(n))-xi);Nf.push(s)}const Cf=Df(Nf,!0),Cv=Cf[0],Uv=Cf[1],xu=(t,e,r)=>r>32?vv(t,e,r):bv(t,e,r),Iu=(t,e,r)=>r>32?Ev(t,e,r):mv(t,e,r);function Rv(t,e=24){const r=new Uint32Array(10);for(let i=24-e;i<24;i++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,u=r[c],l=r[c+1],h=xu(u,l,1)^r[a],f=Iu(u,l,1)^r[a+1];for(let g=0;g<50;g+=10)t[o+g]^=h,t[o+g+1]^=f}let s=t[2],n=t[3];for(let o=0;o<24;o++){const a=Pf[o],c=xu(s,n,a),u=Iu(s,n,a),l=Tf[o];s=t[l],n=t[l+1],t[l]=c,t[l+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=Cv[i],t[1]^=Uv[i]}yt(r)}let kv=class Uf extends sn{constructor(e,r,i,s=!1,n=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=i,this.enableXOF=s,this.rounds=n,Jt(i),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Mi(this.state)}clone(){return this._cloneInto()}keccak(){fr(this.state32),Rv(this.state32,this.rounds),fr(this.state32),this.posOut=0,this.pos=0}update(e){mr(this),e=It(e),_t(e);const{blockLen:r,state:i}=this,s=e.length;for(let n=0;n<s;){const o=Math.min(r-this.pos,s-n);for(let a=0;a<o;a++)i[this.pos++]^=e[n++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:i,blockLen:s}=this;e[i]^=r,(r&128)!==0&&i===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){mr(this,!1),_t(e),this.finish();const r=this.state,{blockLen:i}=this;for(let s=0,n=e.length;s<n;){this.posOut>=i&&this.keccak();const o=Math.min(i-this.posOut,n-s);e.set(r.subarray(this.posOut,this.posOut+o),s),this.posOut+=o,s+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Jt(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Sa(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,yt(this.state)}_cloneInto(e){const{blockLen:r,suffix:i,outputLen:s,rounds:n,enableXOF:o}=this;return e||(e=new Uf(r,i,s,o,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=i,e.outputLen=s,e.enableXOF=o,e.destroyed=this.destroyed,e}};const Fv=(t,e,r)=>Ji(()=>new kv(e,t,r)),Lv=Fv(1,136,256/8);function Mv(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const s=BigInt(32),n=BigInt(4294967295),o=Number(r>>s&n),a=Number(r&n),c=i?4:0,u=i?0:4;t.setUint32(e+c,o,i),t.setUint32(e+u,a,i)}function qv(t,e,r){return t&e^~t&r}function jv(t,e,r){return t&e^t&r^e&r}let Rf=class extends sn{constructor(e,r,i,s){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=i,this.isLE=s,this.buffer=new Uint8Array(e),this.view=Gn(this.buffer)}update(e){mr(this),e=It(e),_t(e);const{view:r,buffer:i,blockLen:s}=this,n=e.length;for(let o=0;o<n;){const a=Math.min(s-this.pos,n-o);if(a===s){const c=Gn(e);for(;s<=n-o;o+=s)this.process(c,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){mr(this),Sa(e,this),this.finished=!0;const{buffer:r,view:i,blockLen:s,isLE:n}=this;let{pos:o}=this;r[o++]=128,yt(this.buffer.subarray(o)),this.padOffset>s-o&&(this.process(i,0),o=0);for(let h=o;h<s;h++)r[h]=0;Mv(i,s-8,BigInt(this.length*8),n),this.process(i,0);const a=Gn(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)a.setUint32(4*h,l[h],n)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:i,length:s,finished:n,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=n,e.length=s,e.pos=a,s%r&&e.buffer.set(i),e}clone(){return this._cloneInto()}};const ir=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ue=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),Re=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),zv=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),sr=new Uint32Array(64);class Vv extends Rf{constructor(e=32){super(64,e,8,!1),this.A=ir[0]|0,this.B=ir[1]|0,this.C=ir[2]|0,this.D=ir[3]|0,this.E=ir[4]|0,this.F=ir[5]|0,this.G=ir[6]|0,this.H=ir[7]|0}get(){const{A:e,B:r,C:i,D:s,E:n,F:o,G:a,H:c}=this;return[e,r,i,s,n,o,a,c]}set(e,r,i,s,n,o,a,c){this.A=e|0,this.B=r|0,this.C=i|0,this.D=s|0,this.E=n|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let h=0;h<16;h++,r+=4)sr[h]=e.getUint32(r,!1);for(let h=16;h<64;h++){const f=sr[h-15],g=sr[h-2],d=$t(f,7)^$t(f,18)^f>>>3,p=$t(g,17)^$t(g,19)^g>>>10;sr[h]=p+sr[h-7]+d+sr[h-16]|0}let{A:i,B:s,C:n,D:o,E:a,F:c,G:u,H:l}=this;for(let h=0;h<64;h++){const f=$t(a,6)^$t(a,11)^$t(a,25),g=l+f+qv(a,c,u)+zv[h]+sr[h]|0,d=($t(i,2)^$t(i,13)^$t(i,22))+jv(i,s,n)|0;l=u,u=c,c=a,a=o+g|0,o=n,n=s,s=i,i=g+d|0}i=i+this.A|0,s=s+this.B|0,n=n+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(i,s,n,o,a,c,u,l)}roundClean(){yt(sr)}destroy(){this.set(0,0,0,0,0,0,0,0),yt(this.buffer)}}const kf=Df(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),Kv=kf[0],Hv=kf[1],nr=new Uint32Array(80),or=new Uint32Array(80);let Da=class extends Rf{constructor(e=64){super(128,e,16,!1),this.Ah=Re[0]|0,this.Al=Re[1]|0,this.Bh=Re[2]|0,this.Bl=Re[3]|0,this.Ch=Re[4]|0,this.Cl=Re[5]|0,this.Dh=Re[6]|0,this.Dl=Re[7]|0,this.Eh=Re[8]|0,this.El=Re[9]|0,this.Fh=Re[10]|0,this.Fl=Re[11]|0,this.Gh=Re[12]|0,this.Gl=Re[13]|0,this.Hh=Re[14]|0,this.Hl=Re[15]|0}get(){const{Ah:e,Al:r,Bh:i,Bl:s,Ch:n,Cl:o,Dh:a,Dl:c,Eh:u,El:l,Fh:h,Fl:f,Gh:g,Gl:d,Hh:p,Hl:b}=this;return[e,r,i,s,n,o,a,c,u,l,h,f,g,d,p,b]}set(e,r,i,s,n,o,a,c,u,l,h,f,g,d,p,b){this.Ah=e|0,this.Al=r|0,this.Bh=i|0,this.Bl=s|0,this.Ch=n|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=l|0,this.Fh=h|0,this.Fl=f|0,this.Gh=g|0,this.Gl=d|0,this.Hh=p|0,this.Hl=b|0}process(e,r){for(let m=0;m<16;m++,r+=4)nr[m]=e.getUint32(r),or[m]=e.getUint32(r+=4);for(let m=16;m<80;m++){const x=nr[m-15]|0,D=or[m-15]|0,O=lr(x,D,1)^lr(x,D,8)^mu(x,D,7),N=hr(x,D,1)^hr(x,D,8)^vu(x,D,7),R=nr[m-2]|0,T=or[m-2]|0,q=lr(R,T,19)^Oi(R,T,61)^mu(R,T,6),F=hr(R,T,19)^Bi(R,T,61)^vu(R,T,6),P=xv(N,F,or[m-7],or[m-16]),A=Iv(P,O,q,nr[m-7],nr[m-16]);nr[m]=A|0,or[m]=P|0}let{Ah:i,Al:s,Bh:n,Bl:o,Ch:a,Cl:c,Dh:u,Dl:l,Eh:h,El:f,Fh:g,Fl:d,Gh:p,Gl:b,Hh:v,Hl:_}=this;for(let m=0;m<80;m++){const x=lr(h,f,14)^lr(h,f,18)^Oi(h,f,41),D=hr(h,f,14)^hr(h,f,18)^Bi(h,f,41),O=h&g^~h&p,N=f&d^~f&b,R=_v(_,D,N,Hv[m],or[m]),T=Sv(R,v,x,O,Kv[m],nr[m]),q=R|0,F=lr(i,s,28)^Oi(i,s,34)^Oi(i,s,39),P=hr(i,s,28)^Bi(i,s,34)^Bi(i,s,39),A=i&n^i&a^n&a,B=s&o^s&c^o&c;v=p|0,_=b|0,p=g|0,b=d|0,g=h|0,d=f|0,{h,l:f}=xt(u|0,l|0,T|0,q|0),u=a|0,l=c|0,a=n|0,c=o|0,n=i|0,o=s|0;const y=Ia(q,P,B);i=_a(y,T,F,A),s=y|0}({h:i,l:s}=xt(this.Ah|0,this.Al|0,i|0,s|0)),{h:n,l:o}=xt(this.Bh|0,this.Bl|0,n|0,o|0),{h:a,l:c}=xt(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l}=xt(this.Dh|0,this.Dl|0,u|0,l|0),{h,l:f}=xt(this.Eh|0,this.El|0,h|0,f|0),{h:g,l:d}=xt(this.Fh|0,this.Fl|0,g|0,d|0),{h:p,l:b}=xt(this.Gh|0,this.Gl|0,p|0,b|0),{h:v,l:_}=xt(this.Hh|0,this.Hl|0,v|0,_|0),this.set(i,s,n,o,a,c,u,l,h,f,g,d,p,b,v,_)}roundClean(){yt(nr,or)}destroy(){yt(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};class Wv extends Da{constructor(){super(48),this.Ah=Ue[0]|0,this.Al=Ue[1]|0,this.Bh=Ue[2]|0,this.Bl=Ue[3]|0,this.Ch=Ue[4]|0,this.Cl=Ue[5]|0,this.Dh=Ue[6]|0,this.Dl=Ue[7]|0,this.Eh=Ue[8]|0,this.El=Ue[9]|0,this.Fh=Ue[10]|0,this.Fl=Ue[11]|0,this.Gh=Ue[12]|0,this.Gl=Ue[13]|0,this.Hh=Ue[14]|0,this.Hl=Ue[15]|0}}const ke=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class Gv extends Da{constructor(){super(32),this.Ah=ke[0]|0,this.Al=ke[1]|0,this.Bh=ke[2]|0,this.Bl=ke[3]|0,this.Ch=ke[4]|0,this.Cl=ke[5]|0,this.Dh=ke[6]|0,this.Dl=ke[7]|0,this.Eh=ke[8]|0,this.El=ke[9]|0,this.Fh=ke[10]|0,this.Fl=ke[11]|0,this.Gh=ke[12]|0,this.Gl=ke[13]|0,this.Hh=ke[14]|0,this.Hl=ke[15]|0}}const nn=Ji(()=>new Vv),Yv=Ji(()=>new Da),Zv=Ji(()=>new Wv),Jv=Ji(()=>new Gv),Xv=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),ve=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),K=new Uint32Array(32);function ar(t,e,r,i,s,n){const o=s[n],a=s[n+1];let c=K[2*t],u=K[2*t+1],l=K[2*e],h=K[2*e+1],f=K[2*r],g=K[2*r+1],d=K[2*i],p=K[2*i+1],b=Ia(c,l,o);u=_a(b,u,h,a),c=b|0,{Dh:p,Dl:d}={Dh:p^u,Dl:d^c},{Dh:p,Dl:d}={Dh:yv(p,d),Dl:wv(p)},{h:g,l:f}=xt(g,f,p,d),{Bh:h,Bl:l}={Bh:h^g,Bl:l^f},{Bh:h,Bl:l}={Bh:lr(h,l,24),Bl:hr(h,l,24)},K[2*t]=c,K[2*t+1]=u,K[2*e]=l,K[2*e+1]=h,K[2*r]=f,K[2*r+1]=g,K[2*i]=d,K[2*i+1]=p}function cr(t,e,r,i,s,n){const o=s[n],a=s[n+1];let c=K[2*t],u=K[2*t+1],l=K[2*e],h=K[2*e+1],f=K[2*r],g=K[2*r+1],d=K[2*i],p=K[2*i+1],b=Ia(c,l,o);u=_a(b,u,h,a),c=b|0,{Dh:p,Dl:d}={Dh:p^u,Dl:d^c},{Dh:p,Dl:d}={Dh:lr(p,d,16),Dl:hr(p,d,16)},{h:g,l:f}=xt(g,f,p,d),{Bh:h,Bl:l}={Bh:h^g,Bl:l^f},{Bh:h,Bl:l}={Bh:Oi(h,l,63),Bl:Bi(h,l,63)},K[2*t]=c,K[2*t+1]=u,K[2*e]=l,K[2*e+1]=h,K[2*r]=f,K[2*r+1]=g,K[2*i]=d,K[2*i+1]=p}function Qv(t,e={},r,i,s){if(Jt(r),t<0||t>r)throw new Error("outputLen bigger than keyLen");const{key:n,salt:o,personalization:a}=e;if(n!==void 0&&(n.length<1||n.length>r))throw new Error("key length must be undefined or 1.."+r);if(o!==void 0&&o.length!==i)throw new Error("salt must be undefined or "+i);if(a!==void 0&&a.length!==s)throw new Error("personalization must be undefined or "+s)}class eE extends sn{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,Jt(e),Jt(r),this.blockLen=e,this.outputLen=r,this.buffer=new Uint8Array(e),this.buffer32=Mi(this.buffer)}update(e){mr(this),e=It(e),_t(e);const{blockLen:r,buffer:i,buffer32:s}=this,n=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<n;){this.pos===r&&(fr(s),this.compress(s,0,!1),fr(s),this.pos=0);const u=Math.min(r-this.pos,n-c),l=o+c;if(u===r&&!(l%4)&&c+u<n){const h=new Uint32Array(a,l,Math.floor((n-c)/4));fr(h);for(let f=0;c+r<n;f+=s.length,c+=r)this.length+=r,this.compress(h,f,!1);fr(h);continue}i.set(e.subarray(c,c+u),this.pos),this.pos+=u,this.length+=u,c+=u}return this}digestInto(e){mr(this),Sa(e,this);const{pos:r,buffer32:i}=this;this.finished=!0,yt(this.buffer.subarray(r)),fr(i),this.compress(i,0,!0),fr(i);const s=Mi(e);this.get().forEach((n,o)=>s[o]=Mt(n))}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}_cloneInto(e){const{buffer:r,length:i,finished:s,destroyed:n,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(r),e.destroyed=n,e.finished=s,e.length=i,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}}class tE extends eE{constructor(e={}){const r=e.dkLen===void 0?64:e.dkLen;super(128,r),this.v0l=ve[0]|0,this.v0h=ve[1]|0,this.v1l=ve[2]|0,this.v1h=ve[3]|0,this.v2l=ve[4]|0,this.v2h=ve[5]|0,this.v3l=ve[6]|0,this.v3h=ve[7]|0,this.v4l=ve[8]|0,this.v4h=ve[9]|0,this.v5l=ve[10]|0,this.v5h=ve[11]|0,this.v6l=ve[12]|0,this.v6h=ve[13]|0,this.v7l=ve[14]|0,this.v7h=ve[15]|0,Qv(r,e,64,16,16);let{key:i,personalization:s,salt:n}=e,o=0;if(i!==void 0&&(i=It(i),o=i.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,n!==void 0){n=It(n);const a=Mi(n);this.v4l^=Mt(a[0]),this.v4h^=Mt(a[1]),this.v5l^=Mt(a[2]),this.v5h^=Mt(a[3])}if(s!==void 0){s=It(s);const a=Mi(s);this.v6l^=Mt(a[0]),this.v6h^=Mt(a[1]),this.v7l^=Mt(a[2]),this.v7h^=Mt(a[3])}if(i!==void 0){const a=new Uint8Array(this.blockLen);a.set(i),this.update(a)}}get(){let{v0l:e,v0h:r,v1l:i,v1h:s,v2l:n,v2h:o,v3l:a,v3h:c,v4l:u,v4h:l,v5l:h,v5h:f,v6l:g,v6h:d,v7l:p,v7h:b}=this;return[e,r,i,s,n,o,a,c,u,l,h,f,g,d,p,b]}set(e,r,i,s,n,o,a,c,u,l,h,f,g,d,p,b){this.v0l=e|0,this.v0h=r|0,this.v1l=i|0,this.v1h=s|0,this.v2l=n|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=u|0,this.v4h=l|0,this.v5l=h|0,this.v5h=f|0,this.v6l=g|0,this.v6h=d|0,this.v7l=p|0,this.v7h=b|0}compress(e,r,i){this.get().forEach((c,u)=>K[u]=c),K.set(ve,16);let{h:s,l:n}=Sf(BigInt(this.length));K[24]=ve[8]^n,K[25]=ve[9]^s,i&&(K[28]=~K[28],K[29]=~K[29]);let o=0;const a=Xv;for(let c=0;c<12;c++)ar(0,4,8,12,e,r+2*a[o++]),cr(0,4,8,12,e,r+2*a[o++]),ar(1,5,9,13,e,r+2*a[o++]),cr(1,5,9,13,e,r+2*a[o++]),ar(2,6,10,14,e,r+2*a[o++]),cr(2,6,10,14,e,r+2*a[o++]),ar(3,7,11,15,e,r+2*a[o++]),cr(3,7,11,15,e,r+2*a[o++]),ar(0,5,10,15,e,r+2*a[o++]),cr(0,5,10,15,e,r+2*a[o++]),ar(1,6,11,12,e,r+2*a[o++]),cr(1,6,11,12,e,r+2*a[o++]),ar(2,7,8,13,e,r+2*a[o++]),cr(2,7,8,13,e,r+2*a[o++]),ar(3,4,9,14,e,r+2*a[o++]),cr(3,4,9,14,e,r+2*a[o++]);this.v0l^=K[0]^K[16],this.v0h^=K[1]^K[17],this.v1l^=K[2]^K[18],this.v1h^=K[3]^K[19],this.v2l^=K[4]^K[20],this.v2h^=K[5]^K[21],this.v3l^=K[6]^K[22],this.v3h^=K[7]^K[23],this.v4l^=K[8]^K[24],this.v4h^=K[9]^K[25],this.v5l^=K[10]^K[26],this.v5h^=K[11]^K[27],this.v6l^=K[12]^K[28],this.v6h^=K[13]^K[29],this.v7l^=K[14]^K[30],this.v7h^=K[15]^K[31],yt(K)}destroy(){this.destroyed=!0,yt(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const rE=$v(t=>new tE(t)),iE="https://rpc.walletconnect.org/v1";function Ff(t){const e=`Ethereum Signed Message:
${t.length}`,r=new TextEncoder().encode(e+t);return"0x"+se.from(Lv(r)).toString("hex")}async function sE(t,e,r,i,s,n){switch(r.t){case"eip191":return await nE(t,e,r.s);case"eip1271":return await oE(t,e,r.s,i,s,n);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${r.t}`)}}function nE(t,e,r){const i=jm(r);return t1({payload:Ff(e),signature:i}).toLowerCase()===t.toLowerCase()}async function oE(t,e,r,i,s,n){const o=Es(i);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${i}`);try{const a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",u=r.substring(2),l=(u.length/2).toString(16).padStart(64,"0"),h=(e.startsWith("0x")?e:Ff(e)).substring(2),f=a+h+c+l+u,g=await fetch(`${n||iE}/?chainId=${i}&projectId=${s}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:aE(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:f},"latest"]})}),{result:d}=await g.json();return d?d.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function aE(){return Date.now()+Math.floor(Math.random()*1e3)}function cE(t){const e=atob(t),r=new Uint8Array(e.length);for(let o=0;o<e.length;o++)r[o]=e.charCodeAt(o);const i=r[0];if(i===0)throw new Error("No signatures found");const s=1+i*64;if(r.length<s)throw new Error("Transaction data too short for claimed signature count");if(r.length<100)throw new Error("Transaction too short");const n=se.from(t,"base64").slice(1,65);return Gi.encode(n)}function uE(t){const e=new Uint8Array(se.from(t,"base64")),r=Array.from("TransactionData::").map(n=>n.charCodeAt(0)),i=new Uint8Array(r.length+e.length);i.set(r),i.set(e,r.length);const s=rE(i,{dkLen:32});return Gi.encode(s)}function _u(t){const e=new Uint8Array(nn(lE(t)));return Gi.encode(e)}function lE(t){if(t instanceof Uint8Array)return t;if(Array.isArray(t))return new Uint8Array(t);if(typeof t=="object"&&t!=null&&t.data)return new Uint8Array(Object.values(t.data));if(typeof t=="object"&&t)return new Uint8Array(Object.values(t));throw new Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}function Su(t){const e=se.from(t,"base64"),r=M1(e).txn;if(!r)throw new Error("Invalid signed transaction: missing 'txn' field");const i=T1(r),s=se.from("TX"),n=se.concat([s,se.from(i)]),o=Jv(n);return e1.encode(o).replace(/=+$/,"")}function Yn(t){const e=[];let r=BigInt(t);for(;r>=BigInt(128);)e.push(Number(r&BigInt(127)|BigInt(128))),r>>=BigInt(7);return e.push(Number(r)),se.from(e)}function hE(t){const e=se.from(t.signed.bodyBytes,"base64"),r=se.from(t.signed.authInfoBytes,"base64"),i=se.from(t.signature.signature,"base64"),s=[];s.push(se.from([10])),s.push(Yn(e.length)),s.push(e),s.push(se.from([18])),s.push(Yn(r.length)),s.push(r),s.push(se.from([26])),s.push(Yn(i.length)),s.push(i);const n=se.concat(s),o=nn(n);return se.from(o).toString("hex").toUpperCase()}function fE(t){var e,r;const i=[];try{if(typeof t=="string")return i.push(t),i;if(typeof t!="object")return i;t!=null&&t.id&&i.push(t.id);const s=(r=(e=t==null?void 0:t.capabilities)==null?void 0:e.caip345)==null?void 0:r.transactionHashes;s&&i.push(...s)}catch(s){console.warn("getWalletSendCallsHashes failed: ",s)}return i}var dE=Object.defineProperty,pE=Object.defineProperties,gE=Object.getOwnPropertyDescriptors,Du=Object.getOwnPropertySymbols,yE=Object.prototype.hasOwnProperty,wE=Object.prototype.propertyIsEnumerable,Au=(t,e,r)=>e in t?dE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,bE=(t,e)=>{for(var r in e||(e={}))yE.call(e,r)&&Au(t,r,e[r]);if(Du)for(var r of Du(e))wE.call(e,r)&&Au(t,r,e[r]);return t},mE=(t,e)=>pE(t,gE(e));const vE="did:pkh:",Aa=t=>t==null?void 0:t.split(":"),EE=t=>{const e=t&&Aa(t);if(e)return t.includes(vE)?e[3]:e[1]},Po=t=>{const e=t&&Aa(t);if(e)return e[2]+":"+e[3]},Ms=t=>{const e=t&&Aa(t);if(e)return e.pop()};async function $u(t){const{cacao:e,projectId:r}=t,{s:i,p:s}=e,n=Lf(s,s.iss),o=Ms(s.iss);return await sE(o,n,i,Po(s.iss),r)}const Lf=(t,e)=>{const r=`${t.domain} wants you to sign in with your Ethereum account:`,i=Ms(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let s=t.statement||void 0;const n=`URI: ${t.aud||t.uri}`,o=`Version: ${t.version}`,a=`Chain ID: ${EE(e)}`,c=`Nonce: ${t.nonce}`,u=`Issued At: ${t.iat}`,l=t.exp?`Expiration Time: ${t.exp}`:void 0,h=t.nbf?`Not Before: ${t.nbf}`:void 0,f=t.requestId?`Request ID: ${t.requestId}`:void 0,g=t.resources?`Resources:${t.resources.map(p=>`
- ${p}`).join("")}`:void 0,d=xs(t.resources);if(d){const p=qi(d);s=BE(s,p)}return[r,i,"",s,"",n,o,a,c,u,l,h,f,g].filter(p=>p!=null).join(`
`)};function xE(t){return se.from(JSON.stringify(t)).toString("base64")}function IE(t){return JSON.parse(se.from(t,"base64").toString("utf-8"))}function Fr(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");const e=Object.keys(t.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(r=>{const i=t.att[r];if(Array.isArray(i))throw new Error(`Resource must be an object: ${r}`);if(typeof i!="object")throw new Error(`Resource must be an object: ${r}`);if(!Object.keys(i).length)throw new Error(`Resource object is empty: ${r}`);Object.keys(i).forEach(s=>{const n=i[s];if(!Array.isArray(n))throw new Error(`Ability limits ${s} must be an array of objects, found: ${n}`);if(!n.length)throw new Error(`Value of ${s} is empty array, must be an array with objects`);n.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${s}) must be an array of objects, found: ${o}`)})})})}function _E(t,e,r,i={}){return r==null||r.sort((s,n)=>s.localeCompare(n)),{att:{[t]:SE(e,r,i)}}}function SE(t,e,r={}){e=e==null?void 0:e.sort((s,n)=>s.localeCompare(n));const i=e.map(s=>({[`${t}/${s}`]:[r]}));return Object.assign({},...i)}function Mf(t){return Fr(t),`urn:recap:${xE(t).replace(/=/g,"")}`}function qi(t){const e=IE(t.replace("urn:recap:",""));return Fr(e),e}function DE(t,e,r){const i=_E(t,e,r);return Mf(i)}function AE(t){return t&&t.includes("urn:recap:")}function $E(t,e){const r=qi(t),i=qi(e),s=OE(r,i);return Mf(s)}function OE(t,e){Fr(t),Fr(e);const r=Object.keys(t.att).concat(Object.keys(e.att)).sort((s,n)=>s.localeCompare(n)),i={att:{}};return r.forEach(s=>{var n,o;Object.keys(((n=t.att)==null?void 0:n[s])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[s])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,u;i.att[s]=mE(bE({},i.att[s]),{[a]:((c=t.att[s])==null?void 0:c[a])||((u=e.att[s])==null?void 0:u[a])})})}),i}function BE(t="",e){Fr(e);const r="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(r))return t;const i=[];let s=0;Object.keys(e.att).forEach(a=>{const c=Object.keys(e.att[a]).map(h=>({ability:h.split("/")[0],action:h.split("/")[1]}));c.sort((h,f)=>h.action.localeCompare(f.action));const u={};c.forEach(h=>{u[h.ability]||(u[h.ability]=[]),u[h.ability].push(h.action)});const l=Object.keys(u).map(h=>(s++,`(${s}) '${h}': '${u[h].join("', '")}' for '${a}'.`));i.push(l.join(", ").replace(".,","."))});const n=i.join(" "),o=`${r}${n}`;return`${t?t+" ":""}${o}`}function Ou(t){var e;const r=qi(t);Fr(r);const i=(e=r.att)==null?void 0:e.eip155;return i?Object.keys(i).map(s=>s.split("/")[1]):[]}function Bu(t){const e=qi(t);Fr(e);const r=[];return Object.values(e.att).forEach(i=>{Object.values(i).forEach(s=>{var n;(n=s==null?void 0:s[0])!=null&&n.chains&&r.push(s[0].chains)})}),[...new Set(r.flat())]}function xs(t){if(!t)return;const e=t==null?void 0:t[t.length-1];return AE(e)?e:void 0}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function qf(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function No(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function Zn(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Ye(t,...e){if(!qf(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Tu(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function TE(t,e){Ye(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function wr(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function ci(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function PE(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}const NE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function CE(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Co(t){if(typeof t=="string")t=CE(t);else if(qf(t))t=Uo(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function UE(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function RE(t,e){if(t.length!==e.length)return!1;let r=0;for(let i=0;i<t.length;i++)r|=t[i]^e[i];return r===0}const kE=(t,e)=>{function r(i,...s){if(Ye(i),!NE)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){const u=s[0];if(!u)throw new Error("nonce / iv required");t.varSizeNonce?Ye(u):Ye(u,t.nonceLength)}const n=t.tagLength;n&&s[1]!==void 0&&Ye(s[1]);const o=e(i,...s),a=(u,l)=>{if(l!==void 0){if(u!==2)throw new Error("cipher output not supported");Ye(l)}};let c=!1;return{encrypt(u,l){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,Ye(u),a(o.encrypt.length,l),o.encrypt(u,l)},decrypt(u,l){if(Ye(u),n&&u.length<n)throw new Error("invalid ciphertext length: smaller than tagLength="+n);return a(o.decrypt.length,l),o.decrypt(u,l)}}}return Object.assign(r,t),r};function Pu(t,e,r=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(r&&!LE(e))throw new Error("invalid output, must be aligned");return e}function Nu(t,e,r,i){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,i);const s=BigInt(32),n=BigInt(4294967295),o=Number(r>>s&n),a=Number(r&n);t.setUint32(e+4,o,i),t.setUint32(e+0,a,i)}function FE(t,e,r){No(r);const i=new Uint8Array(16),s=PE(i);return Nu(s,0,BigInt(e),r),Nu(s,8,BigInt(t),r),i}function LE(t){return t.byteOffset%4===0}function Uo(t){return Uint8Array.from(t)}const jf=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),ME=jf("expand 16-byte k"),qE=jf("expand 32-byte k"),jE=wr(ME),zE=wr(qE);function re(t,e){return t<<e|t>>>32-e}function Ro(t){return t.byteOffset%4===0}const ds=64,VE=16,zf=2**32-1,Cu=new Uint32Array;function KE(t,e,r,i,s,n,o,a){const c=s.length,u=new Uint8Array(ds),l=wr(u),h=Ro(s)&&Ro(n),f=h?wr(s):Cu,g=h?wr(n):Cu;for(let d=0;d<c;o++){if(t(e,r,i,l,o,a),o>=zf)throw new Error("arx: counter overflow");const p=Math.min(ds,c-d);if(h&&p===ds){const b=d/4;if(d%4!==0)throw new Error("arx: invalid block position");for(let v=0,_;v<VE;v++)_=b+v,g[_]=f[_]^l[v];d+=ds;continue}for(let b=0,v;b<p;b++)v=d+b,n[v]=s[v]^u[b];d+=p}}function HE(t,e){const{allowShortKeys:r,extendNonceFn:i,counterLength:s,counterRight:n,rounds:o}=UE({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return Zn(s),Zn(o),No(n),No(r),(a,c,u,l,h=0)=>{Ye(a),Ye(c),Ye(u);const f=u.length;if(l===void 0&&(l=new Uint8Array(f)),Ye(l),Zn(h),h<0||h>=zf)throw new Error("arx: counter overflow");if(l.length<f)throw new Error(`arx: output (${l.length}) is shorter than data (${f})`);const g=[];let d=a.length,p,b;if(d===32)g.push(p=Uo(a)),b=zE;else if(d===16&&r)p=new Uint8Array(32),p.set(a),p.set(a,16),b=jE,g.push(p);else throw new Error(`arx: invalid 32-byte key, got length=${d}`);Ro(c)||g.push(c=Uo(c));const v=wr(p);if(i){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");i(b,v,wr(c.subarray(0,16)),v),c=c.subarray(16)}const _=16-s;if(_!==c.length)throw new Error(`arx: nonce must be ${_} or 16 bytes`);if(_!==12){const x=new Uint8Array(12);x.set(c,n?0:12-c.length),c=x,g.push(c)}const m=wr(c);return KE(t,b,v,m,u,l,h,o),ci(...g),l}}const Oe=(t,e)=>t[e++]&255|(t[e++]&255)<<8;class WE{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=Co(e),Ye(e,32);const r=Oe(e,0),i=Oe(e,2),s=Oe(e,4),n=Oe(e,6),o=Oe(e,8),a=Oe(e,10),c=Oe(e,12),u=Oe(e,14);this.r[0]=r&8191,this.r[1]=(r>>>13|i<<3)&8191,this.r[2]=(i>>>10|s<<6)&7939,this.r[3]=(s>>>7|n<<9)&8191,this.r[4]=(n>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|u<<8)&8191,this.r[9]=u>>>5&127;for(let l=0;l<8;l++)this.pad[l]=Oe(e,16+2*l)}process(e,r,i=!1){const s=i?0:2048,{h:n,r:o}=this,a=o[0],c=o[1],u=o[2],l=o[3],h=o[4],f=o[5],g=o[6],d=o[7],p=o[8],b=o[9],v=Oe(e,r+0),_=Oe(e,r+2),m=Oe(e,r+4),x=Oe(e,r+6),D=Oe(e,r+8),O=Oe(e,r+10),N=Oe(e,r+12),R=Oe(e,r+14);let T=n[0]+(v&8191),q=n[1]+((v>>>13|_<<3)&8191),F=n[2]+((_>>>10|m<<6)&8191),P=n[3]+((m>>>7|x<<9)&8191),A=n[4]+((x>>>4|D<<12)&8191),B=n[5]+(D>>>1&8191),y=n[6]+((D>>>14|O<<2)&8191),w=n[7]+((O>>>11|N<<5)&8191),E=n[8]+((N>>>8|R<<8)&8191),S=n[9]+(R>>>5|s),I=0,$=I+T*a+q*(5*b)+F*(5*p)+P*(5*d)+A*(5*g);I=$>>>13,$&=8191,$+=B*(5*f)+y*(5*h)+w*(5*l)+E*(5*u)+S*(5*c),I+=$>>>13,$&=8191;let C=I+T*c+q*a+F*(5*b)+P*(5*p)+A*(5*d);I=C>>>13,C&=8191,C+=B*(5*g)+y*(5*f)+w*(5*h)+E*(5*l)+S*(5*u),I+=C>>>13,C&=8191;let U=I+T*u+q*c+F*a+P*(5*b)+A*(5*p);I=U>>>13,U&=8191,U+=B*(5*d)+y*(5*g)+w*(5*f)+E*(5*h)+S*(5*l),I+=U>>>13,U&=8191;let j=I+T*l+q*u+F*c+P*a+A*(5*b);I=j>>>13,j&=8191,j+=B*(5*p)+y*(5*d)+w*(5*g)+E*(5*f)+S*(5*h),I+=j>>>13,j&=8191;let k=I+T*h+q*l+F*u+P*c+A*a;I=k>>>13,k&=8191,k+=B*(5*b)+y*(5*p)+w*(5*d)+E*(5*g)+S*(5*f),I+=k>>>13,k&=8191;let M=I+T*f+q*h+F*l+P*u+A*c;I=M>>>13,M&=8191,M+=B*a+y*(5*b)+w*(5*p)+E*(5*d)+S*(5*g),I+=M>>>13,M&=8191;let H=I+T*g+q*f+F*h+P*l+A*u;I=H>>>13,H&=8191,H+=B*c+y*a+w*(5*b)+E*(5*p)+S*(5*d),I+=H>>>13,H&=8191;let G=I+T*d+q*g+F*f+P*h+A*l;I=G>>>13,G&=8191,G+=B*u+y*c+w*a+E*(5*b)+S*(5*p),I+=G>>>13,G&=8191;let J=I+T*p+q*d+F*g+P*f+A*h;I=J>>>13,J&=8191,J+=B*l+y*u+w*c+E*a+S*(5*b),I+=J>>>13,J&=8191;let W=I+T*b+q*p+F*d+P*g+A*f;I=W>>>13,W&=8191,W+=B*h+y*l+w*u+E*c+S*a,I+=W>>>13,W&=8191,I=(I<<2)+I|0,I=I+$|0,$=I&8191,I=I>>>13,C+=I,n[0]=$,n[1]=C,n[2]=U,n[3]=j,n[4]=k,n[5]=M,n[6]=H,n[7]=G,n[8]=J,n[9]=W}finalize(){const{h:e,pad:r}=this,i=new Uint16Array(10);let s=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=s,s=e[a]>>>13,e[a]&=8191;e[0]+=s*5,s=e[0]>>>13,e[0]&=8191,e[1]+=s,s=e[1]>>>13,e[1]&=8191,e[2]+=s,i[0]=e[0]+5,s=i[0]>>>13,i[0]&=8191;for(let a=1;a<10;a++)i[a]=e[a]+s,s=i[a]>>>13,i[a]&=8191;i[9]-=8192;let n=(s^1)-1;for(let a=0;a<10;a++)i[a]&=n;n=~n;for(let a=0;a<10;a++)e[a]=e[a]&n|i[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+r[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+r[a]|0)+(o>>>16)|0,e[a]=o&65535;ci(i)}update(e){Tu(this),e=Co(e),Ye(e);const{buffer:r,blockLen:i}=this,s=e.length;for(let n=0;n<s;){const o=Math.min(i-this.pos,s-n);if(o===i){for(;i<=s-n;n+=i)this.process(e,n);continue}r.set(e.subarray(n,n+o),this.pos),this.pos+=o,n+=o,this.pos===i&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){ci(this.h,this.r,this.buffer,this.pad)}digestInto(e){Tu(this),TE(e,this),this.finished=!0;const{buffer:r,h:i}=this;let{pos:s}=this;if(s){for(r[s++]=1;s<16;s++)r[s]=0;this.process(r,0,!0)}this.finalize();let n=0;for(let o=0;o<8;o++)e[n++]=i[o]>>>0,e[n++]=i[o]>>>8;return e}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const i=e.slice(0,r);return this.destroy(),i}}function GE(t){const e=(i,s)=>t(s).update(Co(i)).digest(),r=t(new Uint8Array(32));return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=i=>t(i),e}const YE=GE(t=>new WE(t));function ZE(t,e,r,i,s,n=20){let o=t[0],a=t[1],c=t[2],u=t[3],l=e[0],h=e[1],f=e[2],g=e[3],d=e[4],p=e[5],b=e[6],v=e[7],_=s,m=r[0],x=r[1],D=r[2],O=o,N=a,R=c,T=u,q=l,F=h,P=f,A=g,B=d,y=p,w=b,E=v,S=_,I=m,$=x,C=D;for(let j=0;j<n;j+=2)O=O+q|0,S=re(S^O,16),B=B+S|0,q=re(q^B,12),O=O+q|0,S=re(S^O,8),B=B+S|0,q=re(q^B,7),N=N+F|0,I=re(I^N,16),y=y+I|0,F=re(F^y,12),N=N+F|0,I=re(I^N,8),y=y+I|0,F=re(F^y,7),R=R+P|0,$=re($^R,16),w=w+$|0,P=re(P^w,12),R=R+P|0,$=re($^R,8),w=w+$|0,P=re(P^w,7),T=T+A|0,C=re(C^T,16),E=E+C|0,A=re(A^E,12),T=T+A|0,C=re(C^T,8),E=E+C|0,A=re(A^E,7),O=O+F|0,C=re(C^O,16),w=w+C|0,F=re(F^w,12),O=O+F|0,C=re(C^O,8),w=w+C|0,F=re(F^w,7),N=N+P|0,S=re(S^N,16),E=E+S|0,P=re(P^E,12),N=N+P|0,S=re(S^N,8),E=E+S|0,P=re(P^E,7),R=R+A|0,I=re(I^R,16),B=B+I|0,A=re(A^B,12),R=R+A|0,I=re(I^R,8),B=B+I|0,A=re(A^B,7),T=T+q|0,$=re($^T,16),y=y+$|0,q=re(q^y,12),T=T+q|0,$=re($^T,8),y=y+$|0,q=re(q^y,7);let U=0;i[U++]=o+O|0,i[U++]=a+N|0,i[U++]=c+R|0,i[U++]=u+T|0,i[U++]=l+q|0,i[U++]=h+F|0,i[U++]=f+P|0,i[U++]=g+A|0,i[U++]=d+B|0,i[U++]=p+y|0,i[U++]=b+w|0,i[U++]=v+E|0,i[U++]=_+S|0,i[U++]=m+I|0,i[U++]=x+$|0,i[U++]=D+C|0}const JE=HE(ZE,{counterRight:!1,counterLength:4,allowShortKeys:!1}),XE=new Uint8Array(16),Uu=(t,e)=>{t.update(e);const r=e.length%16;r&&t.update(XE.subarray(r))},QE=new Uint8Array(32);function Ru(t,e,r,i,s){const n=t(e,r,QE),o=YE.create(n);s&&Uu(o,s),Uu(o,i);const a=FE(i.length,s?s.length:0,!0);o.update(a);const c=o.digest();return ci(n,a),c}const ex=t=>(e,r,i)=>({encrypt(s,n){const o=s.length;n=Pu(o+16,n,!1),n.set(s);const a=n.subarray(0,-16);t(e,r,a,a,1);const c=Ru(t,e,r,a,i);return n.set(c,o),ci(c),n},decrypt(s,n){n=Pu(s.length-16,n,!1);const o=s.subarray(0,-16),a=s.subarray(-16),c=Ru(t,e,r,o,i);if(!RE(a,c))throw new Error("invalid tag");return n.set(s.subarray(0,-16)),t(e,r,n,n,1),ci(c),n}}),Vf=kE({blockSize:64,nonceLength:12,tagLength:16},ex(JE));let Kf=class extends sn{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,rn(e);const i=It(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,n=new Uint8Array(s);n.set(i.length>s?e.create().update(i).digest():i);for(let o=0;o<n.length;o++)n[o]^=54;this.iHash.update(n),this.oHash=e.create();for(let o=0;o<n.length;o++)n[o]^=106;this.oHash.update(n),yt(n)}update(e){return mr(this),this.iHash.update(e),this}digestInto(e){mr(this),_t(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:i,finished:s,destroyed:n,blockLen:o,outputLen:a}=this;return e=e,e.finished=s,e.destroyed=n,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=i._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const on=(t,e,r)=>new Kf(t,e).update(r).digest();on.create=(t,e)=>new Kf(t,e);function tx(t,e,r){return rn(t),r===void 0&&(r=new Uint8Array(t.outputLen)),on(t,It(r),It(e))}const Jn=Uint8Array.from([0]),ku=Uint8Array.of();function rx(t,e,r,i=32){rn(t),Jt(i);const s=t.outputLen;if(i>255*s)throw new Error("Length should be <= 255*HashLen");const n=Math.ceil(i/s);r===void 0&&(r=ku);const o=new Uint8Array(n*s),a=on.create(t,e),c=a._cloneInto(),u=new Uint8Array(a.outputLen);for(let l=0;l<n;l++)Jn[0]=l+1,c.update(l===0?ku:u).update(r).update(Jn).digestInto(u),o.set(u,s*l),a._cloneInto(c);return a.destroy(),c.destroy(),yt(u,Jn),o.slice(0,i)}const ix=(t,e,r,i,s)=>rx(t,tx(t,e,r),i,s),an=nn,$a=BigInt(0),ko=BigInt(1);function qs(t,e=""){if(typeof t!="boolean"){const r=e&&`"${e}"`;throw new Error(r+"expected boolean, got type="+typeof t)}return t}function Pr(t,e,r=""){const i=tn(t),s=t==null?void 0:t.length,n=e!==void 0;if(!i||n&&s!==e){const o=r&&`"${r}" `,a=n?` of length ${e}`:"",c=i?`length=${s}`:`type=${typeof t}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return t}function ps(t){const e=t.toString(16);return e.length&1?"0"+e:e}function Hf(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?$a:BigInt("0x"+t)}function cn(t){return Hf(si(t))}function js(t){return _t(t),Hf(si(Uint8Array.from(t).reverse()))}function Oa(t,e){return Ls(t.toString(16).padStart(e*2,"0"))}function Ba(t,e){return Oa(t,e).reverse()}function Me(t,e,r){let i;if(typeof e=="string")try{i=Ls(e)}catch(n){throw new Error(t+" must be hex string or Uint8Array, cause: "+n)}else if(tn(e))i=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const s=i.length;if(typeof r=="number"&&s!==r)throw new Error(t+" of length "+r+" expected, got "+s);return i}const Xn=t=>typeof t=="bigint"&&$a<=t;function sx(t,e,r){return Xn(t)&&Xn(e)&&Xn(r)&&e<=t&&t<r}function Fo(t,e,r,i){if(!sx(e,r,i))throw new Error("expected valid "+t+": "+r+" <= n < "+i+", got "+e)}function Wf(t){let e;for(e=0;t>$a;t>>=ko,e+=1);return e}const Xi=t=>(ko<<BigInt(t))-ko;function nx(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");const i=f=>new Uint8Array(f),s=f=>Uint8Array.of(f);let n=i(t),o=i(t),a=0;const c=()=>{n.fill(1),o.fill(0),a=0},u=(...f)=>r(o,n,...f),l=(f=i(0))=>{o=u(s(0),f),n=u(),f.length!==0&&(o=u(s(1),f),n=u())},h=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let f=0;const g=[];for(;f<e;){n=u();const d=n.slice();g.push(d),f+=n.length}return pr(...g)};return(f,g)=>{c(),l(f);let d;for(;!(d=g(h()));)l();return c(),d}}function un(t,e,r={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function i(s,n,o){const a=t[s];if(o&&a===void 0)return;const c=typeof a;if(c!==n||a===null)throw new Error(`param "${s}" is invalid: expected ${n}, got ${c}`)}Object.entries(e).forEach(([s,n])=>i(s,n,!1)),Object.entries(r).forEach(([s,n])=>i(s,n,!0))}function Fu(t){const e=new WeakMap;return(r,...i)=>{const s=e.get(r);if(s!==void 0)return s;const n=t(r,...i);return e.set(r,n),n}}const Xe=BigInt(0),je=BigInt(1),Nr=BigInt(2),Gf=BigInt(3),Yf=BigInt(4),Zf=BigInt(5),ox=BigInt(7),Jf=BigInt(8),ax=BigInt(9),Xf=BigInt(16);function st(t,e){const r=t%e;return r>=Xe?r:e+r}function Et(t,e,r){let i=t;for(;e-- >Xe;)i*=i,i%=r;return i}function Lu(t,e){if(t===Xe)throw new Error("invert: expected non-zero number");if(e<=Xe)throw new Error("invert: expected positive modulus, got "+e);let r=st(t,e),i=e,s=Xe,n=je;for(;r!==Xe;){const o=i/r,a=i%r,c=s-n*o;i=r,r=a,s=n,n=c}if(i!==je)throw new Error("invert: does not exist");return st(s,e)}function Ta(t,e,r){if(!t.eql(t.sqr(e),r))throw new Error("Cannot find square root")}function Qf(t,e){const r=(t.ORDER+je)/Yf,i=t.pow(e,r);return Ta(t,i,e),i}function cx(t,e){const r=(t.ORDER-Zf)/Jf,i=t.mul(e,Nr),s=t.pow(i,r),n=t.mul(e,s),o=t.mul(t.mul(n,Nr),s),a=t.mul(n,t.sub(o,t.ONE));return Ta(t,a,e),a}function ux(t){const e=Er(t),r=ed(t),i=r(e,e.neg(e.ONE)),s=r(e,i),n=r(e,e.neg(i)),o=(t+ox)/Xf;return(a,c)=>{let u=a.pow(c,o),l=a.mul(u,i);const h=a.mul(u,s),f=a.mul(u,n),g=a.eql(a.sqr(l),c),d=a.eql(a.sqr(h),c);u=a.cmov(u,l,g),l=a.cmov(f,h,d);const p=a.eql(a.sqr(l),c),b=a.cmov(u,l,p);return Ta(a,b,c),b}}function ed(t){if(t<Gf)throw new Error("sqrt is not defined for small field");let e=t-je,r=0;for(;e%Nr===Xe;)e/=Nr,r++;let i=Nr;const s=Er(t);for(;Mu(s,i)===1;)if(i++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return Qf;let n=s.pow(i,e);const o=(e+je)/Nr;return function(a,c){if(a.is0(c))return c;if(Mu(a,c)!==1)throw new Error("Cannot find square root");let u=r,l=a.mul(a.ONE,n),h=a.pow(c,e),f=a.pow(c,o);for(;!a.eql(h,a.ONE);){if(a.is0(h))return a.ZERO;let g=1,d=a.sqr(h);for(;!a.eql(d,a.ONE);)if(g++,d=a.sqr(d),g===u)throw new Error("Cannot find square root");const p=je<<BigInt(u-g-1),b=a.pow(l,p);u=g,l=a.sqr(b),h=a.mul(h,l),f=a.mul(f,b)}return f}}function lx(t){return t%Yf===Gf?Qf:t%Jf===Zf?cx:t%Xf===ax?ux(t):ed(t)}const hx=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function fx(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=hx.reduce((i,s)=>(i[s]="function",i),e);return un(t,r),t}function dx(t,e,r){if(r<Xe)throw new Error("invalid exponent, negatives unsupported");if(r===Xe)return t.ONE;if(r===je)return e;let i=t.ONE,s=e;for(;r>Xe;)r&je&&(i=t.mul(i,s)),s=t.sqr(s),r>>=je;return i}function td(t,e,r=!1){const i=new Array(e.length).fill(r?t.ZERO:void 0),s=e.reduce((o,a,c)=>t.is0(a)?o:(i[c]=o,t.mul(o,a)),t.ONE),n=t.inv(s);return e.reduceRight((o,a,c)=>t.is0(a)?o:(i[c]=t.mul(o,i[c]),t.mul(o,a)),n),i}function Mu(t,e){const r=(t.ORDER-je)/Nr,i=t.pow(e,r),s=t.eql(i,t.ONE),n=t.eql(i,t.ZERO),o=t.eql(i,t.neg(t.ONE));if(!s&&!n&&!o)throw new Error("invalid Legendre symbol result");return s?1:n?0:-1}function rd(t,e){e!==void 0&&Jt(e);const r=e!==void 0?e:t.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function Er(t,e,r=!1,i={}){if(t<=Xe)throw new Error("invalid field: expected ORDER > 0, got "+t);let s,n,o=!1,a;if(typeof e=="object"&&e!=null){if(i.sqrt||r)throw new Error("cannot specify opts in two arguments");const f=e;f.BITS&&(s=f.BITS),f.sqrt&&(n=f.sqrt),typeof f.isLE=="boolean"&&(r=f.isLE),typeof f.modFromBytes=="boolean"&&(o=f.modFromBytes),a=f.allowedLengths}else typeof e=="number"&&(s=e),i.sqrt&&(n=i.sqrt);const{nBitLength:c,nByteLength:u}=rd(t,s);if(u>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let l;const h=Object.freeze({ORDER:t,isLE:r,BITS:c,BYTES:u,MASK:Xi(c),ZERO:Xe,ONE:je,allowedLengths:a,create:f=>st(f,t),isValid:f=>{if(typeof f!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof f);return Xe<=f&&f<t},is0:f=>f===Xe,isValidNot0:f=>!h.is0(f)&&h.isValid(f),isOdd:f=>(f&je)===je,neg:f=>st(-f,t),eql:(f,g)=>f===g,sqr:f=>st(f*f,t),add:(f,g)=>st(f+g,t),sub:(f,g)=>st(f-g,t),mul:(f,g)=>st(f*g,t),pow:(f,g)=>dx(h,f,g),div:(f,g)=>st(f*Lu(g,t),t),sqrN:f=>f*f,addN:(f,g)=>f+g,subN:(f,g)=>f-g,mulN:(f,g)=>f*g,inv:f=>Lu(f,t),sqrt:n||(f=>(l||(l=lx(t)),l(h,f))),toBytes:f=>r?Ba(f,u):Oa(f,u),fromBytes:(f,g=!0)=>{if(a){if(!a.includes(f.length)||f.length>u)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+f.length);const p=new Uint8Array(u);p.set(f,r?0:p.length-f.length),f=p}if(f.length!==u)throw new Error("Field.fromBytes: expected "+u+" bytes, got "+f.length);let d=r?js(f):cn(f);if(o&&(d=st(d,t)),!g&&!h.isValid(d))throw new Error("invalid field element: outside of range 0..ORDER");return d},invertBatch:f=>td(h,f),cmov:(f,g,d)=>d?g:f});return Object.freeze(h)}function id(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function sd(t){const e=id(t);return e+Math.ceil(e/2)}function px(t,e,r=!1){const i=t.length,s=id(e),n=sd(e);if(i<16||i<n||i>1024)throw new Error("expected "+n+"-1024 bytes of input, got "+i);const o=r?js(t):cn(t),a=st(o,e-je)+je;return r?Ba(a,s):Oa(a,s)}const ui=BigInt(0),Cr=BigInt(1);function zs(t,e){const r=e.negate();return t?r:e}function Qn(t,e){const r=td(t.Fp,e.map(i=>i.Z));return e.map((i,s)=>t.fromAffine(i.toAffine(r[s])))}function nd(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function eo(t,e){nd(t,e);const r=Math.ceil(e/t)+1,i=2**(t-1),s=2**t,n=Xi(t),o=BigInt(t);return{windows:r,windowSize:i,mask:n,maxNumber:s,shiftBy:o}}function qu(t,e,r){const{windowSize:i,mask:s,maxNumber:n,shiftBy:o}=r;let a=Number(t&s),c=t>>o;a>i&&(a-=n,c+=Cr);const u=e*i,l=u+Math.abs(a)-1,h=a===0,f=a<0,g=e%2!==0;return{nextN:c,offset:l,isZero:h,isNeg:f,isNegF:g,offsetF:u}}function gx(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,i)=>{if(!(r instanceof e))throw new Error("invalid point at index "+i)})}function yx(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,i)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+i)})}const to=new WeakMap,od=new WeakMap;function ro(t){return od.get(t)||1}function ju(t){if(t!==ui)throw new Error("invalid wNAF")}class wx{constructor(e,r){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=r}_unsafeLadder(e,r,i=this.ZERO){let s=e;for(;r>ui;)r&Cr&&(i=i.add(s)),s=s.double(),r>>=Cr;return i}precomputeWindow(e,r){const{windows:i,windowSize:s}=eo(r,this.bits),n=[];let o=e,a=o;for(let c=0;c<i;c++){a=o,n.push(a);for(let u=1;u<s;u++)a=a.add(o),n.push(a);o=a.double()}return n}wNAF(e,r,i){if(!this.Fn.isValid(i))throw new Error("invalid scalar");let s=this.ZERO,n=this.BASE;const o=eo(e,this.bits);for(let a=0;a<o.windows;a++){const{nextN:c,offset:u,isZero:l,isNeg:h,isNegF:f,offsetF:g}=qu(i,a,o);i=c,l?n=n.add(zs(f,r[g])):s=s.add(zs(h,r[u]))}return ju(i),{p:s,f:n}}wNAFUnsafe(e,r,i,s=this.ZERO){const n=eo(e,this.bits);for(let o=0;o<n.windows&&i!==ui;o++){const{nextN:a,offset:c,isZero:u,isNeg:l}=qu(i,o,n);if(i=a,!u){const h=r[c];s=s.add(l?h.negate():h)}}return ju(i),s}getPrecomputes(e,r,i){let s=to.get(r);return s||(s=this.precomputeWindow(r,e),e!==1&&(typeof i=="function"&&(s=i(s)),to.set(r,s))),s}cached(e,r,i){const s=ro(e);return this.wNAF(s,this.getPrecomputes(s,e,i),r)}unsafe(e,r,i,s){const n=ro(e);return n===1?this._unsafeLadder(e,r,s):this.wNAFUnsafe(n,this.getPrecomputes(n,e,i),r,s)}createCache(e,r){nd(r,this.bits),od.set(e,r),to.delete(e)}hasCache(e){return ro(e)!==1}}function bx(t,e,r,i){let s=e,n=t.ZERO,o=t.ZERO;for(;r>ui||i>ui;)r&Cr&&(n=n.add(s)),i&Cr&&(o=o.add(s)),s=s.double(),r>>=Cr,i>>=Cr;return{p1:n,p2:o}}function mx(t,e,r,i){gx(r,t),yx(i,e);const s=r.length,n=i.length;if(s!==n)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=Wf(BigInt(s));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const u=Xi(c),l=new Array(Number(u)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let f=o;for(let g=h;g>=0;g-=c){l.fill(o);for(let p=0;p<n;p++){const b=i[p],v=Number(b>>BigInt(g)&u);l[v]=l[v].add(r[p])}let d=o;for(let p=l.length-1,b=o;p>0;p--)b=b.add(l[p]),d=d.add(b);if(f=f.add(d),g!==0)for(let p=0;p<c;p++)f=f.double()}return f}function zu(t,e,r){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return fx(e),e}else return Er(t,{isLE:r})}function vx(t,e,r={},i){if(i===void 0&&(i=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(const a of["p","n","h"]){const c=e[a];if(!(typeof c=="bigint"&&c>ui))throw new Error(`CURVE.${a} must be positive bigint`)}const s=zu(e.p,r.Fp,i),n=zu(e.n,r.Fn,i),o=["Gx","Gy","a","b"];for(const a of o)if(!s.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:s,Fn:n}}BigInt(0),BigInt(1),BigInt(2),BigInt(8),Bf("HashToScalar-");const Ii=BigInt(0),Zr=BigInt(1),gs=BigInt(2);function Ex(t){return un(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...t})}function xx(t){const e=Ex(t),{P:r,type:i,adjustScalarBytes:s,powPminus2:n,randomBytes:o}=e,a=i==="x25519";if(!a&&i!=="x448")throw new Error("invalid type");const c=o||zr,u=a?255:448,l=a?32:56,h=BigInt(a?9:5),f=BigInt(a?121665:39081),g=a?gs**BigInt(254):gs**BigInt(447),d=a?BigInt(8)*gs**BigInt(251)-Zr:BigInt(4)*gs**BigInt(445)-Zr,p=g+d+Zr,b=P=>st(P,r),v=_(h);function _(P){return Ba(b(P),l)}function m(P){const A=Me("u coordinate",P,l);return a&&(A[31]&=127),b(js(A))}function x(P){return js(s(Me("scalar",P,l)))}function D(P,A){const B=R(m(A),x(P));if(B===Ii)throw new Error("invalid private or public key received");return _(B)}function O(P){return D(P,v)}function N(P,A,B){const y=b(P*(A-B));return A=b(A-y),B=b(B+y),{x_2:A,x_3:B}}function R(P,A){Fo("u",P,Ii,r),Fo("scalar",A,g,p);const B=A,y=P;let w=Zr,E=Ii,S=P,I=Zr,$=Ii;for(let U=BigInt(u-1);U>=Ii;U--){const j=B>>U&Zr;$^=j,{x_2:w,x_3:S}=N($,w,S),{x_2:E,x_3:I}=N($,E,I),$=j;const k=w+E,M=b(k*k),H=w-E,G=b(H*H),J=M-G,W=S+I,Y=S-I,te=b(Y*k),le=b(W*H),pe=te+le,we=te-le;S=b(pe*pe),I=b(y*b(we*we)),w=b(M*G),E=b(J*(M+b(f*J)))}({x_2:w,x_3:S}=N($,w,S)),{x_2:E,x_3:I}=N($,E,I);const C=n(E);return b(w*C)}const T={secretKey:l,publicKey:l,seed:l},q=(P=c(l))=>(_t(P,T.seed),P);function F(P){const A=q(P);return{secretKey:A,publicKey:O(A)}}return{keygen:F,getSharedSecret:(P,A)=>D(P,A),getPublicKey:P=>O(P),scalarMult:D,scalarMultBase:O,utils:{randomSecretKey:q,randomPrivateKey:q},GuBytes:v.slice(),lengths:T}}const Ix=BigInt(1),Vu=BigInt(2),_x=BigInt(3),Sx=BigInt(5);BigInt(8);const ad=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),Dx={p:ad,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function Ax(t){const e=BigInt(10),r=BigInt(20),i=BigInt(40),s=BigInt(80),n=ad,o=t*t%n*t%n,a=Et(o,Vu,n)*o%n,c=Et(a,Ix,n)*t%n,u=Et(c,Sx,n)*c%n,l=Et(u,e,n)*u%n,h=Et(l,r,n)*l%n,f=Et(h,i,n)*h%n,g=Et(f,s,n)*f%n,d=Et(g,s,n)*f%n,p=Et(d,e,n)*u%n;return{pow_p_5_8:Et(p,Vu,n)*t%n,b2:o}}function $x(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const Ox=Er(Dx.p,{isLE:!0}),Lo=(()=>{const t=Ox.ORDER;return xx({P:t,type:"x25519",powPminus2:e=>{const{pow_p_5_8:r,b2:i}=Ax(e);return st(Et(r,_x,t)*i,t)},adjustScalarBytes:$x})})(),Ku=(t,e)=>(t+(t>=0?e:-e)/cd)/e;function Bx(t,e,r){const[[i,s],[n,o]]=e,a=Ku(o*t,r),c=Ku(-s*t,r);let u=t-a*i-c*n,l=-a*s-c*o;const h=u<Wt,f=l<Wt;h&&(u=-u),f&&(l=-l);const g=Xi(Math.ceil(Wf(r)/2))+ni;if(u<Wt||u>=g||l<Wt||l>=g)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:h,k1:u,k2neg:f,k2:l}}function Mo(t){if(!["compact","recovered","der"].includes(t))throw new Error('Signature format must be "compact", "recovered", or "der"');return t}function io(t,e){const r={};for(let i of Object.keys(e))r[i]=t[i]===void 0?e[i]:t[i];return qs(r.lowS,"lowS"),qs(r.prehash,"prehash"),r.format!==void 0&&Mo(r.format),r}class Tx extends Error{constructor(e=""){super(e)}}const Kt={Err:Tx,_tlv:{encode:(t,e)=>{const{Err:r}=Kt;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const i=e.length/2,s=ps(i);if(s.length/2&128)throw new r("tlv.encode: long form length too big");const n=i>127?ps(s.length/2|128):"";return ps(t)+n+s+e},decode(t,e){const{Err:r}=Kt;let i=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[i++]!==t)throw new r("tlv.decode: wrong tlv");const s=e[i++],n=!!(s&128);let o=0;if(!n)o=s;else{const c=s&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const u=e.subarray(i,i+c);if(u.length!==c)throw new r("tlv.decode: length bytes not complete");if(u[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const l of u)o=o<<8|l;if(i+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(i,i+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(i+o)}}},_int:{encode(t){const{Err:e}=Kt;if(t<Wt)throw new e("integer: negative integers are not allowed");let r=ps(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=Kt;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return cn(t)}},toSig(t){const{Err:e,_int:r,_tlv:i}=Kt,s=Me("signature",t),{v:n,l:o}=i.decode(48,s);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=i.decode(2,n),{v:u,l}=i.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(u)}},hexFromSig(t){const{_tlv:e,_int:r}=Kt,i=e.encode(2,r.encode(t.r)),s=e.encode(2,r.encode(t.s)),n=i+s;return e.encode(48,n)}},Wt=BigInt(0),ni=BigInt(1),cd=BigInt(2),ys=BigInt(3),Px=BigInt(4);function ti(t,e){const{BYTES:r}=t;let i;if(typeof e=="bigint")i=e;else{let s=Me("private key",e);try{i=t.fromBytes(s)}catch{throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof e}`)}}if(!t.isValidNot0(i))throw new Error("invalid private key: out of range [1..N-1]");return i}function Nx(t,e={}){const r=vx("weierstrass",t,e),{Fp:i,Fn:s}=r;let n=r.CURVE;const{h:o,n:a}=n;un(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=e;if(c&&(!i.is0(n.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const u=ld(i,s);function l(){if(!i.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function h(P,A,B){const{x:y,y:w}=A.toAffine(),E=i.toBytes(y);if(qs(B,"isCompressed"),B){l();const S=!i.isOdd(w);return pr(ud(S),E)}else return pr(Uint8Array.of(4),E,i.toBytes(w))}function f(P){Pr(P,void 0,"Point");const{publicKey:A,publicKeyUncompressed:B}=u,y=P.length,w=P[0],E=P.subarray(1);if(y===A&&(w===2||w===3)){const S=i.fromBytes(E);if(!i.isValid(S))throw new Error("bad point: is not on curve, wrong x");const I=p(S);let $;try{$=i.sqrt(I)}catch(U){const j=U instanceof Error?": "+U.message:"";throw new Error("bad point: is not on curve, sqrt error"+j)}l();const C=i.isOdd($);return(w&1)===1!==C&&($=i.neg($)),{x:S,y:$}}else if(y===B&&w===4){const S=i.BYTES,I=i.fromBytes(E.subarray(0,S)),$=i.fromBytes(E.subarray(S,S*2));if(!b(I,$))throw new Error("bad point: is not on curve");return{x:I,y:$}}else throw new Error(`bad point: got length ${y}, expected compressed=${A} or uncompressed=${B}`)}const g=e.toBytes||h,d=e.fromBytes||f;function p(P){const A=i.sqr(P),B=i.mul(A,P);return i.add(i.add(B,i.mul(P,n.a)),n.b)}function b(P,A){const B=i.sqr(A),y=p(P);return i.eql(B,y)}if(!b(n.Gx,n.Gy))throw new Error("bad curve params: generator point");const v=i.mul(i.pow(n.a,ys),Px),_=i.mul(i.sqr(n.b),BigInt(27));if(i.is0(i.add(v,_)))throw new Error("bad curve params: a or b");function m(P,A,B=!1){if(!i.isValid(A)||B&&i.is0(A))throw new Error(`bad point coordinate ${P}`);return A}function x(P){if(!(P instanceof T))throw new Error("ProjectivePoint expected")}function D(P){if(!c||!c.basises)throw new Error("no endo");return Bx(P,c.basises,s.ORDER)}const O=Fu((P,A)=>{const{X:B,Y:y,Z:w}=P;if(i.eql(w,i.ONE))return{x:B,y};const E=P.is0();A==null&&(A=E?i.ONE:i.inv(w));const S=i.mul(B,A),I=i.mul(y,A),$=i.mul(w,A);if(E)return{x:i.ZERO,y:i.ZERO};if(!i.eql($,i.ONE))throw new Error("invZ was invalid");return{x:S,y:I}}),N=Fu(P=>{if(P.is0()){if(e.allowInfinityPoint&&!i.is0(P.Y))return;throw new Error("bad point: ZERO")}const{x:A,y:B}=P.toAffine();if(!i.isValid(A)||!i.isValid(B))throw new Error("bad point: x or y not field elements");if(!b(A,B))throw new Error("bad point: equation left != right");if(!P.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function R(P,A,B,y,w){return B=new T(i.mul(B.X,P),B.Y,B.Z),A=zs(y,A),B=zs(w,B),A.add(B)}class T{constructor(A,B,y){this.X=m("x",A),this.Y=m("y",B,!0),this.Z=m("z",y),Object.freeze(this)}static CURVE(){return n}static fromAffine(A){const{x:B,y}=A||{};if(!A||!i.isValid(B)||!i.isValid(y))throw new Error("invalid affine point");if(A instanceof T)throw new Error("projective point not allowed");return i.is0(B)&&i.is0(y)?T.ZERO:new T(B,y,i.ONE)}static fromBytes(A){const B=T.fromAffine(d(Pr(A,void 0,"point")));return B.assertValidity(),B}static fromHex(A){return T.fromBytes(Me("pointHex",A))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(A=8,B=!0){return F.createCache(this,A),B||this.multiply(ys),this}assertValidity(){N(this)}hasEvenY(){const{y:A}=this.toAffine();if(!i.isOdd)throw new Error("Field doesn't support isOdd");return!i.isOdd(A)}equals(A){x(A);const{X:B,Y:y,Z:w}=this,{X:E,Y:S,Z:I}=A,$=i.eql(i.mul(B,I),i.mul(E,w)),C=i.eql(i.mul(y,I),i.mul(S,w));return $&&C}negate(){return new T(this.X,i.neg(this.Y),this.Z)}double(){const{a:A,b:B}=n,y=i.mul(B,ys),{X:w,Y:E,Z:S}=this;let I=i.ZERO,$=i.ZERO,C=i.ZERO,U=i.mul(w,w),j=i.mul(E,E),k=i.mul(S,S),M=i.mul(w,E);return M=i.add(M,M),C=i.mul(w,S),C=i.add(C,C),I=i.mul(A,C),$=i.mul(y,k),$=i.add(I,$),I=i.sub(j,$),$=i.add(j,$),$=i.mul(I,$),I=i.mul(M,I),C=i.mul(y,C),k=i.mul(A,k),M=i.sub(U,k),M=i.mul(A,M),M=i.add(M,C),C=i.add(U,U),U=i.add(C,U),U=i.add(U,k),U=i.mul(U,M),$=i.add($,U),k=i.mul(E,S),k=i.add(k,k),U=i.mul(k,M),I=i.sub(I,U),C=i.mul(k,j),C=i.add(C,C),C=i.add(C,C),new T(I,$,C)}add(A){x(A);const{X:B,Y:y,Z:w}=this,{X:E,Y:S,Z:I}=A;let $=i.ZERO,C=i.ZERO,U=i.ZERO;const j=n.a,k=i.mul(n.b,ys);let M=i.mul(B,E),H=i.mul(y,S),G=i.mul(w,I),J=i.add(B,y),W=i.add(E,S);J=i.mul(J,W),W=i.add(M,H),J=i.sub(J,W),W=i.add(B,w);let Y=i.add(E,I);return W=i.mul(W,Y),Y=i.add(M,G),W=i.sub(W,Y),Y=i.add(y,w),$=i.add(S,I),Y=i.mul(Y,$),$=i.add(H,G),Y=i.sub(Y,$),U=i.mul(j,W),$=i.mul(k,G),U=i.add($,U),$=i.sub(H,U),U=i.add(H,U),C=i.mul($,U),H=i.add(M,M),H=i.add(H,M),G=i.mul(j,G),W=i.mul(k,W),H=i.add(H,G),G=i.sub(M,G),G=i.mul(j,G),W=i.add(W,G),M=i.mul(H,W),C=i.add(C,M),M=i.mul(Y,W),$=i.mul(J,$),$=i.sub($,M),M=i.mul(J,H),U=i.mul(Y,U),U=i.add(U,M),new T($,C,U)}subtract(A){return this.add(A.negate())}is0(){return this.equals(T.ZERO)}multiply(A){const{endo:B}=e;if(!s.isValidNot0(A))throw new Error("invalid scalar: out of range");let y,w;const E=S=>F.cached(this,S,I=>Qn(T,I));if(B){const{k1neg:S,k1:I,k2neg:$,k2:C}=D(A),{p:U,f:j}=E(I),{p:k,f:M}=E(C);w=j.add(M),y=R(B.beta,U,k,S,$)}else{const{p:S,f:I}=E(A);y=S,w=I}return Qn(T,[y,w])[0]}multiplyUnsafe(A){const{endo:B}=e,y=this;if(!s.isValid(A))throw new Error("invalid scalar: out of range");if(A===Wt||y.is0())return T.ZERO;if(A===ni)return y;if(F.hasCache(this))return this.multiply(A);if(B){const{k1neg:w,k1:E,k2neg:S,k2:I}=D(A),{p1:$,p2:C}=bx(T,y,E,I);return R(B.beta,$,C,w,S)}else return F.unsafe(y,A)}multiplyAndAddUnsafe(A,B,y){const w=this.multiplyUnsafe(B).add(A.multiplyUnsafe(y));return w.is0()?void 0:w}toAffine(A){return O(this,A)}isTorsionFree(){const{isTorsionFree:A}=e;return o===ni?!0:A?A(T,this):F.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:A}=e;return o===ni?this:A?A(T,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(A=!0){return qs(A,"isCompressed"),this.assertValidity(),g(T,this,A)}toHex(A=!0){return si(this.toBytes(A))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(A=!0){return this.toBytes(A)}_setWindowSize(A){this.precompute(A)}static normalizeZ(A){return Qn(T,A)}static msm(A,B){return mx(T,s,A,B)}static fromPrivateKey(A){return T.BASE.multiply(ti(s,A))}}T.BASE=new T(n.Gx,n.Gy,i.ONE),T.ZERO=new T(i.ZERO,i.ONE,i.ZERO),T.Fp=i,T.Fn=s;const q=s.BITS,F=new wx(T,e.endo?Math.ceil(q/2):q);return T.BASE.precompute(8),T}function ud(t){return Uint8Array.of(t?2:3)}function ld(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function Cx(t,e={}){const{Fn:r}=t,i=e.randomBytes||zr,s=Object.assign(ld(t.Fp,r),{seed:sd(r.ORDER)});function n(f){try{return!!ti(r,f)}catch{return!1}}function o(f,g){const{publicKey:d,publicKeyUncompressed:p}=s;try{const b=f.length;return g===!0&&b!==d||g===!1&&b!==p?!1:!!t.fromBytes(f)}catch{return!1}}function a(f=i(s.seed)){return px(Pr(f,s.seed,"seed"),r.ORDER)}function c(f,g=!0){return t.BASE.multiply(ti(r,f)).toBytes(g)}function u(f){const g=a(f);return{secretKey:g,publicKey:c(g)}}function l(f){if(typeof f=="bigint")return!1;if(f instanceof t)return!0;const{secretKey:g,publicKey:d,publicKeyUncompressed:p}=s;if(r.allowedLengths||g===d)return;const b=Me("key",f).length;return b===d||b===p}function h(f,g,d=!0){if(l(f)===!0)throw new Error("first arg must be private key");if(l(g)===!1)throw new Error("second arg must be public key");const p=ti(r,f);return t.fromHex(g).multiply(p).toBytes(d)}return Object.freeze({getPublicKey:c,getSharedSecret:h,keygen:u,Point:t,utils:{isValidSecretKey:n,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:n,randomPrivateKey:a,normPrivateKeyToScalar:f=>ti(r,f),precompute(f=8,g=t.BASE){return g.precompute(f,!1)}},lengths:s})}function Ux(t,e,r={}){rn(e),un(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const i=r.randomBytes||zr,s=r.hmac||((B,...y)=>on(e,B,pr(...y))),{Fp:n,Fn:o}=t,{ORDER:a,BITS:c}=o,{keygen:u,getPublicKey:l,getSharedSecret:h,utils:f,lengths:g}=Cx(t,r),d={prehash:!1,lowS:typeof r.lowS=="boolean"?r.lowS:!1,format:void 0,extraEntropy:!1},p="compact";function b(B){const y=a>>ni;return B>y}function v(B,y){if(!o.isValidNot0(y))throw new Error(`invalid signature ${B}: out of range 1..Point.Fn.ORDER`);return y}function _(B,y){Mo(y);const w=g.signature,E=y==="compact"?w:y==="recovered"?w+1:void 0;return Pr(B,E,`${y} signature`)}class m{constructor(y,w,E){this.r=v("r",y),this.s=v("s",w),E!=null&&(this.recovery=E),Object.freeze(this)}static fromBytes(y,w=p){_(y,w);let E;if(w==="der"){const{r:C,s:U}=Kt.toSig(Pr(y));return new m(C,U)}w==="recovered"&&(E=y[0],w="compact",y=y.subarray(1));const S=o.BYTES,I=y.subarray(0,S),$=y.subarray(S,S*2);return new m(o.fromBytes(I),o.fromBytes($),E)}static fromHex(y,w){return this.fromBytes(Ls(y),w)}addRecoveryBit(y){return new m(this.r,this.s,y)}recoverPublicKey(y){const w=n.ORDER,{r:E,s:S,recovery:I}=this;if(I==null||![0,1,2,3].includes(I))throw new Error("recovery id invalid");if(a*cd<w&&I>1)throw new Error("recovery id is ambiguous for h>1 curve");const $=I===2||I===3?E+a:E;if(!n.isValid($))throw new Error("recovery id 2 or 3 invalid");const C=n.toBytes($),U=t.fromBytes(pr(ud((I&1)===0),C)),j=o.inv($),k=D(Me("msgHash",y)),M=o.create(-k*j),H=o.create(S*j),G=t.BASE.multiplyUnsafe(M).add(U.multiplyUnsafe(H));if(G.is0())throw new Error("point at infinify");return G.assertValidity(),G}hasHighS(){return b(this.s)}toBytes(y=p){if(Mo(y),y==="der")return Ls(Kt.hexFromSig(this));const w=o.toBytes(this.r),E=o.toBytes(this.s);if(y==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return pr(Uint8Array.of(this.recovery),w,E)}return pr(w,E)}toHex(y){return si(this.toBytes(y))}assertValidity(){}static fromCompact(y){return m.fromBytes(Me("sig",y),"compact")}static fromDER(y){return m.fromBytes(Me("sig",y),"der")}normalizeS(){return this.hasHighS()?new m(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return si(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return si(this.toBytes("compact"))}}const x=r.bits2int||function(B){if(B.length>8192)throw new Error("input is too large");const y=cn(B),w=B.length*8-c;return w>0?y>>BigInt(w):y},D=r.bits2int_modN||function(B){return o.create(x(B))},O=Xi(c);function N(B){return Fo("num < 2^"+c,B,Wt,O),o.toBytes(B)}function R(B,y){return Pr(B,void 0,"message"),y?Pr(e(B),void 0,"prehashed message"):B}function T(B,y,w){if(["recovered","canonical"].some(H=>H in w))throw new Error("sign() legacy options not supported");const{lowS:E,prehash:S,extraEntropy:I}=io(w,d);B=R(B,S);const $=D(B),C=ti(o,y),U=[N(C),N($)];if(I!=null&&I!==!1){const H=I===!0?i(g.secretKey):I;U.push(Me("extraEntropy",H))}const j=pr(...U),k=$;function M(H){const G=x(H);if(!o.isValidNot0(G))return;const J=o.inv(G),W=t.BASE.multiply(G).toAffine(),Y=o.create(W.x);if(Y===Wt)return;const te=o.create(J*o.create(k+Y*C));if(te===Wt)return;let le=(W.x===Y?0:2)|Number(W.y&ni),pe=te;return E&&b(te)&&(pe=o.neg(te),le^=1),new m(Y,pe,le)}return{seed:j,k2sig:M}}function q(B,y,w={}){B=Me("message",B);const{seed:E,k2sig:S}=T(B,y,w);return nx(e.outputLen,o.BYTES,s)(E,S)}function F(B){let y;const w=typeof B=="string"||tn(B),E=!w&&B!==null&&typeof B=="object"&&typeof B.r=="bigint"&&typeof B.s=="bigint";if(!w&&!E)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(E)y=new m(B.r,B.s);else if(w){try{y=m.fromBytes(Me("sig",B),"der")}catch(S){if(!(S instanceof Kt.Err))throw S}if(!y)try{y=m.fromBytes(Me("sig",B),"compact")}catch{return!1}}return y||!1}function P(B,y,w,E={}){const{lowS:S,prehash:I,format:$}=io(E,d);if(w=Me("publicKey",w),y=R(Me("message",y),I),"strict"in E)throw new Error("options.strict was renamed to lowS");const C=$===void 0?F(B):m.fromBytes(Me("sig",B),$);if(C===!1)return!1;try{const U=t.fromBytes(w);if(S&&C.hasHighS())return!1;const{r:j,s:k}=C,M=D(y),H=o.inv(k),G=o.create(M*H),J=o.create(j*H),W=t.BASE.multiplyUnsafe(G).add(U.multiplyUnsafe(J));return W.is0()?!1:o.create(W.x)===j}catch{return!1}}function A(B,y,w={}){const{prehash:E}=io(w,d);return y=R(y,E),m.fromBytes(B,"recovered").recoverPublicKey(y).toBytes()}return Object.freeze({keygen:u,getPublicKey:l,getSharedSecret:h,utils:f,lengths:g,Point:t,sign:q,verify:P,recoverPublicKey:A,Signature:m,hash:e})}function Rx(t){const e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},r=t.Fp;let i=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;const s=Er(e.n,{BITS:t.nBitLength,allowedLengths:i,modFromBytes:t.wrapPrivateKey}),n={Fp:r,Fn:s,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:n}}function kx(t){const{CURVE:e,curveOpts:r}=Rx(t),i={hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:r,hash:t.hash,ecdsaOpts:i}}function Fx(t,e){const r=e.Point;return Object.assign({},e,{ProjectivePoint:r,CURVE:Object.assign({},t,rd(r.Fn.ORDER,r.Fn.BITS))})}function Lx(t){const{CURVE:e,curveOpts:r,hash:i,ecdsaOpts:s}=kx(t),n=Nx(e,r),o=Ux(n,i,s);return Fx(t,o)}function qo(t,e){const r=i=>Lx({...t,hash:i});return{...r(e),create:r}}const hd={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},fd={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},dd={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},Mx=Er(hd.p),qx=Er(fd.p),jx=Er(dd.p),zx=qo({...hd,Fp:Mx,lowS:!1},nn);qo({...fd,Fp:qx,lowS:!1},Zv),qo({...dd,Fp:jx,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},Yv);const Vx=zx,pd="base10",ze="base16",Ze="base64pad",gr="base64url",Qi="utf8",gd=0,Yt=1,es=2,Kx=0,Hu=1,Ci=12,Pa=32;function Hx(){const t=Lo.utils.randomPrivateKey(),e=Lo.getPublicKey(t);return{privateKey:Qe(t,ze),publicKey:Qe(e,ze)}}function jo(){const t=zr(Pa);return Qe(t,ze)}function Wx(t,e){const r=Lo.getSharedSecret(gt(t,ze),gt(e,ze)),i=ix(an,r,void 0,void 0,Pa);return Qe(i,ze)}function Is(t){const e=an(gt(t,ze));return Qe(e,ze)}function dt(t){const e=an(gt(t,Qi));return Qe(e,ze)}function yd(t){return gt(`${t}`,pd)}function Lr(t){return Number(Qe(t,pd))}function wd(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function bd(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),r=(4-e.length%4)%4;return e+"=".repeat(r)}function Gx(t){const e=yd(typeof t.type<"u"?t.type:gd);if(Lr(e)===Yt&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?gt(t.senderPublicKey,ze):void 0,i=typeof t.iv<"u"?gt(t.iv,ze):zr(Ci),s=gt(t.symKey,ze),n=Vf(s,i).encrypt(gt(t.message,Qi)),o=md({type:e,sealed:n,iv:i,senderPublicKey:r});return t.encoding===gr?wd(o):o}function Yx(t){const e=gt(t.symKey,ze),{sealed:r,iv:i}=ji({encoded:t.encoded,encoding:t.encoding}),s=Vf(e,i).decrypt(r);if(s===null)throw new Error("Failed to decrypt");return Qe(s,Qi)}function Zx(t,e){const r=yd(es),i=zr(Ci),s=gt(t,Qi),n=md({type:r,sealed:s,iv:i});return e===gr?wd(n):n}function Jx(t,e){const{sealed:r}=ji({encoded:t,encoding:e});return Qe(r,Qi)}function md(t){if(Lr(t.type)===es)return Qe(Ni([t.type,t.sealed]),Ze);if(Lr(t.type)===Yt){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return Qe(Ni([t.type,t.senderPublicKey,t.iv,t.sealed]),Ze)}return Qe(Ni([t.type,t.iv,t.sealed]),Ze)}function ji(t){const e=(t.encoding||Ze)===gr?bd(t.encoded):t.encoded,r=gt(e,Ze),i=r.slice(Kx,Hu),s=Hu;if(Lr(i)===Yt){const c=s+Pa,u=c+Ci,l=r.slice(s,c),h=r.slice(c,u),f=r.slice(u);return{type:i,sealed:f,iv:h,senderPublicKey:l}}if(Lr(i)===es){const c=r.slice(s),u=zr(Ci);return{type:i,sealed:c,iv:u}}const n=s+Ci,o=r.slice(s,n),a=r.slice(n);return{type:i,sealed:a,iv:o}}function Xx(t,e){const r=ji({encoded:t,encoding:e==null?void 0:e.encoding});return vd({type:Lr(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?Qe(r.senderPublicKey,ze):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function vd(t){const e=(t==null?void 0:t.type)||gd;if(e===Yt){if(typeof(t==null?void 0:t.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(t==null?void 0:t.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t==null?void 0:t.senderPublicKey,receiverPublicKey:t==null?void 0:t.receiverPublicKey}}function Wu(t){return t.type===Yt&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function Gu(t){return t.type===es}function Qx(t){const e=se.from(t.x,"base64"),r=se.from(t.y,"base64");return Ni([new Uint8Array([4]),e,r])}function e3(t,e){const[r,i,s]=t.split("."),n=se.from(bd(s),"base64");if(n.length!==64)throw new Error("Invalid signature length");const o=n.slice(0,32),a=n.slice(32,64),c=`${r}.${i}`,u=an(c),l=Qx(e);if(!Vx.verify(Ni([o,a]),u,l))throw new Error("Invalid signature");return vo(t).payload}const t3="irn";function Vs(t){return(t==null?void 0:t.relay)||{protocol:t3}}function ri(t){const e=k2[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var r3=Object.defineProperty,i3=Object.defineProperties,s3=Object.getOwnPropertyDescriptors,Yu=Object.getOwnPropertySymbols,n3=Object.prototype.hasOwnProperty,o3=Object.prototype.propertyIsEnumerable,Zu=(t,e,r)=>e in t?r3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,so=(t,e)=>{for(var r in e||(e={}))n3.call(e,r)&&Zu(t,r,e[r]);if(Yu)for(var r of Yu(e))o3.call(e,r)&&Zu(t,r,e[r]);return t},a3=(t,e)=>i3(t,s3(e));function c3(t,e="-"){const r={},i="relay"+e;return Object.keys(t).forEach(s=>{if(s.startsWith(i)){const n=s.replace(i,""),o=t[s];r[n]=o}}),r}function Ju(t){if(!t.includes("wc:")){const u=_f(t);u!=null&&u.includes("wc:")&&(t=u)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,i=t.substring(0,e),s=t.substring(e+1,r).split("@"),n=typeof r<"u"?t.substring(r):"",o=new URLSearchParams(n),a=Object.fromEntries(o.entries()),c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:i,topic:u3(s[0]),version:parseInt(s[1],10),symKey:a.symKey,relay:c3(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function u3(t){return t.startsWith("//")?t.substring(2):t}function l3(t,e="-"){const r="relay",i={};return Object.keys(t).forEach(s=>{const n=s,o=r+e+n;t[n]&&(i[o]=t[n])}),i}function Xu(t){const e=new URLSearchParams,r=so(so(a3(so({},l3(t.relay)),{symKey:t.symKey}),t.expiryTimestamp&&{expiryTimestamp:t.expiryTimestamp.toString()}),t.methods&&{methods:t.methods.join(",")});return Object.entries(r).sort(([i],[s])=>i.localeCompare(s)).forEach(([i,s])=>{s!==void 0&&e.append(i,String(s))}),`${t.protocol}:${t.topic}@${t.version}?${e}`}function ws(t,e,r){return`${t}?wc_ev=${r}&topic=${e}`}var h3=Object.defineProperty,f3=Object.defineProperties,d3=Object.getOwnPropertyDescriptors,Qu=Object.getOwnPropertySymbols,p3=Object.prototype.hasOwnProperty,g3=Object.prototype.propertyIsEnumerable,el=(t,e,r)=>e in t?h3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,y3=(t,e)=>{for(var r in e||(e={}))p3.call(e,r)&&el(t,r,e[r]);if(Qu)for(var r of Qu(e))g3.call(e,r)&&el(t,r,e[r]);return t},w3=(t,e)=>f3(t,d3(e));function di(t){const e=[];return t.forEach(r=>{const[i,s]=r.split(":");e.push(`${i}:${s}`)}),e}function b3(t){const e=[];return Object.values(t).forEach(r=>{e.push(...di(r.accounts))}),e}function m3(t,e){const r=[];return Object.values(t).forEach(i=>{di(i.accounts).includes(e)&&r.push(...i.methods)}),r}function v3(t,e){const r=[];return Object.values(t).forEach(i=>{di(i.accounts).includes(e)&&r.push(...i.events)}),r}function Ed(t){return t.includes(":")}function E3(t){return Ed(t)?t.split(":")[0]:t}function tl(t){var e,r,i;const s={};if(!zi(t))return s;for(const[n,o]of Object.entries(t)){const a=Ed(n)?[n]:o.chains,c=o.methods||[],u=o.events||[],l=E3(n);s[l]=w3(y3({},s[l]),{chains:Rr(a,(e=s[l])==null?void 0:e.chains),methods:Rr(c,(r=s[l])==null?void 0:r.methods),events:Rr(u,(i=s[l])==null?void 0:i.events)})}return s}function x3(t){const e={};return t==null||t.forEach(r=>{var i;const[s,n]=r.split(":");e[s]||(e[s]={accounts:[],chains:[],events:[],methods:[]}),e[s].accounts.push(r),(i=e[s].chains)==null||i.push(`${s}:${n}`)}),e}function rl(t,e){e=e.map(i=>i.replace("did:pkh:",""));const r=x3(e);for(const[i,s]of Object.entries(r))s.methods?s.methods=Rr(s.methods,t):s.methods=t,s.events=["chainChanged","accountsChanged"];return r}function I3(t,e){var r,i,s,n,o,a;const c=tl(t),u=tl(e),l={},h=Object.keys(c).concat(Object.keys(u));for(const f of h)l[f]={chains:Rr((r=c[f])==null?void 0:r.chains,(i=u[f])==null?void 0:i.chains),methods:Rr((s=c[f])==null?void 0:s.methods,(n=u[f])==null?void 0:n.methods),events:Rr((o=c[f])==null?void 0:o.events,(a=u[f])==null?void 0:a.events)};return l}const _3={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},S3={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function z(t,e){const{message:r,code:i}=S3[t];return{message:e?`${r} ${e}`:r,code:i}}function de(t,e){const{message:r,code:i}=_3[t];return{message:e?`${r} ${e}`:r,code:i}}function li(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function zi(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function Ie(t){return typeof t>"u"}function me(t,e){return e&&Ie(t)?!0:typeof t=="string"&&!!t.trim().length}function Na(t,e){return e&&Ie(t)?!0:typeof t=="number"&&!isNaN(t)}function D3(t,e){const{requiredNamespaces:r}=e,i=Object.keys(t.namespaces),s=Object.keys(r);let n=!0;return Tr(s,i)?(i.forEach(o=>{const{accounts:a,methods:c,events:u}=t.namespaces[o],l=di(a),h=r[o];(!Tr(mf(o,h),l)||!Tr(h.methods,c)||!Tr(h.events,u))&&(n=!1)}),n):!1}function Ks(t){return me(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function A3(t){if(me(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const r=e[0]+":"+e[1];return!!e[2]&&Ks(r)}}return!1}function $3(t){function e(r){try{return typeof new URL(r)<"u"}catch{return!1}}try{if(me(t,!1)){if(e(t))return!0;const r=_f(t);return e(r)}}catch{}return!1}function O3(t){var e;return(e=t==null?void 0:t.proposer)==null?void 0:e.publicKey}function B3(t){return t==null?void 0:t.topic}function T3(t,e){let r=null;return me(t==null?void 0:t.publicKey,!1)||(r=z("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function il(t){let e=!0;return li(t)?t.length&&(e=t.every(r=>me(r,!1))):e=!1,e}function P3(t,e,r){let i=null;return li(e)&&e.length?e.forEach(s=>{i||Ks(s)||(i=de("UNSUPPORTED_CHAINS",`${r}, chain ${s} should be a string and conform to "namespace:chainId" format`))}):Ks(t)||(i=de("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),i}function N3(t,e,r){let i=null;return Object.entries(t).forEach(([s,n])=>{if(i)return;const o=P3(s,mf(s,n),`${e} ${r}`);o&&(i=o)}),i}function C3(t,e){let r=null;return li(t)?t.forEach(i=>{r||A3(i)||(r=de("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):r=de("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function U3(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const s=C3(i==null?void 0:i.accounts,`${e} namespace`);s&&(r=s)}),r}function R3(t,e){let r=null;return il(t==null?void 0:t.methods)?il(t==null?void 0:t.events)||(r=de("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=de("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function xd(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const s=R3(i,`${e}, namespace`);s&&(r=s)}),r}function k3(t,e,r){let i=null;if(t&&zi(t)){const s=xd(t,e);s&&(i=s);const n=N3(t,e,r);n&&(i=n)}else i=z("MISSING_OR_INVALID",`${e}, ${r} should be an object with data`);return i}function no(t,e){let r=null;if(t&&zi(t)){const i=xd(t,e);i&&(r=i);const s=U3(t,e);s&&(r=s)}else r=z("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function Id(t){return me(t.protocol,!0)}function F3(t,e){let r=!1;return t?t&&li(t)&&t.length&&t.forEach(i=>{r=Id(i)}):r=!0,r}function L3(t){return typeof t=="number"}function We(t){return typeof t<"u"&&typeof t!==null}function M3(t){return!(!t||typeof t!="object"||!t.code||!Na(t.code,!1)||!t.message||!me(t.message,!1))}function q3(t){return!(Ie(t)||!me(t.method,!1))}function j3(t){return!(Ie(t)||Ie(t.result)&&Ie(t.error)||!Na(t.id,!1)||!me(t.jsonrpc,!1))}function z3(t){return!(Ie(t)||!me(t.name,!1))}function sl(t,e){return!(!Ks(e)||!b3(t).includes(e))}function V3(t,e,r){return me(r,!1)?m3(t,e).includes(r):!1}function K3(t,e,r){return me(r,!1)?v3(t,e).includes(r):!1}function nl(t,e,r){let i=null;const s=H3(t),n=W3(e),o=Object.keys(s),a=Object.keys(n),c=ol(Object.keys(t)),u=ol(Object.keys(e)),l=c.filter(h=>!u.includes(h));return l.length&&(i=z("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${l.toString()}
      Received: ${Object.keys(e).toString()}`)),Tr(o,a)||(i=z("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(h=>{if(!h.includes(":")||i)return;const f=di(e[h].accounts);f.includes(h)||(i=z("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${h}
        Required: ${h}
        Approved: ${f.toString()}`))}),o.forEach(h=>{i||(Tr(s[h].methods,n[h].methods)?Tr(s[h].events,n[h].events)||(i=z("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${h}`)):i=z("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${h}`))}),i}function H3(t){const e={};return Object.keys(t).forEach(r=>{var i;r.includes(":")?e[r]=t[r]:(i=t[r].chains)==null||i.forEach(s=>{e[s]={methods:t[r].methods,events:t[r].events}})}),e}function ol(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function W3(t){const e={};return Object.keys(t).forEach(r=>{if(r.includes(":"))e[r]=t[r];else{const i=di(t[r].accounts);i==null||i.forEach(s=>{e[s]={accounts:t[r].accounts.filter(n=>n.includes(`${s}:`)),methods:t[r].methods,events:t[r].events}})}}),e}function G3(t,e){return Na(t,!1)&&t<=e.max&&t>=e.min}function al(){const t=Zi();return new Promise(e=>{switch(t){case nt.browser:e(Y3());break;case nt.reactNative:e(Z3());break;case nt.node:e(J3());break;default:e(!0)}})}function Y3(){return fi()&&(navigator==null?void 0:navigator.onLine)}async function Z3(){if(vr()&&typeof Z<"u"&&Z!=null&&Z.NetInfo){const t=await(Z==null?void 0:Z.NetInfo.fetch());return t==null?void 0:t.isConnected}return!0}function J3(){return!0}function X3(t){switch(Zi()){case nt.browser:Q3(t);break;case nt.reactNative:e8(t);break}}function Q3(t){!vr()&&fi()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function e8(t){var e;vr()&&typeof Z<"u"&&Z!=null&&Z.NetInfo&&((e=Z)==null||e.NetInfo.addEventListener(r=>t(r==null?void 0:r.isConnected)))}function t8(){var t;return fi()&&Zt.getDocument()?((t=Zt.getDocument())==null?void 0:t.visibilityState)==="visible":!0}const oo={};class _i{static get(e){return oo[e]}static set(e,r){oo[e]=r}static delete(e){delete oo[e]}}function r8(t){const e=Gi.decode(t);if(e.length<33)throw new Error("Too short to contain a public key");return e.slice(1,33)}function i8({publicKey:t,signature:e,payload:r}){var i;const s=zo(r.method),n=128|parseInt(((i=r.version)==null?void 0:i.toString())||"4"),o=o8(r.address),a=r.era==="00"?new Uint8Array([0]):zo(r.era);if(a.length!==1&&a.length!==2)throw new Error("Invalid era length");const c=parseInt(r.nonce,16),u=new Uint8Array([c&255,c>>8&255]),l=BigInt(`0x${n8(r.tip)}`),h=c8(l),f=new Uint8Array([0,...t,o,...e,...a,...u,...h,...s]),g=a8(f.length+1);return new Uint8Array([...g,n,...f])}function s8(t){const e=zo(t),r=q2.blake2b(e,void 0,32);return"0x"+se.from(r).toString("hex")}function zo(t){return new Uint8Array(t.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function n8(t){return t.startsWith("0x")?t.slice(2):t}function o8(t){const e=Gi.decode(t)[0];return e===42?0:e===60?2:1}function a8(t){if(t<64)return new Uint8Array([t<<2]);if(t<16384){const e=t<<2|1;return new Uint8Array([e&255,e>>8&255])}else if(t<1<<30){const e=t<<2|2;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}else throw new Error("Compact encoding > 2^30 not supported")}function c8(t){if(t<BigInt(1)<<BigInt(6))return new Uint8Array([Number(t<<BigInt(2))]);if(t<BigInt(1)<<BigInt(14)){const e=t<<BigInt(2)|BigInt(1);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255))])}else if(t<BigInt(1)<<BigInt(30)){const e=t<<BigInt(2)|BigInt(2);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255)),Number(e>>BigInt(16)&BigInt(255)),Number(e>>BigInt(24)&BigInt(255))])}else throw new Error("BigInt compact encoding not supported > 2^30")}function u8(t){const e=Uint8Array.from(se.from(t.signature,"hex")),r=r8(t.transaction.address),i=i8({publicKey:r,signature:e,payload:t.transaction}),s=se.from(i).toString("hex");return s8(s)}function _d({logger:t,name:e}){const r=typeof t=="string"?Wl({opts:{level:t,name:e}}).logger:t;return r.level=typeof t=="string"?t:t.level,r}class l8{}class h8 extends l8{constructor(){super()}}class f8 extends h8{constructor(e){super()}}const d8="^wss?:";function p8(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function g8(t,e){const r=p8(t);return typeof r>"u"?!1:new RegExp(e).test(r)}function cl(t){return g8(t,d8)}function y8(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function Sd(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function Ca(t){return Sd(t)&&"method"in t}function ln(t){return Sd(t)&&(Pt(t)||pt(t))}function Pt(t){return"result"in t}function pt(t){return"error"in t}class w8 extends f8{constructor(e){super(e),this.events=new St.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(zt(e.method,e.params||[],e.id||yr().toString()),r)}async requestStrict(e,r){return new Promise(async(i,s)=>{if(!this.connection.connected)try{await this.open()}catch(n){s(n)}this.events.on(`${e.id}`,n=>{pt(n)?s(n.error):i(n.result)});try{await this.connection.send(e,r)}catch(n){s(n)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),ln(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const b8=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),m8=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=t.replace(e,'$1"$2n"$3');return JSON.parse(r,(i,s)=>typeof s=="string"&&s.match(/^\d+n$/)?BigInt(s.substring(0,s.length-1)):s)};function v8(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return m8(t)}catch{return t}}function E8(t){return typeof t=="string"?t:b8(t)||""}const x8=()=>typeof WebSocket<"u"?WebSocket:typeof Z<"u"&&typeof Z.WebSocket<"u"?Z.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),I8=()=>typeof WebSocket<"u"||typeof Z<"u"&&typeof Z.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",ul=t=>t.split("?")[0],ll=10,_8=x8();let S8=class{constructor(e){if(this.url=e,this.events=new St.EventEmitter,this.registering=!1,!cl(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=i=>{this.onClose(i),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(E8(e))}catch(r){this.onError(e.id,r)}}register(e=this.url){if(!cl(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((i,s)=>{this.events.once("register_error",n=>{this.resetMaxListeners(),s(n)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,i)=>{const s=Zd.isReactNative()?void 0:{rejectUnauthorized:!y8(e)},n=new _8(e,[],s);I8()?n.onerror=o=>{const a=o;i(this.emitError(a.error))}:n.on("error",o=>{i(this.emitError(o))}),n.onopen=()=>{this.onOpen(n),r(n)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=r=>this.onClose(r),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?v8(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const i=this.parseError(r),s=i.message||i.toString(),n=ra(e,s);this.events.emit("payload",n)}parseError(e,r=this.url){return Jd(e,ul(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>ll&&this.events.setMaxListeners(ll)}emitError(e){const r=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for host: ${ul(this.url)}`));return this.events.emit("register_error",r),r}};var D8={};const Dd="wc",Ad=2,Vo="core",Ct=`${Dd}@2:${Vo}:`,A8={logger:"error"},$8={database:":memory:"},O8="crypto",hl="client_ed25519_seed",B8=V.ONE_DAY,T8="keychain",P8="0.3",N8="messages",C8="0.3",U8=V.SIX_HOURS,R8="publisher",$d="irn",k8="error",Od="wss://relay.walletconnect.org",F8="relayer",ge={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},L8="_subscription",ut={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},M8=.1,Ko="2.22.4",he={link_mode:"link_mode",relay:"relay"},_s={inbound:"inbound",outbound:"outbound"},q8="0.3",j8="WALLETCONNECT_CLIENT_ID",fl="WALLETCONNECT_LINK_MODE_APPS",rt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},z8="subscription",V8="0.3",K8="pairing",H8="0.3",Si={wc_pairingDelete:{req:{ttl:V.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:V.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:V.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:V.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:V.ONE_DAY,prompt:!1,tag:0},res:{ttl:V.ONE_DAY,prompt:!1,tag:0}}},Or={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},mt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},W8="history",G8="0.3",Y8="expirer",ht={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Z8="0.3",J8="verify-api",X8="https://verify.walletconnect.com",Bd="https://verify.walletconnect.org",Ui=Bd,Q8=`${Ui}/v3`,eI=[X8,Bd],tI="echo",rI="https://echo.walletconnect.com",Tt={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},qt={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},vt={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success",session_request_response_started:"session_request_response_started",session_request_response_validation_success:"session_request_response_validation_success",session_request_response_publish_started:"session_request_response_publish_started"},Sr={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found",session_request_response_validation_failure:"session_request_response_validation_failure",session_request_response_publish_failure:"session_request_response_publish_failure"},Dr={authenticated_session_approve_started:"authenticated_session_approve_started",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve"},Di={no_internet_connection:"no_internet_connection",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},iI=.1,sI="event-client",nI=86400,oI="https://pulse.walletconnect.org/batch";function aI(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var s=0;s<t.length;s++){var n=t.charAt(s),o=n.charCodeAt(0);if(r[o]!==255)throw new TypeError(n+" is ambiguous");r[o]=s}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,b=0,v=0,_=d.length;v!==_&&d[v]===0;)v++,p++;for(var m=(_-v)*l+1>>>0,x=new Uint8Array(m);v!==_;){for(var D=d[v],O=0,N=m-1;(D!==0||O<b)&&N!==-1;N--,O++)D+=256*x[N]>>>0,x[N]=D%a>>>0,D=D/a>>>0;if(D!==0)throw new Error("Non-zero carry");b=O,v++}for(var R=m-b;R!==m&&x[R]===0;)R++;for(var T=c.repeat(p);R<m;++R)T+=t.charAt(x[R]);return T}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var p=0;if(d[p]!==" "){for(var b=0,v=0;d[p]===c;)b++,p++;for(var _=(d.length-p)*u+1>>>0,m=new Uint8Array(_);d[p];){var x=r[d.charCodeAt(p)];if(x===255)return;for(var D=0,O=_-1;(x!==0||D<v)&&O!==-1;O--,D++)x+=a*m[O]>>>0,m[O]=x%256>>>0,x=x/256>>>0;if(x!==0)throw new Error("Non-zero carry");v=D,p++}if(d[p]!==" "){for(var N=_-v;N!==_&&m[N]===0;)N++;for(var R=new Uint8Array(b+(_-N)),T=b;N!==_;)R[T++]=m[N++];return R}}}function g(d){var p=f(d);if(p)return p;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:g}}var cI=aI,uI=cI;const Td=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},lI=t=>new TextEncoder().encode(t),hI=t=>new TextDecoder().decode(t);class fI{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class dI{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Pd(this,e)}}class pI{constructor(e){this.decoders=e}or(e){return Pd(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Pd=(t,e)=>new pI({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class gI{constructor(e,r,i,s){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=s,this.encoder=new fI(e,r,i),this.decoder=new dI(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const hn=({name:t,prefix:e,encode:r,decode:i})=>new gI(t,e,r,i),ts=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:s}=uI(r,e);return hn({prefix:t,name:e,encode:i,decode:n=>Td(s(n))})},yI=(t,e,r,i)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let n=t.length;for(;t[n-1]==="=";)--n;const o=new Uint8Array(n*r/8|0);let a=0,c=0,u=0;for(let l=0;l<n;++l){const h=s[t[l]];if(h===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},wI=(t,e,r)=>{const i=e[e.length-1]==="=",s=(1<<r)-1;let n="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,n+=e[s&a>>o];if(o&&(n+=e[s&a<<r-o]),i)for(;n.length*r&7;)n+="=";return n},Ce=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>hn({prefix:e,name:t,encode(s){return wI(s,i,r)},decode(s){return yI(s,i,r,t)}}),bI=hn({prefix:"\0",name:"identity",encode:t=>hI(t),decode:t=>lI(t)});var mI=Object.freeze({__proto__:null,identity:bI});const vI=Ce({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var EI=Object.freeze({__proto__:null,base2:vI});const xI=Ce({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var II=Object.freeze({__proto__:null,base8:xI});const _I=ts({prefix:"9",name:"base10",alphabet:"0123456789"});var SI=Object.freeze({__proto__:null,base10:_I});const DI=Ce({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),AI=Ce({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var $I=Object.freeze({__proto__:null,base16:DI,base16upper:AI});const OI=Ce({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),BI=Ce({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),TI=Ce({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),PI=Ce({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),NI=Ce({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),CI=Ce({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),UI=Ce({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),RI=Ce({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),kI=Ce({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var FI=Object.freeze({__proto__:null,base32:OI,base32upper:BI,base32pad:TI,base32padupper:PI,base32hex:NI,base32hexupper:CI,base32hexpad:UI,base32hexpadupper:RI,base32z:kI});const LI=ts({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),MI=ts({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var qI=Object.freeze({__proto__:null,base36:LI,base36upper:MI});const jI=ts({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),zI=ts({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var VI=Object.freeze({__proto__:null,base58btc:jI,base58flickr:zI});const KI=Ce({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),HI=Ce({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),WI=Ce({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),GI=Ce({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var YI=Object.freeze({__proto__:null,base64:KI,base64pad:HI,base64url:WI,base64urlpad:GI});const Nd=Array.from(""),ZI=Nd.reduce((t,e,r)=>(t[r]=e,t),[]),JI=Nd.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function XI(t){return t.reduce((e,r)=>(e+=ZI[r],e),"")}function QI(t){const e=[];for(const r of t){const i=JI[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const e_=hn({prefix:"",name:"base256emoji",encode:XI,decode:QI});var t_=Object.freeze({__proto__:null,base256emoji:e_}),r_=Cd,dl=128,i_=-128,s_=Math.pow(2,31);function Cd(t,e,r){e=e||[],r=r||0;for(var i=r;t>=s_;)e[r++]=t&255|dl,t/=128;for(;t&i_;)e[r++]=t&255|dl,t>>>=7;return e[r]=t|0,Cd.bytes=r-i+1,e}var n_=Ho,o_=128,pl=127;function Ho(t,i){var r=0,i=i||0,s=0,n=i,o,a=t.length;do{if(n>=a)throw Ho.bytes=0,new RangeError("Could not decode varint");o=t[n++],r+=s<28?(o&pl)<<s:(o&pl)*Math.pow(2,s),s+=7}while(o>=o_);return Ho.bytes=n-i,r}var a_=Math.pow(2,7),c_=Math.pow(2,14),u_=Math.pow(2,21),l_=Math.pow(2,28),h_=Math.pow(2,35),f_=Math.pow(2,42),d_=Math.pow(2,49),p_=Math.pow(2,56),g_=Math.pow(2,63),y_=function(t){return t<a_?1:t<c_?2:t<u_?3:t<l_?4:t<h_?5:t<f_?6:t<d_?7:t<p_?8:t<g_?9:10},w_={encode:r_,decode:n_,encodingLength:y_},Ud=w_;const gl=(t,e,r=0)=>(Ud.encode(t,e,r),e),yl=t=>Ud.encodingLength(t),Wo=(t,e)=>{const r=e.byteLength,i=yl(t),s=i+yl(r),n=new Uint8Array(s+r);return gl(t,n,0),gl(r,n,i),n.set(e,s),new b_(t,r,e,n)};class b_{constructor(e,r,i,s){this.code=e,this.size=r,this.digest=i,this.bytes=s}}const Rd=({name:t,code:e,encode:r})=>new m_(t,e,r);class m_{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Wo(this.code,r):r.then(i=>Wo(this.code,i))}else throw Error("Unknown type, must be binary type")}}const kd=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),v_=Rd({name:"sha2-256",code:18,encode:kd("SHA-256")}),E_=Rd({name:"sha2-512",code:19,encode:kd("SHA-512")});var x_=Object.freeze({__proto__:null,sha256:v_,sha512:E_});const Fd=0,I_="identity",Ld=Td,__=t=>Wo(Fd,Ld(t)),S_={code:Fd,name:I_,encode:Ld,digest:__};var D_=Object.freeze({__proto__:null,identity:S_});new TextEncoder,new TextDecoder;const wl={...mI,...EI,...II,...SI,...$I,...FI,...qI,...VI,...YI,...t_};({...x_,...D_});function Md(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function A_(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Md(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function qd(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const bl=qd("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),ao=qd("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=A_(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),$_={utf8:bl,"utf-8":bl,hex:wl.base16,latin1:ao,ascii:ao,binary:ao,...wl};function O_(t,e="utf8"){const r=$_[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Md(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}var B_=Object.defineProperty,T_=(t,e,r)=>e in t?B_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ot=(t,e,r)=>T_(t,typeof e!="symbol"?e+"":e,r);class P_{constructor(e,r){this.core=e,this.logger=r,Ot(this,"keychain",new Map),Ot(this,"name",T8),Ot(this,"version",P8),Ot(this,"initialized",!1),Ot(this,"storagePrefix",Ct),Ot(this,"init",async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}}),Ot(this,"has",i=>(this.isInitialized(),this.keychain.has(i))),Ot(this,"set",async(i,s)=>{this.isInitialized(),this.keychain.set(i,s),await this.persist()}),Ot(this,"get",i=>{this.isInitialized();const s=this.keychain.get(i);if(typeof s>"u"){const{message:n}=z("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(n)}return s}),Ot(this,"del",async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()}),this.core=e,this.logger=ot(r,this.name)}get context(){return et(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,Bo(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?To(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var N_=Object.defineProperty,C_=(t,e,r)=>e in t?N_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,_e=(t,e,r)=>C_(t,typeof e!="symbol"?e+"":e,r);class U_{constructor(e,r,i){this.core=e,this.logger=r,_e(this,"name",O8),_e(this,"keychain"),_e(this,"randomSessionIdentifier",jo()),_e(this,"initialized",!1),_e(this,"clientId"),_e(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),_e(this,"hasKeys",s=>(this.isInitialized(),this.keychain.has(s))),_e(this,"getClientId",async()=>{if(this.isInitialized(),this.clientId)return this.clientId;const s=await this.getClientSeed(),n=Nc(s),o=xh(n.publicKey);return this.clientId=o,o}),_e(this,"generateKeyPair",()=>{this.isInitialized();const s=Hx();return this.setPrivateKey(s.publicKey,s.privateKey)}),_e(this,"signJWT",async s=>{this.isInitialized();const n=await this.getClientSeed(),o=Nc(n),a=this.randomSessionIdentifier;return await Cw(a,s,B8,o)}),_e(this,"generateSharedKey",(s,n,o)=>{this.isInitialized();const a=this.getPrivateKey(s),c=Wx(a,n);return this.setSymKey(c,o)}),_e(this,"setSymKey",async(s,n)=>{this.isInitialized();const o=n||Is(s);return await this.keychain.set(o,s),o}),_e(this,"deleteKeyPair",async s=>{this.isInitialized(),await this.keychain.del(s)}),_e(this,"deleteSymKey",async s=>{this.isInitialized(),await this.keychain.del(s)}),_e(this,"encode",async(s,n,o)=>{this.isInitialized();const a=vd(o),c=Mg(n);if(Gu(a))return Zx(c,o==null?void 0:o.encoding);if(Wu(a)){const f=a.senderPublicKey,g=a.receiverPublicKey;s=await this.generateSharedKey(f,g)}const u=this.getSymKey(s),{type:l,senderPublicKey:h}=a;return Gx({type:l,symKey:u,message:c,senderPublicKey:h,encoding:o==null?void 0:o.encoding})}),_e(this,"decode",async(s,n,o)=>{this.isInitialized();const a=Xx(n,o);if(Gu(a)){const c=Jx(n,o==null?void 0:o.encoding);return pc(c)}if(Wu(a)){const c=a.receiverPublicKey,u=a.senderPublicKey;s=await this.generateSharedKey(c,u)}try{const c=this.getSymKey(s),u=Yx({symKey:c,encoded:n,encoding:o==null?void 0:o.encoding});return pc(u)}catch(c){this.logger.error(`Failed to decode message from topic: '${s}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),_e(this,"getPayloadType",(s,n=Ze)=>{const o=ji({encoded:s,encoding:n});return Lr(o.type)}),_e(this,"getPayloadSenderPublicKey",(s,n=Ze)=>{const o=ji({encoded:s,encoding:n});return o.senderPublicKey?Qe(o.senderPublicKey,ze):void 0}),this.core=e,this.logger=ot(r,this.name),this.keychain=i||new P_(this.core,this.logger)}get context(){return et(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(hl)}catch{e=jo(),await this.keychain.set(hl,e)}return O_(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var R_=Object.defineProperty,k_=Object.defineProperties,F_=Object.getOwnPropertyDescriptors,ml=Object.getOwnPropertySymbols,L_=Object.prototype.hasOwnProperty,M_=Object.prototype.propertyIsEnumerable,Go=(t,e,r)=>e in t?R_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,q_=(t,e)=>{for(var r in e||(e={}))L_.call(e,r)&&Go(t,r,e[r]);if(ml)for(var r of ml(e))M_.call(e,r)&&Go(t,r,e[r]);return t},j_=(t,e)=>k_(t,F_(e)),tt=(t,e,r)=>Go(t,typeof e!="symbol"?e+"":e,r);class z_ extends Sg{constructor(e,r){super(e,r),this.logger=e,this.core=r,tt(this,"messages",new Map),tt(this,"messagesWithoutClientAck",new Map),tt(this,"name",N8),tt(this,"version",C8),tt(this,"initialized",!1),tt(this,"storagePrefix",Ct),tt(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i);const s=await this.getRelayerMessagesWithoutClientAck();typeof s<"u"&&(this.messagesWithoutClientAck=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}}),tt(this,"set",async(i,s,n)=>{this.isInitialized();const o=dt(s);let a=this.messages.get(i);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=s,this.messages.set(i,a),n===_s.inbound){const c=this.messagesWithoutClientAck.get(i)||{};this.messagesWithoutClientAck.set(i,j_(q_({},c),{[o]:s}))}return await this.persist(),o}),tt(this,"get",i=>{this.isInitialized();let s=this.messages.get(i);return typeof s>"u"&&(s={}),s}),tt(this,"getWithoutAck",i=>{this.isInitialized();const s={};for(const n of i){const o=this.messagesWithoutClientAck.get(n)||{};s[n]=Object.values(o)}return s}),tt(this,"has",(i,s)=>{this.isInitialized();const n=this.get(i),o=dt(s);return typeof n[o]<"u"}),tt(this,"ack",async(i,s)=>{this.isInitialized();const n=this.messagesWithoutClientAck.get(i);if(typeof n>"u")return;const o=dt(s);delete n[o],Object.keys(n).length===0?this.messagesWithoutClientAck.delete(i):this.messagesWithoutClientAck.set(i,n),await this.persist()}),tt(this,"del",async i=>{this.isInitialized(),this.messages.delete(i),this.messagesWithoutClientAck.delete(i),await this.persist()}),this.logger=ot(e,this.name),this.core=r}get context(){return et(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,Bo(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,Bo(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?To(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?To(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var V_=Object.defineProperty,K_=Object.defineProperties,H_=Object.getOwnPropertyDescriptors,vl=Object.getOwnPropertySymbols,W_=Object.prototype.hasOwnProperty,G_=Object.prototype.propertyIsEnumerable,Yo=(t,e,r)=>e in t?V_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Jr=(t,e)=>{for(var r in e||(e={}))W_.call(e,r)&&Yo(t,r,e[r]);if(vl)for(var r of vl(e))G_.call(e,r)&&Yo(t,r,e[r]);return t},El=(t,e)=>K_(t,H_(e)),lt=(t,e,r)=>Yo(t,typeof e!="symbol"?e+"":e,r);class Y_ extends Dg{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,lt(this,"events",new St.EventEmitter),lt(this,"name",R8),lt(this,"queue",new Map),lt(this,"publishTimeout",V.toMiliseconds(V.ONE_MINUTE)),lt(this,"initialPublishTimeout",V.toMiliseconds(V.ONE_SECOND*15)),lt(this,"needsTransportRestart",!1),lt(this,"publish",async(i,s,n)=>{var o,a,c,u,l;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:s,opts:n}});const h=(n==null?void 0:n.ttl)||U8,f=(n==null?void 0:n.prompt)||!1,g=(n==null?void 0:n.tag)||0,d=(n==null?void 0:n.id)||yr().toString(),p=ri(Vs().protocol),b={id:d,method:(n==null?void 0:n.publishMethod)||p.publish,params:Jr({topic:i,message:s,ttl:h,prompt:f,tag:g,attestation:n==null?void 0:n.attestation},n==null?void 0:n.tvf)},v=`Failed to publish payload, please try again. id:${d} tag:${g}`;try{Ie((o=b.params)==null?void 0:o.prompt)&&((a=b.params)==null||delete a.prompt),Ie((c=b.params)==null?void 0:c.tag)&&((u=b.params)==null||delete u.tag);const _=new Promise(async m=>{const x=({id:O})=>{var N;((N=b.id)==null?void 0:N.toString())===O.toString()&&(this.removeRequestFromQueue(O),this.relayer.events.removeListener(ge.publish,x),m())};this.relayer.events.on(ge.publish,x);const D=Nt(new Promise((O,N)=>{this.rpcPublish(b,n).then(O).catch(R=>{this.logger.warn(R,R==null?void 0:R.message),N(R)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${d} tag:${g}`);try{await D,this.events.removeListener(ge.publish,x)}catch(O){this.queue.set(d,{request:b,opts:n,attempt:1}),this.logger.warn(O,O==null?void 0:O.message)}});this.logger.trace({type:"method",method:"publish",params:{id:d,topic:i,message:s,opts:n}}),await Nt(_,this.publishTimeout,v)}catch(_){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(_),(l=n==null?void 0:n.internal)!=null&&l.throwOnFailedPublish)throw _}finally{this.queue.delete(d)}}),lt(this,"publishCustom",async i=>{var s,n,o,a,c;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:i});const{payload:u,opts:l={}}=i,{attestation:h,tvf:f,publishMethod:g,prompt:d,tag:p,ttl:b=V.FIVE_MINUTES}=l,v=l.id||yr().toString(),_=ri(Vs().protocol),m=g||_.publish,x={id:v,method:m,params:Jr(El(Jr({},u),{ttl:b,prompt:d,tag:p,attestation:h}),f)},D=`Failed to publish custom payload, please try again. id:${v} tag:${p}`;try{Ie((s=x.params)==null?void 0:s.prompt)&&((n=x.params)==null||delete n.prompt),Ie((o=x.params)==null?void 0:o.tag)&&((a=x.params)==null||delete a.tag);const O=new Promise(async N=>{const R=({id:q})=>{var F;((F=x.id)==null?void 0:F.toString())===q.toString()&&(this.removeRequestFromQueue(q),this.relayer.events.removeListener(ge.publish,R),N())};this.relayer.events.on(ge.publish,R);const T=Nt(new Promise((q,F)=>{this.rpcPublish(x,l).then(q).catch(P=>{this.logger.warn(P,P==null?void 0:P.message),F(P)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${m} id:${v} tag:${p}`);try{await T,this.events.removeListener(ge.publish,R)}catch(q){this.queue.set(v,{request:x,opts:l,attempt:1}),this.logger.warn(q,q==null?void 0:q.message)}});this.logger.trace({type:"method",method:"publish",params:{id:v,payload:u,opts:l}}),await Nt(O,this.publishTimeout,D)}catch(O){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(O),(c=l==null?void 0:l.internal)!=null&&c.throwOnFailedPublish)throw O}finally{this.queue.delete(v)}}),lt(this,"on",(i,s)=>{this.events.on(i,s)}),lt(this,"once",(i,s)=>{this.events.once(i,s)}),lt(this,"off",(i,s)=>{this.events.off(i,s)}),lt(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.relayer=e,this.logger=ot(r,this.name),this.registerEventListeners()}get context(){return et(this.logger)}async rpcPublish(e,r){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:e});const i=await this.relayer.request(e);return this.relayer.events.emit(ge.publish,Jr(Jr({},e),r)),this.logger.debug("Successfully Published Payload"),i}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,r)=>{var i;const s=e.attempt+1;this.queue.set(r,El(Jr({},e),{attempt:s})),this.logger.warn({},`Publisher: queue->publishing: ${e.request.id}, tag: ${(i=e.request.params)==null?void 0:i.tag}, attempt: ${s}`),await this.rpcPublish(e.request,e.opts),this.logger.warn({},`Publisher: queue->published: ${e.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(qr.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(ge.connection_stalled);return}this.checkQueue()}),this.relayer.on(ge.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var Z_=Object.defineProperty,J_=(t,e,r)=>e in t?Z_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Xr=(t,e,r)=>J_(t,typeof e!="symbol"?e+"":e,r);class X_{constructor(){Xr(this,"map",new Map),Xr(this,"set",(e,r)=>{const i=this.get(e);this.exists(e,r)||this.map.set(e,[...i,r])}),Xr(this,"get",e=>this.map.get(e)||[]),Xr(this,"exists",(e,r)=>this.get(e).includes(r)),Xr(this,"delete",(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,r))return;const s=i.filter(n=>n!==r);if(!s.length){this.map.delete(e);return}this.map.set(e,s)}),Xr(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var Q_=Object.defineProperty,eS=Object.defineProperties,tS=Object.getOwnPropertyDescriptors,xl=Object.getOwnPropertySymbols,rS=Object.prototype.hasOwnProperty,iS=Object.prototype.propertyIsEnumerable,Zo=(t,e,r)=>e in t?Q_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ai=(t,e)=>{for(var r in e||(e={}))rS.call(e,r)&&Zo(t,r,e[r]);if(xl)for(var r of xl(e))iS.call(e,r)&&Zo(t,r,e[r]);return t},co=(t,e)=>eS(t,tS(e)),ce=(t,e,r)=>Zo(t,typeof e!="symbol"?e+"":e,r);class sS extends Og{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,ce(this,"subscriptions",new Map),ce(this,"topicMap",new X_),ce(this,"events",new St.EventEmitter),ce(this,"name",z8),ce(this,"version",V8),ce(this,"pending",new Map),ce(this,"cached",[]),ce(this,"initialized",!1),ce(this,"storagePrefix",Ct),ce(this,"subscribeTimeout",V.toMiliseconds(V.ONE_MINUTE)),ce(this,"initialSubscribeTimeout",V.toMiliseconds(V.ONE_SECOND*15)),ce(this,"clientId"),ce(this,"batchSubscribeTopicsLimit",500),ce(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),ce(this,"subscribe",async(i,s)=>{var n;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}});try{const o=Vs(s),a={topic:i,relay:o,transportType:s==null?void 0:s.transportType};(n=s==null?void 0:s.internal)!=null&&n.skipSubscribe||this.pending.set(i,a);const c=await this.rpcSubscribe(i,o,s);return typeof c=="string"&&(this.onSubscribe(c,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}})),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}}),ce(this,"unsubscribe",async(i,s)=>{this.isInitialized(),typeof(s==null?void 0:s.id)<"u"?await this.unsubscribeById(i,s.id,s):await this.unsubscribeByTopic(i,s)}),ce(this,"isSubscribed",i=>new Promise(s=>{s(this.topicMap.topics.includes(i))})),ce(this,"isKnownTopic",i=>new Promise(s=>{s(this.topicMap.topics.includes(i)||this.pending.has(i)||this.cached.some(n=>n.topic===i))})),ce(this,"on",(i,s)=>{this.events.on(i,s)}),ce(this,"once",(i,s)=>{this.events.once(i,s)}),ce(this,"off",(i,s)=>{this.events.off(i,s)}),ce(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),ce(this,"start",async()=>{await this.onConnect()}),ce(this,"stop",async()=>{await this.onDisconnect()}),ce(this,"restart",async()=>{await this.restore(),await this.onRestart()}),ce(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const i=[];this.pending.forEach(s=>{i.push(s)}),await this.batchSubscribe(i)}),ce(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(qr.pulse,async()=>{await this.checkPending()}),this.events.on(rt.created,async i=>{const s=rt.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:i}),await this.persist()}),this.events.on(rt.deleted,async i=>{const s=rt.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:i}),await this.persist()})}),this.relayer=e,this.logger=ot(r,this.name),this.clientId=""}get context(){return et(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,r){let i=!1;try{i=this.getSubscription(e).topic===r}catch{}return i}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){const i=this.topicMap.get(e);await Promise.all(i.map(async s=>await this.unsubscribeById(e,s,r)))}async unsubscribeById(e,r,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}});try{const s=Vs(i);await this.restartToComplete({topic:e,id:r,relay:s}),await this.rpcUnsubscribe(e,r,s);const n=de("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,n),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,r,i){var s,n;const o=await this.getSubscriptionId(e);if((s=i==null?void 0:i.internal)!=null&&s.skipSubscribe)return o;(!i||(i==null?void 0:i.transportType)===he.relay)&&await this.restartToComplete({topic:e,id:e,relay:r});const a={method:ri(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a});const c=(n=i==null?void 0:i.internal)==null?void 0:n.throwOnFailedPublish;try{if((i==null?void 0:i.transportType)===he.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(a).catch(h=>this.logger.warn(h))},V.toMiliseconds(V.ONE_SECOND)),o;const u=new Promise(async h=>{const f=g=>{g.topic===e&&(this.events.removeListener(rt.created,f),h(g.id))};this.events.on(rt.created,f);try{const g=await Nt(new Promise((d,p)=>{this.relayer.request(a).catch(b=>{this.logger.warn(b,b==null?void 0:b.message),p(b)}).then(d)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(rt.created,f),h(g)}catch{}}),l=await Nt(u,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!l&&c)throw new Error(`Subscribing to ${e} failed, please try again`);return l?o:null}catch(u){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(ge.connection_stalled),c)throw u}return null}async rpcBatchSubscribe(e){if(!e.length)return;const r=e[0].relay,i={method:ri(r.protocol).batchSubscribe,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{await await Nt(new Promise(s=>{this.relayer.request(i).catch(n=>this.logger.warn(n)).then(s)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(ge.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const r=e[0].relay,i={method:ri(r.protocol).batchFetchMessages,params:{topics:e.map(n=>n.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});let s;try{s=await await Nt(new Promise((n,o)=>{this.relayer.request(i).catch(a=>{this.logger.warn(a),o(a)}).then(n)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(ge.connection_stalled)}return s}rpcUnsubscribe(e,r,i){const s={method:ri(i.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.request(s)}onSubscribe(e,r){this.setSubscription(e,co(Ai({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,Ai({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,i){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r)}addSubscription(e,r){this.subscriptions.set(e,Ai({},r)),this.topicMap.set(r.topic,e),this.events.emit(rt.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:i}=z("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(rt.deleted,co(Ai({},i),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(rt.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let i=0;i<r;i++){const s=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(rt.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size&&!e.every(r=>{var i;return r.topic===((i=this.subscriptions.get(r.id))==null?void 0:i.topic)})){const{message:r}=z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async r=>co(Ai({},r),{id:await this.getSubscriptionId(r.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const r=await this.rpcBatchFetchMessages(e);r&&r.messages&&(await pv(V.toMiliseconds(V.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(r.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return dt(e+await this.getClientId())}}var nS=Object.defineProperty,Il=Object.getOwnPropertySymbols,oS=Object.prototype.hasOwnProperty,aS=Object.prototype.propertyIsEnumerable,Jo=(t,e,r)=>e in t?nS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,_l=(t,e)=>{for(var r in e||(e={}))oS.call(e,r)&&Jo(t,r,e[r]);if(Il)for(var r of Il(e))aS.call(e,r)&&Jo(t,r,e[r]);return t},ie=(t,e,r)=>Jo(t,typeof e!="symbol"?e+"":e,r);class cS extends Ag{constructor(e){var r;super(e),ie(this,"protocol","wc"),ie(this,"version",2),ie(this,"core"),ie(this,"logger"),ie(this,"events",new St.EventEmitter),ie(this,"provider"),ie(this,"messages"),ie(this,"subscriber"),ie(this,"publisher"),ie(this,"name",F8),ie(this,"transportExplicitlyClosed",!1),ie(this,"initialized",!1),ie(this,"connectionAttemptInProgress",!1),ie(this,"relayUrl"),ie(this,"projectId"),ie(this,"packageName"),ie(this,"bundleId"),ie(this,"hasExperiencedNetworkDisruption",!1),ie(this,"pingTimeout"),ie(this,"heartBeatTimeout",V.toMiliseconds(V.THIRTY_SECONDS+V.FIVE_SECONDS)),ie(this,"reconnectTimeout"),ie(this,"connectPromise"),ie(this,"reconnectInProgress",!1),ie(this,"requestsInFlight",[]),ie(this,"connectTimeout",V.toMiliseconds(V.ONE_SECOND*15)),ie(this,"request",async i=>{var s,n;this.logger.debug("Publishing Request Payload");const o=i.id||yr().toString();await this.toEstablishConnection();try{this.logger.trace({id:o,method:i.method,topic:(s=i.params)==null?void 0:s.topic},"relayer.request - publishing...");const a=`${o}:${((n=i.params)==null?void 0:n.tag)||""}`;this.requestsInFlight.push(a);const c=await this.provider.request(i);return this.requestsInFlight=this.requestsInFlight.filter(u=>u!==a),c}catch(a){throw this.logger.debug(`Failed to Publish Request: ${o}`),a}}),ie(this,"resetPingTimeout",()=>{Fs()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var i,s,n,o;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(o=(n=(s=(i=this.provider)==null?void 0:i.connection)==null?void 0:s.socket)==null?void 0:n.terminate)==null||o.call(n)}catch(a){this.logger.warn(a,a==null?void 0:a.message)}},this.heartBeatTimeout))}),ie(this,"onPayloadHandler",i=>{this.onProviderPayload(i),this.resetPingTimeout()}),ie(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected "),this.startPingTimeout(),this.events.emit(ge.connect)}),ie(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected "),this.requestsInFlight=[],this.onProviderDisconnect()}),ie(this,"onProviderErrorHandler",i=>{this.logger.fatal(`Fatal socket error: ${i.message}`),this.events.emit(ge.error,i),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),ie(this,"registerProviderListeners",()=>{this.provider.on(ut.payload,this.onPayloadHandler),this.provider.on(ut.connect,this.onConnectHandler),this.provider.on(ut.disconnect,this.onDisconnectHandler),this.provider.on(ut.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=_d({logger:(r=e.logger)!=null?r:k8,name:this.name}),this.messages=new z_(this.logger,e.core),this.subscriber=new sS(this,this.logger),this.publisher=new Y_(this,this.logger),this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||Od,X2()?this.packageName=gu():Q2()&&(this.bundleId=gu()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,e==null?void 0:e.message))}get context(){return et(this.logger)}get connected(){var e,r,i;return((i=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:i.readyState)===1||!1}get connecting(){var e,r,i;return((i=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:i.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,r,i){this.isInitialized(),await this.publisher.publish(e,r,i),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now(),transportType:he.relay},_s.outbound)}async publishCustom(e){this.isInitialized(),await this.publisher.publishCustom(e)}async subscribe(e,r){var i,s,n;this.isInitialized(),(!(r!=null&&r.transportType)||(r==null?void 0:r.transportType)==="relay")&&await this.toEstablishConnection();const o=typeof((i=r==null?void 0:r.internal)==null?void 0:i.throwOnFailedPublish)>"u"?!0:(s=r==null?void 0:r.internal)==null?void 0:s.throwOnFailedPublish;let a=((n=this.subscriber.topicMap.get(e))==null?void 0:n[0])||"",c;const u=l=>{l.topic===e&&(this.subscriber.off(rt.created,u),c())};return await Promise.all([new Promise(l=>{c=l,this.subscriber.on(rt.created,u)}),new Promise(async(l,h)=>{a=await this.subscriber.subscribe(e,_l({internal:{throwOnFailedPublish:o}},r)).catch(f=>{o&&h(f)})||a,l()})]),a}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await Nt(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.info("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(r,i)=>{await this.connect(e).then(r).catch(i).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await al())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if((e==null?void 0:e.length)===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const r=e.sort((i,s)=>i.publishedAt-s.publishedAt);this.logger.debug(`Batch of ${r.length} message events sorted`);for(const i of r)try{await this.onMessageEvent(i)}catch(s){this.logger.warn(s,"Error while processing batch message event: "+(s==null?void 0:s.message))}this.logger.trace(`Batch of ${r.length} message events processed`)}async onLinkMessageEvent(e,r){const{topic:i}=e;if(!r.sessionExists){const s=Ee(V.FIVE_MINUTES),n={topic:i,expiry:s,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(i,n)}this.events.emit(ge.message,e),await this.recordMessageEvent(e,_s.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let r=1;for(;r<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${r}...`),await this.createProvider(),await new Promise(async(i,s)=>{const n=()=>{s(new Error("Connection interrupted while trying to connect"))};this.provider.once(ut.disconnect,n),await Nt(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{s(o)}).finally(()=>{this.provider.off(ut.disconnect,n),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{s(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(ut.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(ut.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,i()})}catch(i){await this.subscriber.stop();const s=i;this.logger.warn({},s.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${r}`);break}await new Promise(i=>setTimeout(i,V.toMiliseconds(r*1))),r++}}startPingTimeout(){var e,r,i,s,n;if(Fs())try{(r=(e=this.provider)==null?void 0:e.connection)!=null&&r.socket&&((n=(s=(i=this.provider)==null?void 0:i.connection)==null?void 0:s.socket)==null||n.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o==null?void 0:o.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new w8(new S8(sv({sdkVersion:Ko,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,r){const{topic:i,message:s}=e;await this.messages.set(i,s,r)}async shouldIgnoreMessageEvent(e){const{topic:r,message:i}=e;if(!i||i.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${i}`),!0;if(!await this.subscriber.isKnownTopic(r))return this.logger.warn(`Ignoring message for unknown topic ${r}`),!0;const s=this.messages.has(r,i);return s&&this.logger.warn(`Ignoring duplicate message: ${i}`),s}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Ca(e)){if(!e.method.endsWith(L8))return;const r=e.params,{topic:i,message:s,publishedAt:n,attestation:o}=r.data,a={topic:i,message:s,publishedAt:n,transportType:he.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(_l({type:"event",event:r.id},a)),this.events.emit(r.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else ln(e)&&this.events.emit(ge.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,_s.inbound),this.events.emit(ge.message,e))}async acknowledgePayload(e){const r=Ds(e.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(ut.payload,this.onPayloadHandler),this.provider.off(ut.connect,this.onConnectHandler),this.provider.off(ut.disconnect,this.onDisconnectHandler),this.provider.off(ut.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await al();X3(async r=>{e!==r&&(e=r,r?await this.transportOpen().catch(i=>this.logger.error(i,i==null?void 0:i.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(qr.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&t8())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(r){this.logger.warn(r,r==null?void 0:r.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(ge.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e==null?void 0:e.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},V.toMiliseconds(M8)))))}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}}function uS(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function Sl(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function Dl(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const lS="[object RegExp]",hS="[object String]",fS="[object Number]",dS="[object Boolean]",Al="[object Arguments]",pS="[object Symbol]",gS="[object Date]",yS="[object Map]",wS="[object Set]",bS="[object Array]",mS="[object Function]",vS="[object ArrayBuffer]",uo="[object Object]",ES="[object Error]",xS="[object DataView]",IS="[object Uint8Array]",_S="[object Uint8ClampedArray]",SS="[object Uint16Array]",DS="[object Uint32Array]",AS="[object BigUint64Array]",$S="[object Int8Array]",OS="[object Int16Array]",BS="[object Int32Array]",TS="[object BigInt64Array]",PS="[object Float32Array]",NS="[object Float64Array]";function CS(){}function $l(t){if(!t||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function US(t,e,r){return Ti(t,e,void 0,void 0,void 0,void 0,r)}function Ti(t,e,r,i,s,n,o){const a=o(t,e,r,i,s,n);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return Ri(t,e,n,o)}return Ri(t,e,n,o)}function Ri(t,e,r,i){if(Object.is(t,e))return!0;let s=Dl(t),n=Dl(e);if(s===Al&&(s=uo),n===Al&&(n=uo),s!==n)return!1;switch(s){case hS:return t.toString()===e.toString();case fS:{const c=t.valueOf(),u=e.valueOf();return uS(c,u)}case dS:case gS:case pS:return Object.is(t.valueOf(),e.valueOf());case lS:return t.source===e.source&&t.flags===e.flags;case mS:return t===e}r=r??new Map;const o=r.get(t),a=r.get(e);if(o!=null&&a!=null)return o===e;r.set(t,e),r.set(e,t);try{switch(s){case yS:{if(t.size!==e.size)return!1;for(const[c,u]of t.entries())if(!e.has(c)||!Ti(u,e.get(c),c,t,e,r,i))return!1;return!0}case wS:{if(t.size!==e.size)return!1;const c=Array.from(t.values()),u=Array.from(e.values());for(let l=0;l<c.length;l++){const h=c[l],f=u.findIndex(g=>Ti(h,g,void 0,t,e,r,i));if(f===-1)return!1;u.splice(f,1)}return!0}case bS:case IS:case _S:case SS:case DS:case AS:case $S:case OS:case BS:case TS:case PS:case NS:{if(typeof se<"u"&&se.isBuffer(t)!==se.isBuffer(e)||t.length!==e.length)return!1;for(let c=0;c<t.length;c++)if(!Ti(t[c],e[c],c,t,e,r,i))return!1;return!0}case vS:return t.byteLength!==e.byteLength?!1:Ri(new Uint8Array(t),new Uint8Array(e),r,i);case xS:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:Ri(new Uint8Array(t),new Uint8Array(e),r,i);case ES:return t.name===e.name&&t.message===e.message;case uo:{if(!(Ri(t.constructor,e.constructor,r,i)||$l(t)&&$l(e)))return!1;const c=[...Object.keys(t),...Sl(t)],u=[...Object.keys(e),...Sl(e)];if(c.length!==u.length)return!1;for(let l=0;l<c.length;l++){const h=c[l],f=t[h];if(!Object.hasOwn(e,h))return!1;const g=e[h];if(!Ti(f,g,h,t,e,r,i))return!1}return!0}default:return!1}}finally{r.delete(t),r.delete(e)}}function RS(t,e){return US(t,e,CS)}var kS=Object.defineProperty,Ol=Object.getOwnPropertySymbols,FS=Object.prototype.hasOwnProperty,LS=Object.prototype.propertyIsEnumerable,Xo=(t,e,r)=>e in t?kS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Bl=(t,e)=>{for(var r in e||(e={}))FS.call(e,r)&&Xo(t,r,e[r]);if(Ol)for(var r of Ol(e))LS.call(e,r)&&Xo(t,r,e[r]);return t},Ke=(t,e,r)=>Xo(t,typeof e!="symbol"?e+"":e,r);class Vr extends $g{constructor(e,r,i,s=Ct,n=void 0){super(e,r,i,s),this.core=e,this.logger=r,this.name=i,Ke(this,"map",new Map),Ke(this,"version",q8),Ke(this,"cached",[]),Ke(this,"initialized",!1),Ke(this,"getKey"),Ke(this,"storagePrefix",Ct),Ke(this,"recentlyDeleted",[]),Ke(this,"recentlyDeletedLimit",200),Ke(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!Ie(o)?this.map.set(this.getKey(o),o):O3(o)?this.map.set(o.id,o):B3(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),Ke(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),Ke(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),Ke(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>RS(a[c],o[c]))):this.values)),Ke(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=Bl(Bl({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),Ke(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=ot(r,this.name),this.storagePrefix=s,this.getKey=n}get context(){return et(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){if(this.recentlyDeleted.includes(e)){const{message:s}=z("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}const{message:i}=z("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var MS=Object.defineProperty,qS=(t,e,r)=>e in t?MS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Q=(t,e,r)=>qS(t,typeof e!="symbol"?e+"":e,r);class jS{constructor(e,r){this.core=e,this.logger=r,Q(this,"name",K8),Q(this,"version",H8),Q(this,"events",new Ll),Q(this,"pairings"),Q(this,"initialized",!1),Q(this,"storagePrefix",Ct),Q(this,"ignoredPayloadTypes",[Yt]),Q(this,"registeredMethods",[]),Q(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),Q(this,"register",({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]}),Q(this,"create",async i=>{this.isInitialized();const s=jo(),n=await this.core.crypto.setSymKey(s),o=Ee(V.FIVE_MINUTES),a={protocol:$d},c={topic:n,expiry:o,relay:a,active:!1,methods:i==null?void 0:i.methods},u=Xu({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:s,relay:a,expiryTimestamp:o,methods:i==null?void 0:i.methods});return this.events.emit(Or.create,c),this.core.expirer.set(n,o),await this.pairings.set(n,c),await this.core.relayer.subscribe(n,{transportType:i==null?void 0:i.transportType,internal:i==null?void 0:i.internal}),{topic:n,uri:u}}),Q(this,"pair",async i=>{this.isInitialized();const s=this.core.eventClient.createEvent({properties:{topic:i==null?void 0:i.uri,trace:[Tt.pairing_started]}});this.isValidPair(i,s);const{topic:n,symKey:o,relay:a,expiryTimestamp:c,methods:u}=Ju(i.uri);s.props.properties.topic=n,s.addTrace(Tt.pairing_uri_validation_success),s.addTrace(Tt.pairing_uri_not_expired);let l;if(this.pairings.keys.includes(n)){if(l=this.pairings.get(n),s.addTrace(Tt.existing_pairing),l.active)throw s.setError(qt.active_pairing_already_exists),new Error(`Pairing already exists: ${n}. Please try again with a new connection URI.`);s.addTrace(Tt.pairing_not_expired)}const h=c||Ee(V.FIVE_MINUTES),f={topic:n,relay:a,expiry:h,active:!1,methods:u};this.core.expirer.set(n,h),await this.pairings.set(n,f),s.addTrace(Tt.store_new_pairing),i.activatePairing&&await this.activate({topic:n}),this.events.emit(Or.create,f),s.addTrace(Tt.emit_inactive_pairing),this.core.crypto.keychain.has(n)||await this.core.crypto.setSymKey(o,n),s.addTrace(Tt.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{s.setError(qt.no_internet_connection)}try{await this.core.relayer.subscribe(n,{relay:a})}catch(g){throw s.setError(qt.subscribe_pairing_topic_failure),g}return s.addTrace(Tt.subscribe_pairing_topic_success),f}),Q(this,"activate",async({topic:i})=>{this.isInitialized();const s=Ee(V.FIVE_MINUTES);this.core.expirer.set(i,s),await this.pairings.update(i,{active:!0,expiry:s})}),Q(this,"ping",async i=>{this.isInitialized(),await this.isValidPing(i),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:s}=i;if(this.pairings.keys.includes(s)){const n=await this.sendRequest(s,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=Ar();this.events.once(ne("pairing_ping",n),({error:u})=>{u?c(u):a()}),await o()}}),Q(this,"updateExpiry",async({topic:i,expiry:s})=>{this.isInitialized(),await this.pairings.update(i,{expiry:s})}),Q(this,"updateMetadata",async({topic:i,metadata:s})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:s})}),Q(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),Q(this,"disconnect",async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:s}=i;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",de("USER_DISCONNECTED")),await this.deletePairing(s))}),Q(this,"formatUriFromPairing",i=>{this.isInitialized();const{topic:s,relay:n,expiry:o,methods:a}=i,c=this.core.crypto.keychain.get(s);return Xu({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:c,relay:n,expiryTimestamp:o,methods:a})}),Q(this,"sendRequest",async(i,s,n)=>{const o=zt(s,n),a=await this.core.crypto.encode(i,o),c=Si[s].req;return this.core.history.set(i,o),this.core.relayer.publish(i,a,c),o.id}),Q(this,"sendResult",async(i,s,n)=>{const o=Ds(i,n),a=await this.core.crypto.encode(s,o),c=(await this.core.history.get(s,i)).request.method,u=Si[c].res;await this.core.relayer.publish(s,a,u),await this.core.history.resolve(o)}),Q(this,"sendError",async(i,s,n)=>{const o=ra(i,n),a=await this.core.crypto.encode(s,o),c=(await this.core.history.get(s,i)).request.method,u=Si[c]?Si[c].res:Si.unregistered_method.res;await this.core.relayer.publish(s,a,u),await this.core.history.resolve(o)}),Q(this,"deletePairing",async(i,s)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,de("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),s?Promise.resolve():this.core.expirer.del(i)])}),Q(this,"cleanup",async()=>{const i=this.pairings.getAll().filter(s=>ur(s.expiry));await Promise.all(i.map(s=>this.deletePairing(s.topic)))}),Q(this,"onRelayEventRequest",async i=>{const{topic:s,payload:n}=i;switch(n.method){case"wc_pairingPing":return await this.onPairingPingRequest(s,n);case"wc_pairingDelete":return await this.onPairingDeleteRequest(s,n);default:return await this.onUnknownRpcMethodRequest(s,n)}}),Q(this,"onRelayEventResponse",async i=>{const{topic:s,payload:n}=i,o=(await this.core.history.get(s,n.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(s,n);default:return this.onUnknownRpcMethodResponse(o)}}),Q(this,"onPairingPingRequest",async(i,s)=>{const{id:n}=s;try{this.isValidPing({topic:i}),await this.sendResult(n,i,!0),this.events.emit(Or.ping,{id:n,topic:i})}catch(o){await this.sendError(n,i,o),this.logger.error(o)}}),Q(this,"onPairingPingResponse",(i,s)=>{const{id:n}=s;setTimeout(()=>{Pt(s)?this.events.emit(ne("pairing_ping",n),{}):pt(s)&&this.events.emit(ne("pairing_ping",n),{error:s.error})},500)}),Q(this,"onPairingDeleteRequest",async(i,s)=>{const{id:n}=s;try{this.isValidDisconnect({topic:i}),await this.deletePairing(i),this.events.emit(Or.delete,{id:n,topic:i})}catch(o){await this.sendError(n,i,o),this.logger.error(o)}}),Q(this,"onUnknownRpcMethodRequest",async(i,s)=>{const{id:n,method:o}=s;try{if(this.registeredMethods.includes(o))return;const a=de("WC_METHOD_UNSUPPORTED",o);await this.sendError(n,i,a),this.logger.error(a)}catch(a){await this.sendError(n,i,a),this.logger.error(a)}}),Q(this,"onUnknownRpcMethodResponse",i=>{this.registeredMethods.includes(i)||this.logger.error(de("WC_METHOD_UNSUPPORTED",i))}),Q(this,"isValidPair",(i,s)=>{var n;if(!We(i)){const{message:a}=z("MISSING_OR_INVALID",`pair() params: ${i}`);throw s.setError(qt.malformed_pairing_uri),new Error(a)}if(!$3(i.uri)){const{message:a}=z("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw s.setError(qt.malformed_pairing_uri),new Error(a)}const o=Ju(i==null?void 0:i.uri);if(!((n=o==null?void 0:o.relay)!=null&&n.protocol)){const{message:a}=z("MISSING_OR_INVALID","pair() uri#relay-protocol");throw s.setError(qt.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=z("MISSING_OR_INVALID","pair() uri#symKey");throw s.setError(qt.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&V.toMiliseconds(o==null?void 0:o.expiryTimestamp)<Date.now()){s.setError(qt.pairing_expired);const{message:a}=z("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),Q(this,"isValidPing",async i=>{if(!We(i)){const{message:n}=z("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(n)}const{topic:s}=i;await this.isValidPairingTopic(s)}),Q(this,"isValidDisconnect",async i=>{if(!We(i)){const{message:n}=z("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(n)}const{topic:s}=i;await this.isValidPairingTopic(s)}),Q(this,"isValidPairingTopic",async i=>{if(!me(i,!1)){const{message:s}=z("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(s)}if(!this.pairings.keys.includes(i)){const{message:s}=z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(s)}if(ur(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:s}=z("EXPIRED",`pairing topic: ${i}`);throw new Error(s)}}),this.core=e,this.logger=ot(r,this.name),this.pairings=new Vr(this.core,this.logger,this.name,this.storagePrefix)}get context(){return et(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(ge.message,async e=>{const{topic:r,message:i,transportType:s}=e;if(this.pairings.keys.includes(r)&&s!==he.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))try{const n=await this.core.crypto.decode(r,i);Ca(n)?(this.core.history.set(r,n),await this.onRelayEventRequest({topic:r,payload:n})):ln(n)&&(await this.core.history.resolve(n),await this.onRelayEventResponse({topic:r,payload:n}),this.core.history.delete(r,n.id)),await this.core.relayer.messages.ack(r,i)}catch(n){this.logger.error(n)}})}registerExpirerEvents(){this.core.expirer.on(ht.expired,async e=>{const{topic:r}=If(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Or.expire,{topic:r}))})}}var zS=Object.defineProperty,VS=(t,e,r)=>e in t?zS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Be=(t,e,r)=>VS(t,typeof e!="symbol"?e+"":e,r);class KS extends _g{constructor(e,r){super(e,r),this.core=e,this.logger=r,Be(this,"records",new Map),Be(this,"events",new St.EventEmitter),Be(this,"name",W8),Be(this,"version",G8),Be(this,"cached",[]),Be(this,"initialized",!1),Be(this,"storagePrefix",Ct),Be(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Be(this,"set",(i,s,n)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:s,chainId:n}),this.records.has(s.id))return;const o={id:s.id,topic:i,request:{method:s.method,params:s.params||null},chainId:n,expiry:Ee(V.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(mt.created,o)}),Be(this,"resolve",async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const s=await this.getRecord(i.id);typeof s.response>"u"&&(s.response=pt(i)?{error:i.error}:{result:i.result},this.records.set(s.id,s),this.persist(),this.events.emit(mt.updated,s))}),Be(this,"get",async(i,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:s}),await this.getRecord(s))),Be(this,"delete",(i,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(n=>{if(n.topic===i){if(typeof s<"u"&&n.id!==s)return;this.records.delete(n.id),this.events.emit(mt.deleted,n)}}),this.persist()}),Be(this,"exists",async(i,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===i:!1)),Be(this,"on",(i,s)=>{this.events.on(i,s)}),Be(this,"once",(i,s)=>{this.events.once(i,s)}),Be(this,"off",(i,s)=>{this.events.off(i,s)}),Be(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.logger=ot(r,this.name)}get context(){return et(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const i={topic:r.topic,request:zt(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:i}=z("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(mt.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(mt.created,e=>{const r=mt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(mt.updated,e=>{const r=mt.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(mt.deleted,e=>{const r=mt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.core.heartbeat.on(qr.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(r=>{V.toMiliseconds(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.records.delete(r.id),this.events.emit(mt.deleted,r,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var HS=Object.defineProperty,WS=(t,e,r)=>e in t?HS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Fe=(t,e,r)=>WS(t,typeof e!="symbol"?e+"":e,r);class GS extends Bg{constructor(e,r){super(e,r),this.core=e,this.logger=r,Fe(this,"expirations",new Map),Fe(this,"events",new St.EventEmitter),Fe(this,"name",Y8),Fe(this,"version",Z8),Fe(this,"cached",[]),Fe(this,"initialized",!1),Fe(this,"storagePrefix",Ct),Fe(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Fe(this,"has",i=>{try{const s=this.formatTarget(i);return typeof this.getExpiration(s)<"u"}catch{return!1}}),Fe(this,"set",(i,s)=>{this.isInitialized();const n=this.formatTarget(i),o={target:n,expiry:s};this.expirations.set(n,o),this.checkExpiry(n,o),this.events.emit(ht.created,{target:n,expiration:o})}),Fe(this,"get",i=>{this.isInitialized();const s=this.formatTarget(i);return this.getExpiration(s)}),Fe(this,"del",i=>{if(this.isInitialized(),this.has(i)){const s=this.formatTarget(i),n=this.getExpiration(s);this.expirations.delete(s),this.events.emit(ht.deleted,{target:s,expiration:n})}}),Fe(this,"on",(i,s)=>{this.events.on(i,s)}),Fe(this,"once",(i,s)=>{this.events.once(i,s)}),Fe(this,"off",(i,s)=>{this.events.off(i,s)}),Fe(this,"removeListener",(i,s)=>{this.events.removeListener(i,s)}),this.logger=ot(r,this.name)}get context(){return et(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return nv(e);if(typeof e=="number")return ov(e);const{message:r}=z("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(ht.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:i}=z("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(i),new Error(i)}return r}checkExpiry(e,r){const{expiry:i}=r;V.toMiliseconds(i)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(ht.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(qr.pulse,()=>this.checkExpirations()),this.events.on(ht.created,e=>{const r=ht.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(ht.expired,e=>{const r=ht.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(ht.deleted,e=>{const r=ht.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var YS=Object.defineProperty,ZS=(t,e,r)=>e in t?YS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,be=(t,e,r)=>ZS(t,typeof e!="symbol"?e+"":e,r);class JS extends Tg{constructor(e,r,i){super(e,r,i),this.core=e,this.logger=r,this.store=i,be(this,"name",J8),be(this,"abortController"),be(this,"isDevEnv"),be(this,"verifyUrlV3",Q8),be(this,"storagePrefix",Ct),be(this,"version",Ad),be(this,"publicKey"),be(this,"fetchPromise"),be(this,"init",async()=>{var s;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&V.toMiliseconds((s=this.publicKey)==null?void 0:s.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),be(this,"register",async s=>{if(!fi()||this.isDevEnv)return;const n=window.location.origin,{id:o,decryptedId:a}=s,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${n}&id=${o}&decryptedId=${a}`;try{const u=Zt.getDocument(),l=this.startAbortTimer(V.ONE_SECOND*5),h=await new Promise((f,g)=>{const d=()=>{window.removeEventListener("message",b),u.body.removeChild(p),g("attestation aborted")};this.abortController.signal.addEventListener("abort",d);const p=u.createElement("iframe");p.src=c,p.style.display="none",p.addEventListener("error",d,{signal:this.abortController.signal});const b=v=>{if(v.data&&typeof v.data=="string")try{const _=JSON.parse(v.data);if(_.type==="verify_attestation"){if(vo(_.attestation).payload.id!==o)return;clearInterval(l),u.body.removeChild(p),this.abortController.signal.removeEventListener("abort",d),window.removeEventListener("message",b),f(_.attestation===null?"":_.attestation)}}catch(_){this.logger.warn(_)}};u.body.appendChild(p),window.addEventListener("message",b,{signal:this.abortController.signal})});return this.logger.debug(h,"jwt attestation"),h}catch(u){this.logger.warn(u)}return""}),be(this,"resolve",async s=>{if(this.isDevEnv)return"";const{attestationId:n,hash:o,encryptedId:a}=s;if(n===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(n){if(vo(n).payload.id!==a)return;const u=await this.isValidJwtAttestation(n);if(u){if(!u.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return u}}if(!o)return;const c=this.getVerifyUrl(s==null?void 0:s.verifyUrl);return this.fetchAttestation(o,c)}),be(this,"fetchAttestation",async(s,n)=>{this.logger.debug(`resolving attestation: ${s} from url: ${n}`);const o=this.startAbortTimer(V.ONE_SECOND*5),a=await fetch(`${n}/attestation/${s}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),be(this,"getVerifyUrl",s=>{let n=s||Ui;return eI.includes(n)||(this.logger.info(`verify url: ${n}, not included in trusted list, assigning default: ${Ui}`),n=Ui),n}),be(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const s=this.startAbortTimer(V.FIVE_SECONDS),n=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(s),await n.json()}catch(s){this.logger.warn(s)}}),be(this,"persistPublicKey",async s=>{this.logger.debug(s,"persisting public key to local storage"),await this.store.setItem(this.storeKey,s),this.publicKey=s}),be(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),be(this,"isValidJwtAttestation",async s=>{const n=await this.getPublicKey();try{if(n)return this.validateAttestation(s,n)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(s,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),be(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),be(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async n=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),n(o))});const s=await this.fetchPromise;return this.fetchPromise=void 0,s}),be(this,"validateAttestation",(s,n)=>{const o=e3(s,n.publicKey),a={hasExpired:V.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=ot(r,this.name),this.abortController=new AbortController,this.isDevEnv=xa(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return et(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),V.toMiliseconds(e))}}var XS=Object.defineProperty,QS=(t,e,r)=>e in t?XS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Tl=(t,e,r)=>QS(t,typeof e!="symbol"?e+"":e,r);class eD extends Pg{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,Tl(this,"context",tI),Tl(this,"registerDeviceToken",async i=>{const{clientId:s,token:n,notificationType:o,enableEncrypted:a=!1}=i,c=`${rI}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:s,type:o,token:n,always_raw:a})})}),this.logger=ot(r,this.context)}}var tD=Object.defineProperty,Pl=Object.getOwnPropertySymbols,rD=Object.prototype.hasOwnProperty,iD=Object.prototype.propertyIsEnumerable,Qo=(t,e,r)=>e in t?tD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,$i=(t,e)=>{for(var r in e||(e={}))rD.call(e,r)&&Qo(t,r,e[r]);if(Pl)for(var r of Pl(e))iD.call(e,r)&&Qo(t,r,e[r]);return t},Se=(t,e,r)=>Qo(t,typeof e!="symbol"?e+"":e,r);class sD extends Ng{constructor(e,r,i=!0){super(e,r,i),this.core=e,this.logger=r,Se(this,"context",sI),Se(this,"storagePrefix",Ct),Se(this,"storageVersion",iI),Se(this,"events",new Map),Se(this,"shouldPersist",!1),Se(this,"init",async()=>{if(!xa())try{const s={eventId:wu(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:Ef(this.core.relayer.protocol,this.core.relayer.version,Ko)}}};await this.sendEvent([s])}catch(s){this.logger.warn(s)}}),Se(this,"createEvent",s=>{const{event:n="ERROR",type:o="",properties:{topic:a,trace:c}}=s,u=wu(),l=this.core.projectId||"",h=Date.now(),f=$i({eventId:u,timestamp:h,props:{event:n,type:o,properties:{topic:a,trace:c}},bundleId:l,domain:this.getAppDomain()},this.setMethods(u));return this.telemetryEnabled&&(this.events.set(u,f),this.shouldPersist=!0),f}),Se(this,"getEvent",s=>{const{eventId:n,topic:o}=s;if(n)return this.events.get(n);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return $i($i({},a),this.setMethods(a.eventId))}),Se(this,"deleteEvent",s=>{const{eventId:n}=s;this.events.delete(n),this.shouldPersist=!0}),Se(this,"setEventListeners",()=>{this.core.heartbeat.on(qr.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(s=>{V.fromMiliseconds(Date.now())-V.fromMiliseconds(s.timestamp)>nI&&(this.events.delete(s.eventId),this.shouldPersist=!0)})})}),Se(this,"setMethods",s=>({addTrace:n=>this.addTrace(s,n),setError:n=>this.setError(s,n)})),Se(this,"addTrace",(s,n)=>{const o=this.events.get(s);o&&(o.props.properties.trace.push(n),this.events.set(s,o),this.shouldPersist=!0)}),Se(this,"setError",(s,n)=>{const o=this.events.get(s);o&&(o.props.type=n,o.timestamp=Date.now(),this.events.set(s,o),this.shouldPersist=!0)}),Se(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),Se(this,"restore",async()=>{try{const s=await this.core.storage.getItem(this.storageKey)||[];if(!s.length)return;s.forEach(n=>{this.events.set(n.eventId,$i($i({},n),this.setMethods(n.eventId)))})}catch(s){this.logger.warn(s)}}),Se(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const s=[];for(const[n,o]of this.events)o.props.type&&s.push(o);if(s.length!==0)try{if((await this.sendEvent(s)).ok)for(const n of s)this.events.delete(n.eventId),this.shouldPersist=!0}catch(n){this.logger.warn(n)}}),Se(this,"sendEvent",async s=>{const n=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${oI}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${Ko}${n}`,{method:"POST",body:JSON.stringify(s)})}),Se(this,"getAppDomain",()=>vf().url),this.logger=ot(r,this.context),this.telemetryEnabled=i,i?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var nD=Object.defineProperty,Nl=Object.getOwnPropertySymbols,oD=Object.prototype.hasOwnProperty,aD=Object.prototype.propertyIsEnumerable,ea=(t,e,r)=>e in t?nD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Cl=(t,e)=>{for(var r in e||(e={}))oD.call(e,r)&&ea(t,r,e[r]);if(Nl)for(var r of Nl(e))aD.call(e,r)&&ea(t,r,e[r]);return t},ue=(t,e,r)=>ea(t,typeof e!="symbol"?e+"":e,r);class Ua extends vg{constructor(e){var r;super(e),ue(this,"protocol",Dd),ue(this,"version",Ad),ue(this,"name",Vo),ue(this,"relayUrl"),ue(this,"projectId"),ue(this,"customStoragePrefix"),ue(this,"events",new St.EventEmitter),ue(this,"logger"),ue(this,"heartbeat"),ue(this,"relayer"),ue(this,"crypto"),ue(this,"storage"),ue(this,"history"),ue(this,"expirer"),ue(this,"pairing"),ue(this,"verify"),ue(this,"echoClient"),ue(this,"linkModeSupportedApps"),ue(this,"eventClient"),ue(this,"initialized",!1),ue(this,"logChunkController"),ue(this,"on",(a,c)=>this.events.on(a,c)),ue(this,"once",(a,c)=>this.events.once(a,c)),ue(this,"off",(a,c)=>this.events.off(a,c)),ue(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),ue(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:u})=>{if(!a||!c)return;const l={topic:a,message:c,publishedAt:Date.now(),transportType:he.link_mode};this.relayer.onLinkMessageEvent(l,{sessionExists:u})});const i=this.getGlobalCore(e==null?void 0:e.customStoragePrefix);if(i)try{return this.customStoragePrefix=i.customStoragePrefix,this.logger=i.logger,this.heartbeat=i.heartbeat,this.crypto=i.crypto,this.history=i.history,this.expirer=i.expirer,this.storage=i.storage,this.relayer=i.relayer,this.pairing=i.pairing,this.verify=i.verify,this.echoClient=i.echoClient,this.linkModeSupportedApps=i.linkModeSupportedApps,this.eventClient=i.eventClient,this.initialized=i.initialized,this.logChunkController=i.logChunkController,i}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||Od,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const s=dg({level:typeof(e==null?void 0:e.logger)=="string"&&e.logger?e.logger:A8.logger,name:Vo}),{logger:n,chunkLoggerController:o}=Wl({opts:s,maxSizeInBytes:e==null?void 0:e.maxLogBlobSizeInBytes,loggerOverride:e==null?void 0:e.logger});this.logChunkController=o,(r=this.logChunkController)!=null&&r.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=ot(n,this.name),this.heartbeat=new cp,this.crypto=new U_(this,this.logger,e==null?void 0:e.keychain),this.history=new KS(this,this.logger),this.expirer=new GS(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new Vp(Cl(Cl({},$8),e==null?void 0:e.storageOptions)),this.relayer=new cS({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new jS(this,this.logger),this.verify=new JS(this,this.logger,this.storage),this.echoClient=new eD(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new sD(this,this.logger,e==null?void 0:e.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const r=new Ua(e);await r.initialize();const i=await r.crypto.getClientId();return await r.storage.setItem(j8,i),r}get context(){return et(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(fl,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(fl)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(e,`Core Initialization Failure at epoch ${Date.now()}`),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const r=`_walletConnectCore_${e}`,i=`${r}_count`;return globalThis[i]=(globalThis[i]||0)+1,globalThis[i]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[i]} times.`),globalThis[r]}catch(r){console.warn("Failed to get global WalletConnect core",r);return}}setGlobalCore(e){var r;try{if(this.isGlobalCoreDisabled())return;const i=`_walletConnectCore_${((r=e.opts)==null?void 0:r.customStoragePrefix)||""}`;globalThis[i]=e}catch(i){console.warn("Failed to set global WalletConnect core",i)}}isGlobalCoreDisabled(){try{return typeof Gt<"u"&&D8.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}}const cD=Ua,jd="wc",zd=2,Vd="client",Ra=`${jd}@${zd}:${Vd}:`,lo={name:Vd,logger:"error"},Ul="WALLETCONNECT_DEEPLINK_CHOICE",uD="proposal",Rl="Proposal expired",lD="session",Qr=V.SEVEN_DAYS,hD="engine",Te={wc_sessionPropose:{req:{ttl:V.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:V.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:V.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:V.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:V.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:V.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:V.ONE_DAY,prompt:!1,tag:1104},res:{ttl:V.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:V.ONE_DAY,prompt:!1,tag:1106},res:{ttl:V.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:V.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:V.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:V.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:V.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:V.ONE_DAY,prompt:!1,tag:1112},res:{ttl:V.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:V.ONE_DAY,prompt:!1,tag:1114},res:{ttl:V.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:V.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:V.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:V.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:V.FIVE_MINUTES,prompt:!1,tag:1119}}},ho={min:V.FIVE_MINUTES,max:V.SEVEN_DAYS},Bt={idle:"IDLE",active:"ACTIVE"},fD={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},dD="request",pD=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],gD="wc",yD="auth",wD="authKeys",bD="pairingTopics",mD="requests",fn=`${gD}@${1.5}:${yD}:`,Ss=`${fn}:PUB_KEY`;var vD=Object.defineProperty,ED=Object.defineProperties,xD=Object.getOwnPropertyDescriptors,kl=Object.getOwnPropertySymbols,ID=Object.prototype.hasOwnProperty,_D=Object.prototype.propertyIsEnumerable,ta=(t,e,r)=>e in t?vD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,oe=(t,e)=>{for(var r in e||(e={}))ID.call(e,r)&&ta(t,r,e[r]);if(kl)for(var r of kl(e))_D.call(e,r)&&ta(t,r,e[r]);return t},Le=(t,e)=>ED(t,xD(e)),L=(t,e,r)=>ta(t,typeof e!="symbol"?e+"":e,r);class SD extends kg{constructor(e){super(e),L(this,"name",hD),L(this,"events",new Ll),L(this,"initialized",!1),L(this,"requestQueue",{state:Bt.idle,queue:[]}),L(this,"sessionRequestQueue",{state:Bt.idle,queue:[]}),L(this,"emittedSessionRequests",new gv({limit:500})),L(this,"requestQueueDelay",V.ONE_SECOND),L(this,"expectedPairingMethodMap",new Map),L(this,"recentlyDeletedMap",new Map),L(this,"recentlyDeletedLimit",200),L(this,"relayMessageCache",[]),L(this,"pendingSessions",new Map),L(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(Te)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},V.toMiliseconds(this.requestQueueDelay)))}),L(this,"connect",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();const i=Le(oe({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(i),i.optionalNamespaces=I3(i.requiredNamespaces,i.optionalNamespaces),i.requiredNamespaces={};const{pairingTopic:s,requiredNamespaces:n,optionalNamespaces:o,sessionProperties:a,scopedProperties:c,relays:u}=i;let l=s,h,f=!1;try{if(l){const O=this.client.core.pairing.pairings.get(l);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),f=O.active}}catch(O){throw this.client.logger.error(`connect() -> pairing.get(${l}) failed`),O}if(!l||!f){const{topic:O,uri:N}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});l=O,h=N}if(!l){const{message:O}=z("NO_MATCHING_KEY",`connect() pairing topic: ${l}`);throw new Error(O)}const g=await this.client.core.crypto.generateKeyPair(),d=Te.wc_sessionPropose.req.ttl||V.FIVE_MINUTES,p=Ee(d),b=Le(oe(oe({requiredNamespaces:n,optionalNamespaces:o,relays:u??[{protocol:$d}],proposer:{publicKey:g,metadata:this.client.metadata},expiryTimestamp:p,pairingTopic:l},a&&{sessionProperties:a}),c&&{scopedProperties:c}),{id:Xt()}),v=ne("session_connect",b.id),{reject:_,resolve:m,done:x}=Ar(d,Rl),D=({id:O})=>{O===b.id&&(this.client.events.off("proposal_expire",D),this.pendingSessions.delete(b.id),this.events.emit(v,{error:{message:Rl,code:0}}))};return this.client.events.on("proposal_expire",D),this.events.once(v,({error:O,session:N})=>{this.client.events.off("proposal_expire",D),O?_(O):N&&m(N)}),await this.sendProposeSession({proposal:b,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:b.id}}}),await this.setProposal(b.id,b),{uri:h,approval:x}}),L(this,"pair",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(r)}catch(i){throw this.client.logger.error("pair() failed"),i}}),L(this,"approve",async r=>{var i,s,n;const o=this.client.core.eventClient.createEvent({properties:{topic:(i=r==null?void 0:r.id)==null?void 0:i.toString(),trace:[vt.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(T){throw o.setError(Sr.no_internet_connection),T}try{await this.isValidProposalId(r==null?void 0:r.id)}catch(T){throw this.client.logger.error(`approve() -> proposal.get(${r==null?void 0:r.id}) failed`),o.setError(Sr.proposal_not_found),T}try{await this.isValidApprove(r)}catch(T){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(Sr.session_approve_namespace_validation_failure),T}const{id:a,relayProtocol:c,namespaces:u,sessionProperties:l,scopedProperties:h,sessionConfig:f}=r,g=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});const{pairingTopic:d,proposer:p,requiredNamespaces:b,optionalNamespaces:v}=g;let _=(s=this.client.core.eventClient)==null?void 0:s.getEvent({topic:d});_||(_=(n=this.client.core.eventClient)==null?void 0:n.createEvent({type:vt.session_approve_started,properties:{topic:d,trace:[vt.session_approve_started,vt.session_namespaces_validation_success]}}));const m=await this.client.core.crypto.generateKeyPair(),x=p.publicKey,D=await this.client.core.crypto.generateSharedKey(m,x),O=oe(oe(oe({relay:{protocol:c??"irn"},namespaces:u,controller:{publicKey:m,metadata:this.client.metadata},expiry:Ee(Qr)},l&&{sessionProperties:l}),h&&{scopedProperties:h}),f&&{sessionConfig:f}),N=he.relay;_.addTrace(vt.subscribing_session_topic);try{await this.client.core.relayer.subscribe(D,{transportType:N,internal:{skipSubscribe:!0}})}catch(T){throw _.setError(Sr.subscribe_session_topic_failure),T}_.addTrace(vt.subscribe_session_topic_success);const R=Le(oe({},O),{topic:D,requiredNamespaces:b,optionalNamespaces:v,pairingTopic:d,acknowledged:!1,self:O.controller,peer:{publicKey:p.publicKey,metadata:p.metadata},controller:m,transportType:he.relay});await this.client.session.set(D,R),_.addTrace(vt.store_session);try{await this.sendApproveSession({sessionTopic:D,proposal:g,pairingProposalResponse:{relay:{protocol:c??"irn"},responderPublicKey:m},sessionSettleRequest:O,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:a}}}),_.addTrace(vt.session_approve_publish_success)}catch(T){throw this.client.logger.error(T),this.client.session.delete(D,de("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(D),T}return this.client.core.eventClient.deleteEvent({eventId:_.eventId}),await this.client.core.pairing.updateMetadata({topic:d,metadata:p.metadata}),await this.deleteProposal(a),await this.client.core.pairing.activate({topic:d}),await this.setExpiry(D,Ee(Qr)),{topic:D,acknowledged:()=>Promise.resolve(this.client.session.get(D))}}),L(this,"reject",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(r)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:i,reason:s}=r;let n;try{n=this.client.proposal.get(i).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${i}) failed`),o}n&&await this.sendError({id:i,topic:n,error:s,rpcOpts:Te.wc_sessionPropose.reject}),await this.deleteProposal(i)}),L(this,"update",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(r)}catch(h){throw this.client.logger.error("update() -> isValidUpdate() failed"),h}const{topic:i,namespaces:s}=r,{done:n,resolve:o,reject:a}=Ar(),c=Xt(),u=yr().toString(),l=this.client.session.get(i).namespaces;return this.events.once(ne("session_update",c),({error:h})=>{h?a(h):o()}),await this.client.session.update(i,{namespaces:s}),await this.sendRequest({topic:i,method:"wc_sessionUpdate",params:{namespaces:s},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:u}).catch(h=>{this.client.logger.error(h),this.client.session.update(i,{namespaces:l}),a(h)}),{acknowledged:n}}),L(this,"extend",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(r)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:i}=r,s=Xt(),{done:n,resolve:o,reject:a}=Ar();return this.events.once(ne("session_extend",s),({error:c})=>{c?a(c):o()}),await this.setExpiry(i,Ee(Qr)),this.sendRequest({topic:i,method:"wc_sessionExtend",params:{},clientRpcId:s,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:n}}),L(this,"request",async r=>{this.isInitialized();try{await this.isValidRequest(r)}catch(b){throw this.client.logger.error("request() -> isValidRequest() failed"),b}const{chainId:i,request:s,topic:n,expiry:o=Te.wc_sessionRequest.req.ttl}=r,a=this.client.session.get(n);(a==null?void 0:a.transportType)===he.relay&&await this.confirmOnlineStateOrThrow();const c=Xt(),u=yr().toString(),{done:l,resolve:h,reject:f}=Ar(o,"Request expired. Please try again.");this.events.once(ne("session_request",c),({error:b,result:v})=>{b?f(b):h(v)});const g="wc_sessionRequest",d=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(d)return await this.sendRequest({clientRpcId:c,relayRpcId:u,topic:n,method:g,params:{request:Le(oe({},s),{expiryTimestamp:Ee(o)}),chainId:i},expiry:o,throwOnFailedPublish:!0,appLink:d}).catch(b=>f(b)),this.client.events.emit("session_request_sent",{topic:n,request:s,chainId:i,id:c}),await l();const p={request:Le(oe({},s),{expiryTimestamp:Ee(o)}),chainId:i};return await Promise.all([new Promise(async b=>{await this.sendRequest({clientRpcId:c,relayRpcId:u,topic:n,method:g,params:p,expiry:o,throwOnFailedPublish:!0,tvf:this.getTVFParams(c,p)}).catch(v=>f(v)),this.client.events.emit("session_request_sent",{topic:n,request:s,chainId:i,id:c}),b()}),new Promise(async b=>{var v;if(!((v=a.sessionConfig)!=null&&v.disableDeepLink)){const _=await lv(this.client.core.storage,Ul);await av({id:c,topic:n,wcDeepLink:_})}b()}),l()]).then(b=>b[2])}),L(this,"respond",async r=>{var i,s;this.isInitialized();const n=this.client.core.eventClient.createEvent({properties:{topic:(r==null?void 0:r.topic)||((s=(i=r==null?void 0:r.response)==null?void 0:i.id)==null?void 0:s.toString()),trace:[vt.session_request_response_started]}});try{await this.isValidRespond(r)}catch(h){throw n.addTrace(h==null?void 0:h.message),n.setError(Sr.session_request_response_validation_failure),h}n.addTrace(vt.session_request_response_validation_success);const{topic:o,response:a}=r,{id:c}=a,u=this.client.session.get(o);u.transportType===he.relay&&await this.confirmOnlineStateOrThrow();const l=this.getAppLinkIfEnabled(u.peer.metadata,u.transportType);try{n.addTrace(vt.session_request_response_publish_started),Pt(a)?await this.sendResult({id:c,topic:o,result:a.result,throwOnFailedPublish:!0,appLink:l}):pt(a)&&await this.sendError({id:c,topic:o,error:a.error,appLink:l}),this.cleanupAfterResponse(r)}catch(h){throw n.addTrace(h==null?void 0:h.message),n.setError(Sr.session_request_response_publish_failure),h}}),L(this,"ping",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(r)}catch(s){throw this.client.logger.error("ping() -> isValidPing() failed"),s}const{topic:i}=r;if(this.client.session.keys.includes(i)){const s=Xt(),n=yr().toString(),{done:o,resolve:a,reject:c}=Ar();this.events.once(ne("session_ping",s),({error:u})=>{u?c(u):a()}),await Promise.all([this.sendRequest({topic:i,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:s,relayRpcId:n}),o()])}else this.client.core.pairing.pairings.keys.includes(i)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:i}))}),L(this,"emit",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(r);const{topic:i,event:s,chainId:n}=r,o=yr().toString(),a=Xt();await this.sendRequest({topic:i,method:"wc_sessionEvent",params:{event:s,chainId:n},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),L(this,"disconnect",async r=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(r);const{topic:i}=r;if(this.client.session.keys.includes(i))await this.sendRequest({topic:i,method:"wc_sessionDelete",params:de("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:i,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(i))await this.client.core.pairing.disconnect({topic:i});else{const{message:s}=z("MISMATCHED_TOPIC",`Session or pairing topic not found: ${i}`);throw new Error(s)}}),L(this,"find",r=>(this.isInitialized(),this.client.session.getAll().filter(i=>D3(i,r)))),L(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),L(this,"authenticate",async(r,i)=>{var s;this.isInitialized(),this.isValidAuthenticate(r);const n=i&&this.client.core.linkModeSupportedApps.includes(i)&&((s=this.client.metadata.redirect)==null?void 0:s.linkMode),o=n?he.link_mode:he.relay;o===he.relay&&await this.confirmOnlineStateOrThrow();const{chains:a,statement:c="",uri:u,domain:l,nonce:h,type:f,exp:g,nbf:d,methods:p=[],expiry:b}=r,v=[...r.resources||[]],{topic:_,uri:m}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:_,uri:m}});const x=await this.client.core.crypto.generateKeyPair(),D=Is(x);if(await Promise.all([this.client.auth.authKeys.set(Ss,{responseTopic:D,publicKey:x}),this.client.auth.pairingTopics.set(D,{topic:D,pairingTopic:_})]),await this.client.core.relayer.subscribe(D,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${_}`),p.length>0){const{namespace:I}=Es(a[0]);let $=DE(I,"request",p);xs(v)&&($=$E($,v.pop())),v.push($)}const O=b&&b>Te.wc_sessionAuthenticate.req.ttl?b:Te.wc_sessionAuthenticate.req.ttl,N={authPayload:{type:f??"caip122",chains:a,statement:c,aud:u,domain:l,version:"1",nonce:h,iat:new Date().toISOString(),exp:g,nbf:d,resources:v},requester:{publicKey:x,metadata:this.client.metadata},expiryTimestamp:Ee(O)},R={eip155:{chains:a,methods:[...new Set(["personal_sign",...p])],events:["chainChanged","accountsChanged"]}},T={requiredNamespaces:{},optionalNamespaces:R,relays:[{protocol:"irn"}],pairingTopic:_,proposer:{publicKey:x,metadata:this.client.metadata},expiryTimestamp:Ee(Te.wc_sessionPropose.req.ttl),id:Xt()},{done:q,resolve:F,reject:P}=Ar(O,"Request expired"),A=Xt(),B=ne("session_connect",T.id),y=ne("session_request",A),w=async({error:I,session:$})=>{this.events.off(y,E),I?P(I):$&&F({session:$})},E=async I=>{var $,C,U;if(await this.deletePendingAuthRequest(A,{message:"fulfilled",code:0}),I.error){const W=de("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return I.error.code===W.code?void 0:(this.events.off(B,w),P(I.error.message))}await this.deleteProposal(T.id),this.events.off(B,w);const{cacaos:j,responder:k}=I.result,M=[],H=[];for(const W of j){await $u({cacao:W,projectId:this.client.core.projectId})||(this.client.logger.error(W,"Signature verification failed"),P(de("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:Y}=W,te=xs(Y.resources),le=[Po(Y.iss)],pe=Ms(Y.iss);if(te){const we=Ou(te),at=Bu(te);M.push(...we),le.push(...at)}for(const we of le)H.push(`${we}:${pe}`)}const G=await this.client.core.crypto.generateSharedKey(x,k.publicKey);let J;M.length>0&&(J={topic:G,acknowledged:!0,self:{publicKey:x,metadata:this.client.metadata},peer:k,controller:k.publicKey,expiry:Ee(Qr),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:_,namespaces:rl([...new Set(M)],[...new Set(H)]),transportType:o},await this.client.core.relayer.subscribe(G,{transportType:o}),await this.client.session.set(G,J),_&&await this.client.core.pairing.updateMetadata({topic:_,metadata:k.metadata}),J=this.client.session.get(G)),($=this.client.metadata.redirect)!=null&&$.linkMode&&(C=k.metadata.redirect)!=null&&C.linkMode&&(U=k.metadata.redirect)!=null&&U.universal&&i&&(this.client.core.addLinkModeSupportedApp(k.metadata.redirect.universal),this.client.session.update(G,{transportType:he.link_mode})),F({auths:j,session:J})};this.events.once(B,w),this.events.once(y,E);let S;try{if(n){const I=zt("wc_sessionAuthenticate",N,A);this.client.core.history.set(_,I);const $=await this.client.core.crypto.encode("",I,{type:es,encoding:gr});S=ws(i,_,$)}else await Promise.all([this.sendRequest({topic:_,method:"wc_sessionAuthenticate",params:N,expiry:r.expiry,throwOnFailedPublish:!0,clientRpcId:A}),this.sendRequest({topic:_,method:"wc_sessionPropose",params:T,expiry:Te.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:T.id})])}catch(I){throw this.events.off(B,w),this.events.off(y,E),I}return await this.setProposal(T.id,T),await this.setAuthRequest(A,{request:Le(oe({},N),{verifyContext:{}}),pairingTopic:_,transportType:o}),{uri:S??m,response:q}}),L(this,"approveSessionAuthenticate",async r=>{const{id:i,auths:s}=r,n=this.client.core.eventClient.createEvent({properties:{topic:i.toString(),trace:[Dr.authenticated_session_approve_started]}});try{this.isInitialized()}catch(b){throw n.setError(Di.no_internet_connection),b}const o=this.getPendingAuthRequest(i);if(!o)throw n.setError(Di.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${i}`);const a=o.transportType||he.relay;a===he.relay&&await this.confirmOnlineStateOrThrow();const c=o.requester.publicKey,u=await this.client.core.crypto.generateKeyPair(),l=Is(c),h={type:Yt,receiverPublicKey:c,senderPublicKey:u},f=[],g=[];for(const b of s){if(!await $u({cacao:b,projectId:this.client.core.projectId})){n.setError(Di.invalid_cacao);const D=de("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:i,topic:l,error:D,encodeOpts:h}),new Error(D.message)}n.addTrace(Dr.cacaos_verified);const{p:v}=b,_=xs(v.resources),m=[Po(v.iss)],x=Ms(v.iss);if(_){const D=Ou(_),O=Bu(_);f.push(...D),m.push(...O)}for(const D of m)g.push(`${D}:${x}`)}const d=await this.client.core.crypto.generateSharedKey(u,c);n.addTrace(Dr.create_authenticated_session_topic);let p;if((f==null?void 0:f.length)>0){p={topic:d,acknowledged:!0,self:{publicKey:u,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:Ee(Qr),authentication:s,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:rl([...new Set(f)],[...new Set(g)]),transportType:a},n.addTrace(Dr.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(d,{transportType:a})}catch(b){throw n.setError(Di.subscribe_authenticated_session_topic_failure),b}n.addTrace(Dr.subscribe_authenticated_session_topic_success),await this.client.session.set(d,p),n.addTrace(Dr.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}n.addTrace(Dr.publishing_authenticated_session_approve);try{await this.sendResult({topic:l,id:i,result:{cacaos:s,responder:{publicKey:u,metadata:this.client.metadata}},encodeOpts:h,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(b){throw n.setError(Di.authenticated_session_approve_publish_failure),b}return await this.client.auth.requests.delete(i,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:n.eventId}),{session:p}}),L(this,"rejectSessionAuthenticate",async r=>{this.isInitialized();const{id:i,reason:s}=r,n=this.getPendingAuthRequest(i);if(!n)throw new Error(`Could not find pending auth request with id ${i}`);n.transportType===he.relay&&await this.confirmOnlineStateOrThrow();const o=n.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=Is(o),u={type:Yt,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:i,topic:c,error:s,encodeOpts:u,rpcOpts:Te.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(n.requester.metadata,n.transportType)}),await this.client.auth.requests.delete(i,{message:"rejected",code:0}),await this.deleteProposal(i)}),L(this,"formatAuthMessage",r=>{this.isInitialized();const{request:i,iss:s}=r;return Lf(i,s)}),L(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const r=this.relayMessageCache.shift();r&&await this.onRelayMessage(r)}catch(r){this.client.logger.error(r)}},50)}),L(this,"cleanupDuplicatePairings",async r=>{if(r.pairingTopic)try{const i=this.client.core.pairing.pairings.get(r.pairingTopic),s=this.client.core.pairing.pairings.getAll().filter(n=>{var o,a;return((o=n.peerMetadata)==null?void 0:o.url)&&((a=n.peerMetadata)==null?void 0:a.url)===r.peer.metadata.url&&n.topic&&n.topic!==i.topic});if(s.length===0)return;this.client.logger.info(`Cleaning up ${s.length} duplicate pairing(s)`),await Promise.all(s.map(n=>this.client.core.pairing.disconnect({topic:n.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(i){this.client.logger.error(i)}}),L(this,"deleteSession",async r=>{var i;const{topic:s,expirerHasDeleted:n=!1,emitEvent:o=!0,id:a=0}=r,{self:c}=this.client.session.get(s);await this.client.core.relayer.unsubscribe(s),await this.client.session.delete(s,de("USER_DISCONNECTED")),this.addToRecentlyDeleted(s,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(s)&&await this.client.core.crypto.deleteSymKey(s),n||this.client.core.expirer.del(s),this.client.core.storage.removeItem(Ul).catch(u=>this.client.logger.warn(u)),this.getPendingSessionRequests().forEach(u=>{u.topic===s&&this.deletePendingSessionRequest(u.id,de("USER_DISCONNECTED"))}),s===((i=this.sessionRequestQueue.queue[0])==null?void 0:i.topic)&&(this.sessionRequestQueue.state=Bt.idle),o&&this.client.events.emit("session_delete",{id:a,topic:s})}),L(this,"deleteProposal",async(r,i)=>{if(i)try{const s=this.client.proposal.get(r),n=this.client.core.eventClient.getEvent({topic:s.pairingTopic});n==null||n.setError(Sr.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(r,de("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"proposal")}),L(this,"deletePendingSessionRequest",async(r,i,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,i),s?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(n=>n.id!==r),s&&(this.sessionRequestQueue.state=Bt.idle,this.client.events.emit("session_request_expire",{id:r}))}),L(this,"deletePendingAuthRequest",async(r,i,s=!1)=>{await Promise.all([this.client.auth.requests.delete(r,i),s?Promise.resolve():this.client.core.expirer.del(r)])}),L(this,"setExpiry",async(r,i)=>{this.client.session.keys.includes(r)&&(this.client.core.expirer.set(r,i),await this.client.session.update(r,{expiry:i}))}),L(this,"setProposal",async(r,i)=>{this.client.core.expirer.set(r,Ee(Te.wc_sessionPropose.req.ttl)),await this.client.proposal.set(r,i)}),L(this,"setAuthRequest",async(r,i)=>{const{request:s,pairingTopic:n,transportType:o=he.relay}=i;this.client.core.expirer.set(r,s.expiryTimestamp),await this.client.auth.requests.set(r,{authPayload:s.authPayload,requester:s.requester,expiryTimestamp:s.expiryTimestamp,id:r,pairingTopic:n,verifyContext:s.verifyContext,transportType:o})}),L(this,"setPendingSessionRequest",async r=>{const{id:i,topic:s,params:n,verifyContext:o}=r,a=n.request.expiryTimestamp||Ee(Te.wc_sessionRequest.req.ttl);this.client.core.expirer.set(i,a),await this.client.pendingRequest.set(i,{id:i,topic:s,params:n,verifyContext:o})}),L(this,"sendRequest",async r=>{const{topic:i,method:s,params:n,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:u,appLink:l,tvf:h,publishOpts:f={}}=r,g=zt(s,n,c);let d;const p=!!l;try{const _=p?gr:Ze;d=await this.client.core.crypto.encode(i,g,{encoding:_})}catch(_){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${i} failed`),_}let b;if(pD.includes(s)){const _=dt(JSON.stringify(g)),m=dt(d);b=await this.client.core.verify.register({id:m,decryptedId:_})}const v=oe(oe({},Te[s].req),f);if(v.attestation=b,o&&(v.ttl=o),a&&(v.id=a),this.client.core.history.set(i,g),p){const _=ws(l,i,d);await Z.Linking.openURL(_,this.client.name)}else v.tvf=Le(oe({},h),{correlationId:g.id}),u?(v.internal=Le(oe({},v.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,d,v)):this.client.core.relayer.publish(i,d,v).catch(_=>this.client.logger.error(_));return g.id}),L(this,"sendProposeSession",async r=>{const{proposal:i,publishOpts:s}=r,n=zt("wc_sessionPropose",i,i.id);this.client.core.history.set(i.pairingTopic,n);const o=await this.client.core.crypto.encode(i.pairingTopic,n,{encoding:Ze}),a=dt(JSON.stringify(n)),c=dt(o),u=await this.client.core.verify.register({id:c,decryptedId:a});await this.client.core.relayer.publishCustom({payload:{pairingTopic:i.pairingTopic,sessionProposal:o},opts:Le(oe({},s),{publishMethod:"wc_proposeSession",attestation:u})})}),L(this,"sendApproveSession",async r=>{const{sessionTopic:i,pairingProposalResponse:s,proposal:n,sessionSettleRequest:o,publishOpts:a}=r,c=Ds(n.id,s),u=await this.client.core.crypto.encode(n.pairingTopic,c,{encoding:Ze}),l=zt("wc_sessionSettle",o,a==null?void 0:a.id),h=await this.client.core.crypto.encode(i,l,{encoding:Ze});this.client.core.history.set(i,l),await this.client.core.relayer.publishCustom({payload:{sessionTopic:i,pairingTopic:n.pairingTopic,sessionProposalResponse:u,sessionSettlementRequest:h},opts:Le(oe({},a),{publishMethod:"wc_approveSession"})})}),L(this,"sendResult",async r=>{const{id:i,topic:s,result:n,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=r,u=Ds(i,n);let l;const h=c&&typeof(Z==null?void 0:Z.Linking)<"u";try{const d=h?gr:Ze;l=await this.client.core.crypto.encode(s,u,Le(oe({},a||{}),{encoding:d}))}catch(d){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${s} failed`),d}let f,g;try{f=await this.client.core.history.get(s,i);const d=f.request;try{g=this.getTVFParams(i,d.params,n)}catch(p){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${p==null?void 0:p.message}`)}}catch(d){throw this.client.logger.error(`sendResult() -> history.get(${s}, ${i}) failed`),d}if(h){const d=ws(c,s,l);await Z.Linking.openURL(d,this.client.name)}else{const d=f.request.method,p=Te[d].res;p.tvf=Le(oe({},g),{correlationId:i}),o?(p.internal=Le(oe({},p.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,l,p)):this.client.core.relayer.publish(s,l,p).catch(b=>this.client.logger.error(b))}await this.client.core.history.resolve(u)}),L(this,"sendError",async r=>{const{id:i,topic:s,error:n,encodeOpts:o,rpcOpts:a,appLink:c}=r,u=ra(i,n);let l;const h=c&&typeof(Z==null?void 0:Z.Linking)<"u";try{const g=h?gr:Ze;l=await this.client.core.crypto.encode(s,u,Le(oe({},o||{}),{encoding:g}))}catch(g){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${s} failed`),g}let f;try{f=await this.client.core.history.get(s,i)}catch(g){throw this.client.logger.error(`sendError() -> history.get(${s}, ${i}) failed`),g}if(h){const g=ws(c,s,l);await Z.Linking.openURL(g,this.client.name)}else{const g=f.request.method,d=a||Te[g].res;this.client.core.relayer.publish(s,l,d)}await this.client.core.history.resolve(u)}),L(this,"cleanup",async()=>{const r=[],i=[];this.client.session.getAll().forEach(s=>{let n=!1;ur(s.expiry)&&(n=!0),this.client.core.crypto.keychain.has(s.topic)||(n=!0),n&&r.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{ur(s.expiryTimestamp)&&i.push(s.id)}),await Promise.all([...r.map(s=>this.deleteSession({topic:s})),...i.map(s=>this.deleteProposal(s))])}),L(this,"onProviderMessageEvent",async r=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(r):await this.onRelayMessage(r)}),L(this,"onRelayEventRequest",async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()}),L(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===Bt.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=Bt.active;const r=this.requestQueue.queue.shift();if(r)try{await this.processRequest(r)}catch(i){this.client.logger.warn(i)}}this.requestQueue.state=Bt.idle}),L(this,"processRequest",async r=>{const{topic:i,payload:s,attestation:n,transportType:o,encryptedId:a}=r,c=s.method;if(!this.shouldIgnorePairingRequest({topic:i,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:i,payload:s,attestation:n,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(i,s);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(i,s);case"wc_sessionExtend":return await this.onSessionExtendRequest(i,s);case"wc_sessionPing":return await this.onSessionPingRequest(i,s);case"wc_sessionDelete":return await this.onSessionDeleteRequest(i,s);case"wc_sessionRequest":return await this.onSessionRequest({topic:i,payload:s,attestation:n,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(i,s);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:i,payload:s,attestation:n,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),L(this,"onRelayEventResponse",async r=>{const{topic:i,payload:s,transportType:n}=r,o=(await this.client.core.history.get(i,s.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(i,s,n);case"wc_sessionSettle":return this.onSessionSettleResponse(i,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,s);case"wc_sessionExtend":return this.onSessionExtendResponse(i,s);case"wc_sessionPing":return this.onSessionPingResponse(i,s);case"wc_sessionRequest":return this.onSessionRequestResponse(i,s);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(i,s);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),L(this,"onRelayEventUnknownPayload",r=>{const{topic:i}=r,{message:s}=z("MISSING_OR_INVALID",`Decoded payload on topic ${i} is not identifiable as a JSON-RPC request or a response.`);throw new Error(s)}),L(this,"shouldIgnorePairingRequest",r=>{const{topic:i,requestMethod:s}=r,n=this.expectedPairingMethodMap.get(i);return!n||n.includes(s)?!1:!!(n.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),L(this,"onSessionProposeRequest",async r=>{const{topic:i,payload:s,attestation:n,encryptedId:o}=r,{params:a,id:c}=s;try{const u=this.client.core.eventClient.getEvent({topic:i});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),u==null||u.setError(qt.proposal_listener_not_found)),this.isValidConnect(oe({},s.params));const l=a.expiryTimestamp||Ee(Te.wc_sessionPropose.req.ttl),h=oe({id:c,pairingTopic:i,expiryTimestamp:l,attestation:n,encryptedId:o},a);await this.setProposal(c,h);const f=await this.getVerifyContext({attestationId:n,hash:dt(JSON.stringify(s)),encryptedId:o,metadata:h.proposer.metadata});u==null||u.addTrace(Tt.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:h,verifyContext:f})}catch(u){await this.sendError({id:c,topic:i,error:u,rpcOpts:Te.wc_sessionPropose.autoReject}),this.client.logger.error(u)}}),L(this,"onSessionProposeResponse",async(r,i,s)=>{const{id:n}=i;if(Pt(i)){const{result:o}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(n);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const u=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:u});const l=await this.client.core.crypto.generateSharedKey(c,u);this.pendingSessions.set(n,{sessionTopic:l,pairingTopic:r,proposalId:n,publicKey:c});const h=await this.client.core.relayer.subscribe(l,{transportType:s});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:h}),await this.client.core.pairing.activate({topic:r})}else if(pt(i)){await this.deleteProposal(n);const o=ne("session_connect",n);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:i.error})}}),L(this,"onSessionSettleRequest",async(r,i)=>{const{id:s,params:n}=i;try{this.isValidSessionSettleRequest(n);const{relay:o,controller:a,expiry:c,namespaces:u,sessionProperties:l,scopedProperties:h,sessionConfig:f}=i.params,g=[...this.pendingSessions.values()].find(b=>b.sessionTopic===r);if(!g)return this.client.logger.error(`Pending session not found for topic ${r}`);const d=this.client.proposal.get(g.proposalId),p=Le(oe(oe(oe({topic:r,relay:o,expiry:c,namespaces:u,acknowledged:!0,pairingTopic:g.pairingTopic,requiredNamespaces:d.requiredNamespaces,optionalNamespaces:d.optionalNamespaces,controller:a.publicKey,self:{publicKey:g.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},l&&{sessionProperties:l}),h&&{scopedProperties:h}),f&&{sessionConfig:f}),{transportType:he.relay});await this.client.session.set(p.topic,p),await this.setExpiry(p.topic,p.expiry),await this.client.core.pairing.updateMetadata({topic:g.pairingTopic,metadata:p.peer.metadata}),this.client.events.emit("session_connect",{session:p}),this.events.emit(ne("session_connect",g.proposalId),{session:p}),this.pendingSessions.delete(g.proposalId),this.deleteProposal(g.proposalId,!1),this.cleanupDuplicatePairings(p),await this.sendResult({id:i.id,topic:r,result:!0})}catch(o){await this.sendError({id:s,topic:r,error:o}),this.client.logger.error(o)}}),L(this,"onSessionSettleResponse",async(r,i)=>{const{id:s}=i;Pt(i)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(ne("session_approve",s),{})):pt(i)&&(await this.client.session.delete(r,de("USER_DISCONNECTED")),this.events.emit(ne("session_approve",s),{error:i.error}))}),L(this,"onSessionUpdateRequest",async(r,i)=>{const{params:s,id:n}=i;try{const o=`${r}_session_update`,a=_i.get(o);if(a&&this.isRequestOutOfSync(a,n)){this.client.logger.warn(`Discarding out of sync request - ${n}`),this.sendError({id:n,topic:r,error:de("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(oe({topic:r},s));try{_i.set(o,n),await this.client.session.update(r,{namespaces:s.namespaces}),await this.sendResult({id:n,topic:r,result:!0})}catch(c){throw _i.delete(o),c}this.client.events.emit("session_update",{id:n,topic:r,params:s})}catch(o){await this.sendError({id:n,topic:r,error:o}),this.client.logger.error(o)}}),L(this,"isRequestOutOfSync",(r,i)=>i.toString().slice(0,-3)<r.toString().slice(0,-3)),L(this,"onSessionUpdateResponse",(r,i)=>{const{id:s}=i,n=ne("session_update",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);Pt(i)?this.events.emit(ne("session_update",s),{}):pt(i)&&this.events.emit(ne("session_update",s),{error:i.error})}),L(this,"onSessionExtendRequest",async(r,i)=>{const{id:s}=i;try{this.isValidExtend({topic:r}),await this.setExpiry(r,Ee(Qr)),await this.sendResult({id:s,topic:r,result:!0}),this.client.events.emit("session_extend",{id:s,topic:r})}catch(n){await this.sendError({id:s,topic:r,error:n}),this.client.logger.error(n)}}),L(this,"onSessionExtendResponse",(r,i)=>{const{id:s}=i,n=ne("session_extend",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);Pt(i)?this.events.emit(ne("session_extend",s),{}):pt(i)&&this.events.emit(ne("session_extend",s),{error:i.error})}),L(this,"onSessionPingRequest",async(r,i)=>{const{id:s}=i;try{this.isValidPing({topic:r}),await this.sendResult({id:s,topic:r,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:s,topic:r})}catch(n){await this.sendError({id:s,topic:r,error:n}),this.client.logger.error(n)}}),L(this,"onSessionPingResponse",(r,i)=>{const{id:s}=i,n=ne("session_ping",s);setTimeout(()=>{if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners 2176`);Pt(i)?this.events.emit(ne("session_ping",s),{}):pt(i)&&this.events.emit(ne("session_ping",s),{error:i.error})},500)}),L(this,"onSessionDeleteRequest",async(r,i)=>{const{id:s}=i;try{this.isValidDisconnect({topic:r,reason:i.params}),await Promise.all([new Promise(n=>{this.client.core.relayer.once(ge.publish,async()=>{n(await this.deleteSession({topic:r,id:s}))})}),this.sendResult({id:s,topic:r,result:!0}),this.cleanupPendingSentRequestsForTopic({topic:r,error:de("USER_DISCONNECTED")})]).catch(n=>this.client.logger.error(n))}catch(n){this.client.logger.error(n)}}),L(this,"onSessionRequest",async r=>{var i,s,n;const{topic:o,payload:a,attestation:c,encryptedId:u,transportType:l}=r,{id:h,params:f}=a;try{await this.isValidRequest(oe({topic:o},f));const g=this.client.session.get(o),d=await this.getVerifyContext({attestationId:c,hash:dt(JSON.stringify(zt("wc_sessionRequest",f,h))),encryptedId:u,metadata:g.peer.metadata,transportType:l}),p={id:h,topic:o,params:f,verifyContext:d};await this.setPendingSessionRequest(p),l===he.link_mode&&(i=g.peer.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp((s=g.peer.metadata.redirect)==null?void 0:s.universal),(n=this.client.signConfig)!=null&&n.disableRequestQueue?this.emitSessionRequest(p):(this.addSessionRequestToSessionRequestQueue(p),this.processSessionRequestQueue())}catch(g){await this.sendError({id:h,topic:o,error:g}),this.client.logger.error(g)}}),L(this,"onSessionRequestResponse",(r,i)=>{const{id:s}=i,n=ne("session_request",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);Pt(i)?this.events.emit(ne("session_request",s),{result:i.result}):pt(i)&&this.events.emit(ne("session_request",s),{error:i.error})}),L(this,"onSessionEventRequest",async(r,i)=>{const{id:s,params:n}=i;try{const o=`${r}_session_event_${n.event.name}`,a=_i.get(o);if(a&&this.isRequestOutOfSync(a,s)){this.client.logger.info(`Discarding out of sync request - ${s}`);return}this.isValidEmit(oe({topic:r},n)),this.client.events.emit("session_event",{id:s,topic:r,params:n}),_i.set(o,s)}catch(o){await this.sendError({id:s,topic:r,error:o}),this.client.logger.error(o)}}),L(this,"onSessionAuthenticateResponse",(r,i)=>{const{id:s}=i;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:r,payload:i}),Pt(i)?this.events.emit(ne("session_request",s),{result:i.result}):pt(i)&&this.events.emit(ne("session_request",s),{error:i.error})}),L(this,"onSessionAuthenticateRequest",async r=>{var i;const{topic:s,payload:n,attestation:o,encryptedId:a,transportType:c}=r;try{const{requester:u,authPayload:l,expiryTimestamp:h}=n.params,f=await this.getVerifyContext({attestationId:o,hash:dt(JSON.stringify(n)),encryptedId:a,metadata:u.metadata,transportType:c}),g={requester:u,pairingTopic:s,id:n.id,authPayload:l,verifyContext:f,expiryTimestamp:h};await this.setAuthRequest(n.id,{request:g,pairingTopic:s,transportType:c}),c===he.link_mode&&(i=u.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp(u.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:s,params:n.params,id:n.id,verifyContext:f})}catch(u){this.client.logger.error(u);const l=n.params.requester.publicKey,h=await this.client.core.crypto.generateKeyPair(),f=this.getAppLinkIfEnabled(n.params.requester.metadata,c),g={type:Yt,receiverPublicKey:l,senderPublicKey:h};await this.sendError({id:n.id,topic:s,error:u,encodeOpts:g,rpcOpts:Te.wc_sessionAuthenticate.autoReject,appLink:f})}}),L(this,"addSessionRequestToSessionRequestQueue",r=>{this.sessionRequestQueue.queue.push(r)}),L(this,"cleanupAfterResponse",r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=Bt.idle,this.processSessionRequestQueue()},V.toMiliseconds(this.requestQueueDelay))}),L(this,"cleanupPendingSentRequestsForTopic",({topic:r,error:i})=>{const s=this.client.core.history.pending;s.length>0&&s.filter(n=>n.topic===r&&n.request.method==="wc_sessionRequest").forEach(n=>{const o=n.request.id,a=ne("session_request",o);if(this.events.listenerCount(a)===0)throw new Error(`emitting ${a} without any listeners`);this.events.emit(ne("session_request",n.request.id),{error:i})})}),L(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===Bt.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.emitSessionRequest(r)}catch(i){this.client.logger.error(i)}}),L(this,"emitSessionRequest",r=>{if(this.emittedSessionRequests.has(r.id)){this.client.logger.warn({id:r.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${r.id}`);return}this.sessionRequestQueue.state=Bt.active,this.emittedSessionRequests.add(r.id),this.client.events.emit("session_request",r)}),L(this,"onPairingCreated",r=>{if(r.methods&&this.expectedPairingMethodMap.set(r.topic,r.methods),r.active)return;const i=this.client.proposal.getAll().find(s=>s.pairingTopic===r.topic);i&&this.onSessionProposeRequest({topic:r.topic,payload:zt("wc_sessionPropose",Le(oe({},i),{requiredNamespaces:i.requiredNamespaces,optionalNamespaces:i.optionalNamespaces,relays:i.relays,proposer:i.proposer,sessionProperties:i.sessionProperties,scopedProperties:i.scopedProperties}),i.id),attestation:i.attestation,encryptedId:i.encryptedId})}),L(this,"isValidConnect",async r=>{if(!We(r)){const{message:u}=z("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(u)}const{pairingTopic:i,requiredNamespaces:s,optionalNamespaces:n,sessionProperties:o,scopedProperties:a,relays:c}=r;if(Ie(i)||await this.isValidPairingTopic(i),!F3(c)){const{message:u}=z("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(u)}if(s&&!Ie(s)&&zi(s)!==0){const u="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(u):this.client.logger.warn(u),this.validateNamespaces(s,"requiredNamespaces")}if(n&&!Ie(n)&&zi(n)!==0&&this.validateNamespaces(n,"optionalNamespaces"),o&&!Ie(o)&&this.validateSessionProps(o,"sessionProperties"),a&&!Ie(a)){this.validateSessionProps(a,"scopedProperties");const u=Object.keys(s||{}).concat(Object.keys(n||{}));if(!Object.keys(a).every(l=>u.includes(l.split(":")[0])))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(u)}`)}}),L(this,"validateNamespaces",(r,i)=>{const s=k3(r,"connect()",i);if(s)throw new Error(s.message)}),L(this,"isValidApprove",async r=>{if(!We(r))throw new Error(z("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:i,namespaces:s,relayProtocol:n,sessionProperties:o,scopedProperties:a}=r;this.checkRecentlyDeleted(i),await this.isValidProposalId(i);const c=this.client.proposal.get(i),u=no(s,"approve()");if(u)throw new Error(u.message);const l=nl(c.requiredNamespaces,s,"approve()");if(l)throw new Error(l.message);if(!me(n,!0)){const{message:h}=z("MISSING_OR_INVALID",`approve() relayProtocol: ${n}`);throw new Error(h)}if(o&&!Ie(o)&&this.validateSessionProps(o,"sessionProperties"),a&&!Ie(a)){this.validateSessionProps(a,"scopedProperties");const h=new Set(Object.keys(s));if(!Object.keys(a).every(f=>h.has(f.split(":")[0])))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(h).join(", ")}`)}}),L(this,"isValidReject",async r=>{if(!We(r)){const{message:n}=z("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(n)}const{id:i,reason:s}=r;if(this.checkRecentlyDeleted(i),await this.isValidProposalId(i),!M3(s)){const{message:n}=z("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(n)}}),L(this,"isValidSessionSettleRequest",r=>{if(!We(r)){const{message:u}=z("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(u)}const{relay:i,controller:s,namespaces:n,expiry:o}=r;if(!Id(i)){const{message:u}=z("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(u)}const a=T3(s,"onSessionSettleRequest()");if(a)throw new Error(a.message);const c=no(n,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(ur(o)){const{message:u}=z("EXPIRED","onSessionSettleRequest()");throw new Error(u)}}),L(this,"isValidUpdate",async r=>{if(!We(r)){const{message:c}=z("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(c)}const{topic:i,namespaces:s}=r;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const n=this.client.session.get(i),o=no(s,"update()");if(o)throw new Error(o.message);const a=nl(n.requiredNamespaces,s,"update()");if(a)throw new Error(a.message)}),L(this,"isValidExtend",async r=>{if(!We(r)){const{message:s}=z("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(s)}const{topic:i}=r;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i)}),L(this,"isValidRequest",async r=>{if(!We(r)){const{message:c}=z("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(c)}const{topic:i,request:s,chainId:n,expiry:o}=r;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const{namespaces:a}=this.client.session.get(i);if(!sl(a,n)){const{message:c}=z("MISSING_OR_INVALID",`request() chainId: ${n}`);throw new Error(c)}if(!q3(s)){const{message:c}=z("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(c)}if(!V3(a,n,s.method)){const{message:c}=z("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(c)}if(o&&!G3(o,ho)){const{message:c}=z("MISSING_OR_INVALID",`request() expiry: ${o}. Expiry must be a number (in seconds) between ${ho.min} and ${ho.max}`);throw new Error(c)}}),L(this,"isValidRespond",async r=>{var i;if(!We(r)){const{message:a}=z("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(a)}const{topic:s,response:n}=r;try{await this.isValidSessionTopic(s)}catch(a){throw(i=r==null?void 0:r.response)!=null&&i.id&&this.cleanupAfterResponse(r),a}if(!j3(n)){const{message:a}=z("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(n)}`);throw new Error(a)}const o=this.client.pendingRequest.get(n.id);if(o.topic!==s){const{message:a}=z("MISMATCHED_TOPIC",`Request response topic mismatch. reqId: ${n.id}, expected topic: ${o.topic}, received topic: ${s}`);throw new Error(a)}}),L(this,"isValidPing",async r=>{if(!We(r)){const{message:s}=z("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)}),L(this,"isValidEmit",async r=>{if(!We(r)){const{message:a}=z("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(a)}const{topic:i,event:s,chainId:n}=r;await this.isValidSessionTopic(i);const{namespaces:o}=this.client.session.get(i);if(!sl(o,n)){const{message:a}=z("MISSING_OR_INVALID",`emit() chainId: ${n}`);throw new Error(a)}if(!z3(s)){const{message:a}=z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(a)}if(!K3(o,n,s.name)){const{message:a}=z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(a)}}),L(this,"isValidDisconnect",async r=>{if(!We(r)){const{message:s}=z("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)}),L(this,"isValidAuthenticate",r=>{const{chains:i,uri:s,domain:n,nonce:o}=r;if(!Array.isArray(i)||i.length===0)throw new Error("chains is required and must be a non-empty array");if(!me(s,!1))throw new Error("uri is required parameter");if(!me(n,!1))throw new Error("domain is required parameter");if(!me(o,!1))throw new Error("nonce is required parameter");if([...new Set(i.map(c=>Es(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=Es(i[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),L(this,"getVerifyContext",async r=>{const{attestationId:i,hash:s,encryptedId:n,metadata:o,transportType:a}=r,c={verified:{verifyUrl:o.verifyUrl||Ui,validation:"UNKNOWN",origin:o.url||""}};try{if(a===he.link_mode){const l=this.getAppLinkIfEnabled(o,a);return c.verified.validation=l&&new URL(l).origin===new URL(o.url).origin?"VALID":"INVALID",c}const u=await this.client.core.verify.resolve({attestationId:i,hash:s,encryptedId:n,verifyUrl:o.verifyUrl});u&&(c.verified.origin=u.origin,c.verified.isScam=u.isScam,c.verified.validation=u.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(u){this.client.logger.warn(u)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),L(this,"validateSessionProps",(r,i)=>{Object.values(r).forEach((s,n)=>{if(s==null){const{message:o}=z("MISSING_OR_INVALID",`${i} must contain an existing value for each key. Received: ${s} for key ${Object.keys(r)[n]}`);throw new Error(o)}})}),L(this,"getPendingAuthRequest",r=>{const i=this.client.auth.requests.get(r);return typeof i=="object"?i:void 0}),L(this,"addToRecentlyDeleted",(r,i)=>{if(this.recentlyDeletedMap.set(r,i),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let s=0;const n=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(s++>=n)break;this.recentlyDeletedMap.delete(o)}}}),L(this,"checkRecentlyDeleted",r=>{const i=this.recentlyDeletedMap.get(r);if(i){const{message:s}=z("MISSING_OR_INVALID",`Record was recently deleted - ${i}: ${r}`);throw new Error(s)}}),L(this,"isLinkModeEnabled",(r,i)=>{var s,n,o,a,c,u,l,h,f;return!r||i!==he.link_mode?!1:((n=(s=this.client.metadata)==null?void 0:s.redirect)==null?void 0:n.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((u=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:u.universal)!==""&&((l=r==null?void 0:r.redirect)==null?void 0:l.universal)!==void 0&&((h=r==null?void 0:r.redirect)==null?void 0:h.universal)!==""&&((f=r==null?void 0:r.redirect)==null?void 0:f.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(r.redirect.universal)&&typeof(Z==null?void 0:Z.Linking)<"u"}),L(this,"getAppLinkIfEnabled",(r,i)=>{var s;return this.isLinkModeEnabled(r,i)?(s=r==null?void 0:r.redirect)==null?void 0:s.universal:void 0}),L(this,"handleLinkModeMessage",({url:r})=>{if(!r||!r.includes("wc_ev")||!r.includes("topic"))return;const i=yu(r,"topic")||"",s=decodeURIComponent(yu(r,"wc_ev")||""),n=this.client.session.keys.includes(i);n&&this.client.session.update(i,{transportType:he.link_mode}),this.client.core.dispatchEnvelope({topic:i,message:s,sessionExists:n})}),L(this,"registerLinkModeListeners",async()=>{var r;if(xa()||vr()&&(r=this.client.metadata.redirect)!=null&&r.linkMode){const i=Z==null?void 0:Z.Linking;if(typeof i<"u"){i.addEventListener("url",this.handleLinkModeMessage,this.client.name);const s=await i.getInitialURL();s&&setTimeout(()=>{this.handleLinkModeMessage({url:s})},50)}}}),L(this,"getTVFParams",(r,i,s)=>{var n,o,a;if(!((n=i.request)!=null&&n.method))return{};const c={correlationId:r,rpcMethods:[i.request.method],chainId:i.chainId};try{const u=this.extractTxHashesFromResult(i.request,s);c.txHashes=u,c.contractAddresses=this.isValidContractData(i.request.params)?[(a=(o=i.request.params)==null?void 0:o[0])==null?void 0:a.to]:[]}catch(u){this.client.logger.warn(u,"Error getting TVF params")}return c}),L(this,"isValidContractData",r=>{var i;if(!r)return!1;try{const s=(r==null?void 0:r.data)||((i=r==null?void 0:r[0])==null?void 0:i.data);if(!s.startsWith("0x"))return!1;const n=s.slice(2);return/^[0-9a-fA-F]*$/.test(n)?n.length%2===0:!1}catch{}return!1}),L(this,"extractTxHashesFromResult",(r,i)=>{var s;try{if(!i)return[];const n=r.method,o=fD[n];if(n==="sui_signTransaction")return[uE(i.transactionBytes)];if(n==="near_signTransaction")return[_u(i)];if(n==="near_signTransactions")return i.map(c=>_u(c));if(n==="xrpl_signTransactionFor"||n==="xrpl_signTransaction")return[(s=i.tx_json)==null?void 0:s.hash];if(n==="polkadot_signTransaction")return[u8({transaction:r.params.transactionPayload,signature:i.signature})];if(n==="algo_signTxn")return li(i)?i.map(c=>Su(c)):[Su(i)];if(n==="cosmos_signDirect")return[hE(i)];if(n==="wallet_sendCalls")return fE(i);if(typeof i=="string")return[i];const a=i[o.key];if(li(a))return n==="solana_signAllTransactions"?a.map(c=>cE(c)):a;if(typeof a=="string")return[a]}catch(n){this.client.logger.warn(n,"Error extracting tx hashes from result")}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,r=this.client.core.relayer.messages.getWithoutAck(e);for(const[i,s]of Object.entries(r))for(const n of s)try{await this.onProviderMessageEvent({topic:i,message:n,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${i}, message: ${n}`)}}catch(e){this.client.logger.warn(e,"processPendingMessageEvents failed")}}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(ge.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:r,message:i,attestation:s,transportType:n}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(Ss)?this.client.auth.authKeys.get(Ss):{publicKey:void 0};try{const a=await this.client.core.crypto.decode(r,i,{receiverPublicKey:o,encoding:n===he.link_mode?gr:Ze});Ca(a)?(this.client.core.history.set(r,a),await this.onRelayEventRequest({topic:r,payload:a,attestation:s,transportType:n,encryptedId:dt(i)})):ln(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a,transportType:n}),this.client.core.history.delete(r,a.id)):await this.onRelayEventUnknownPayload({topic:r,payload:a,transportType:n}),await this.client.core.relayer.messages.ack(r,i)}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(ht.expired,async e=>{const{topic:r,id:i}=If(e.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,z("EXPIRED"),!0);if(i&&this.client.auth.requests.keys.includes(i))return await this.deletePendingAuthRequest(i,z("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession({topic:r,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:r})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))})}registerPairingEvents(){this.client.core.pairing.events.on(Or.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(Or.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!me(e,!1)){const{message:r}=z("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:r}=z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(ur(this.client.core.pairing.pairings.get(e).expiry)){const{message:r}=z("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!me(e,!1)){const{message:r}=z("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:r}=z("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(ur(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:r}=z("EXPIRED",`session topic: ${e}`);throw new Error(r)}if(!this.client.core.crypto.keychain.has(e)){const{message:r}=z("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(me(e,!1)){const{message:r}=z("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{const{message:r}=z("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!L3(e)){const{message:r}=z("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){const{message:r}=z("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(ur(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:r}=z("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}}class DD extends Vr{constructor(e,r){super(e,r,uD,Ra),this.core=e,this.logger=r}}class AD extends Vr{constructor(e,r){super(e,r,lD,Ra),this.core=e,this.logger=r}}class $D extends Vr{constructor(e,r){super(e,r,dD,Ra,i=>i.id),this.core=e,this.logger=r}}class OD extends Vr{constructor(e,r){super(e,r,wD,fn,()=>Ss),this.core=e,this.logger=r}}class BD extends Vr{constructor(e,r){super(e,r,bD,fn),this.core=e,this.logger=r}}class TD extends Vr{constructor(e,r){super(e,r,mD,fn,i=>i.id),this.core=e,this.logger=r}}var PD=Object.defineProperty,ND=(t,e,r)=>e in t?PD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,fo=(t,e,r)=>ND(t,typeof e!="symbol"?e+"":e,r);class CD{constructor(e,r){this.core=e,this.logger=r,fo(this,"authKeys"),fo(this,"pairingTopics"),fo(this,"requests"),this.authKeys=new OD(this.core,this.logger),this.pairingTopics=new BD(this.core,this.logger),this.requests=new TD(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var UD=Object.defineProperty,RD=(t,e,r)=>e in t?UD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ee=(t,e,r)=>RD(t,typeof e!="symbol"?e+"":e,r);class ka extends Rg{constructor(e){super(e),ee(this,"protocol",jd),ee(this,"version",zd),ee(this,"name",lo.name),ee(this,"metadata"),ee(this,"core"),ee(this,"logger"),ee(this,"events",new St.EventEmitter),ee(this,"engine"),ee(this,"session"),ee(this,"proposal"),ee(this,"pendingRequest"),ee(this,"auth"),ee(this,"signConfig"),ee(this,"on",(i,s)=>this.events.on(i,s)),ee(this,"once",(i,s)=>this.events.once(i,s)),ee(this,"off",(i,s)=>this.events.off(i,s)),ee(this,"removeListener",(i,s)=>this.events.removeListener(i,s)),ee(this,"removeAllListeners",i=>this.events.removeAllListeners(i)),ee(this,"connect",async i=>{try{return await this.engine.connect(i)}catch(s){throw this.logger.error(s.message),s}}),ee(this,"pair",async i=>{try{return await this.engine.pair(i)}catch(s){throw this.logger.error(s.message),s}}),ee(this,"approve",async i=>{try{return await this.engine.approve(i)}catch(s){throw this.logger.error(s.message),s}}),ee(this,"reject",async i=>{try{return await this.engine.reject(i)}catch(s){throw this.logger.error(s.message),s}}),ee(this,"update",async i=>{try{return await this.engine.update(i)}catch(s){throw this.logger.error(s.message),s}}),ee(this,"extend",async i=>{try{return await this.engine.extend(i)}catch(s){throw this.logger.error(s.message),s}}),ee(this,"request",async i=>{try{return await this.engine.request(i)}catch(s){throw this.logger.error(s.message),s}}),ee(this,"respond",async i=>{try{return await this.engine.respond(i)}catch(s){throw this.logger.error(s.message),s}}),ee(this,"ping",async i=>{try{return await this.engine.ping(i)}catch(s){throw this.logger.error(s.message),s}}),ee(this,"emit",async i=>{try{return await this.engine.emit(i)}catch(s){throw this.logger.error(s.message),s}}),ee(this,"disconnect",async i=>{try{return await this.engine.disconnect(i)}catch(s){throw this.logger.error(s.message),s}}),ee(this,"find",i=>{try{return this.engine.find(i)}catch(s){throw this.logger.error(s.message),s}}),ee(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}}),ee(this,"authenticate",async(i,s)=>{try{return await this.engine.authenticate(i,s)}catch(n){throw this.logger.error(n.message),n}}),ee(this,"formatAuthMessage",i=>{try{return this.engine.formatAuthMessage(i)}catch(s){throw this.logger.error(s.message),s}}),ee(this,"approveSessionAuthenticate",async i=>{try{return await this.engine.approveSessionAuthenticate(i)}catch(s){throw this.logger.error(s.message),s}}),ee(this,"rejectSessionAuthenticate",async i=>{try{return await this.engine.rejectSessionAuthenticate(i)}catch(s){throw this.logger.error(s.message),s}}),this.name=(e==null?void 0:e.name)||lo.name,this.metadata=tv(e==null?void 0:e.metadata),this.signConfig=e==null?void 0:e.signConfig;const r=_d({logger:(e==null?void 0:e.logger)||lo.logger,name:this.name});this.logger=r,this.core=(e==null?void 0:e.core)||new cD(e),this.session=new AD(this.core,this.logger),this.proposal=new DD(this.core,this.logger),this.pendingRequest=new $D(this.core,this.logger),this.engine=new SD(this),this.auth=new CD(this.core,this.logger)}static async init(e){const r=new ka(e);return await r.initialize(),r}get context(){return et(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}const m6=ka;export{yD as AUTH_CONTEXT,wD as AUTH_KEYS_CONTEXT,bD as AUTH_PAIRING_TOPIC_CONTEXT,gD as AUTH_PROTOCOL,Ss as AUTH_PUBLIC_KEY_NAME,mD as AUTH_REQUEST_CONTEXT,fn as AUTH_STORAGE_PREFIX,hD as ENGINE_CONTEXT,Bt as ENGINE_QUEUE_STATES,Te as ENGINE_RPC_OPTS,pD as METHODS_TO_VERIFY,uD as PROPOSAL_CONTEXT,Rl as PROPOSAL_EXPIRY_MESSAGE,dD as REQUEST_CONTEXT,lD as SESSION_CONTEXT,Qr as SESSION_EXPIRY,ho as SESSION_REQUEST_EXPIRY_BOUNDARIES,Vd as SIGN_CLIENT_CONTEXT,lo as SIGN_CLIENT_DEFAULT,jd as SIGN_CLIENT_PROTOCOL,Ra as SIGN_CLIENT_STORAGE_PREFIX,zd as SIGN_CLIENT_VERSION,m6 as SignClient,fD as TVF_METHODS,Ul as WALLETCONNECT_DEEPLINK_CHOICE,ka as default};
